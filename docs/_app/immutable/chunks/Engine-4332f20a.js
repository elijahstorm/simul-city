import{B as cn,S as fe,i as oe,s as he,E as de,H as ge,I as me,J as ve,f as ye,t as be,L as wn,o as _e,a8 as An,U as Se}from"./index-cdbf168b.js";function Re(n,t){for(var e=0;e<t.length;e++){const r=t[e];if(typeof r!="string"&&!Array.isArray(r)){for(const a in r)if(a!=="default"&&!(a in n)){const u=Object.getOwnPropertyDescriptor(r,a);u&&Object.defineProperty(n,a,u.get?u:{enumerable:!0,get:()=>r[a]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}const qt=n=>{const t=new Array;for(let e=0;e<n.length-1;e++)t.push(Me(n[e],n[e+1]));return{layers:t}},Me=(n,t)=>{const e=new Array(n),r=new Array(t),a=r.fill(0).map(g=>Math.random()*2-1),u=e.fill(0).map(g=>r.map(b=>Math.random()*2-1));return{inputs:e,outputs:r,biases:a,weights:u}},Ie=cn(),Ct=cn(),En=cn(),sa=cn({}),dn=Object.freeze({simulation:{currentId:0,carSpots:[{box:{x:100,y:100,width:30,height:55,angle:0},brain:qt([1,1]),destination:[0,0],color:"#000",dead:!0,fitness:0,performace:0,path:[]}],world:{generatedMap:{map:[{draw:n=>t=>null,rotate:0}],connections:[[!1,!1,!1,!1]],borders:[[[[0,0],[0,0]]]]},dim:1,size:{width:1,height:1},backgroundSaved:!1},destroyed:!1,layers:[6,4,6,5]},master:{gridSize:5,carAmount:20},brain:{sensorCount:5,sensorLength:200,sensorSpread:Math.PI/2,minFitness:-400},controls:{showNetwork:!0,cameraFocus:0,playerControls:!1,drawSensors:!1,cameraSpeed:.06,carThrust:2,maxSpeed:8,carTurnSpeed:.5,carBreakStrength:.4,friction:.04}}),G={simulation:cn(dn.simulation),master:cn(dn.master),brain:cn(dn.brain),controls:cn(dn.controls)},we={master:{gridSize:{type:"number",where:"master",min:2,max:100,step:1},carAmount:{type:"number",where:"master",min:2,max:1e3,step:10}},brain:{sensorCount:{type:"number",where:"brain",min:1,max:30,step:1},sensorLength:{type:"number",where:"brain",min:60,max:300,step:20},sensorSpread:{type:"number",where:"brain",min:0,max:Math.PI,step:.3},minFitness:{type:"number",where:"brain",min:-3e3,max:0,step:50}},controls:{cameraFocus:{type:"number",where:"controls",min:0,max:5,step:1},playerControls:{type:"checkbox",where:"controls"},showNetwork:{type:"checkbox",where:"controls"},drawSensors:{type:"checkbox",where:"controls"},cameraSpeed:{type:"number",where:"controls",min:0,max:.15,step:.001},carThrust:{type:"number",where:"controls",min:1,max:15,step:1},carTurnSpeed:{type:"number",where:"controls",min:.3,max:1.5,step:.1},carBreakStrength:{type:"number",where:"controls",min:.05,max:.3,step:.05},friction:{type:"number",where:"controls",min:.01,max:1,step:.01},maxSpeed:{type:"number",where:"controls",min:3,max:20,step:1}}};G.master.subscribe(({carAmount:n})=>we.controls.cameraFocus.max=n-1);var U=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ae(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var $={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.getEndomorphismMonoid=n.not=n.SK=n.hole=n.pipe=n.untupled=n.tupled=n.absurd=n.decrement=n.increment=n.tuple=n.flow=n.flip=n.constVoid=n.constUndefined=n.constNull=n.constFalse=n.constTrue=n.constant=n.unsafeCoerce=n.identity=n.apply=n.getRing=n.getSemiring=n.getMonoid=n.getSemigroup=n.getBooleanAlgebra=void 0;var t=function(o){return function(){return{meet:function(i,d){return function(y){return o.meet(i(y),d(y))}},join:function(i,d){return function(y){return o.join(i(y),d(y))}},zero:function(){return o.zero},one:function(){return o.one},implies:function(i,d){return function(y){return o.implies(i(y),d(y))}},not:function(i){return function(d){return o.not(i(d))}}}}};n.getBooleanAlgebra=t;var e=function(o){return function(){return{concat:function(i,d){return function(y){return o.concat(i(y),d(y))}}}}};n.getSemigroup=e;var r=function(o){var i=(0,n.getSemigroup)(o);return function(){return{concat:i().concat,empty:function(){return o.empty}}}};n.getMonoid=r;var a=function(o){return{add:function(i,d){return function(y){return o.add(i(y),d(y))}},zero:function(){return o.zero},mul:function(i,d){return function(y){return o.mul(i(y),d(y))}},one:function(){return o.one}}};n.getSemiring=a;var u=function(o){var i=(0,n.getSemiring)(o);return{add:i.add,mul:i.mul,one:i.one,zero:i.zero,sub:function(d,y){return function(N){return o.sub(d(N),y(N))}}}};n.getRing=u;var g=function(o){return function(i){return i(o)}};n.apply=g;function b(o){return o}n.identity=b,n.unsafeCoerce=b;function v(o){return function(){return o}}n.constant=v,n.constTrue=v(!0),n.constFalse=v(!1),n.constNull=v(null),n.constUndefined=v(void 0),n.constVoid=n.constUndefined;function _(o){return function(){for(var i=[],d=0;d<arguments.length;d++)i[d]=arguments[d];return i.length>1?o(i[1],i[0]):function(y){return o(y)(i[0])}}}n.flip=_;function S(o,i,d,y,N,j,K,z,un){switch(arguments.length){case 1:return o;case 2:return function(){return i(o.apply(this,arguments))};case 3:return function(){return d(i(o.apply(this,arguments)))};case 4:return function(){return y(d(i(o.apply(this,arguments))))};case 5:return function(){return N(y(d(i(o.apply(this,arguments)))))};case 6:return function(){return j(N(y(d(i(o.apply(this,arguments))))))};case 7:return function(){return K(j(N(y(d(i(o.apply(this,arguments)))))))};case 8:return function(){return z(K(j(N(y(d(i(o.apply(this,arguments))))))))};case 9:return function(){return un(z(K(j(N(y(d(i(o.apply(this,arguments)))))))))}}}n.flow=S;function I(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];return o}n.tuple=I;function R(o){return o+1}n.increment=R;function E(o){return o-1}n.decrement=E;function M(o){throw new Error("Called `absurd` function which should be uncallable")}n.absurd=M;function F(o){return function(i){return o.apply(void 0,i)}}n.tupled=F;function D(o){return function(){for(var i=[],d=0;d<arguments.length;d++)i[d]=arguments[d];return o(i)}}n.untupled=D;function X(o,i,d,y,N,j,K,z,un){switch(arguments.length){case 1:return o;case 2:return i(o);case 3:return d(i(o));case 4:return y(d(i(o)));case 5:return N(y(d(i(o))));case 6:return j(N(y(d(i(o)))));case 7:return K(j(N(y(d(i(o))))));case 8:return z(K(j(N(y(d(i(o)))))));case 9:return un(z(K(j(N(y(d(i(o))))))));default:{for(var nn=arguments[0],tn=1;tn<arguments.length;tn++)nn=arguments[tn](nn);return nn}}}n.pipe=X,n.hole=M;var O=function(o,i){return i};n.SK=O;function A(o){return function(i){return!o(i)}}n.not=A;var L=function(){return{concat:function(o,i){return S(o,i)},empty:b}};n.getEndomorphismMonoid=L})($);const Ee=Ae($),Oe=Re({__proto__:null,default:Ee},[$]);var jt={},Dt={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.eqDate=n.eqNumber=n.eqString=n.eqBoolean=n.eq=n.strictEqual=n.getStructEq=n.getTupleEq=n.Contravariant=n.getMonoid=n.getSemigroup=n.eqStrict=n.URI=n.contramap=n.tuple=n.struct=n.fromEquals=void 0;var t=$,e=function(S){return{equals:function(I,R){return I===R||S(I,R)}}};n.fromEquals=e;var r=function(S){return(0,n.fromEquals)(function(I,R){for(var E in S)if(!S[E].equals(I[E],R[E]))return!1;return!0})};n.struct=r;var a=function(){for(var S=[],I=0;I<arguments.length;I++)S[I]=arguments[I];return(0,n.fromEquals)(function(R,E){return S.every(function(M,F){return M.equals(R[F],E[F])})})};n.tuple=a;var u=function(S,I){return(0,t.pipe)(S,(0,n.contramap)(I))},g=function(S){return function(I){return(0,n.fromEquals)(function(R,E){return I.equals(S(R),S(E))})}};n.contramap=g,n.URI="Eq",n.eqStrict={equals:function(S,I){return S===I}};var b={equals:function(){return!0}},v=function(){return{concat:function(S,I){return(0,n.fromEquals)(function(R,E){return S.equals(R,E)&&I.equals(R,E)})}}};n.getSemigroup=v;var _=function(){return{concat:(0,n.getSemigroup)().concat,empty:b}};n.getMonoid=_,n.Contravariant={URI:n.URI,contramap:u},n.getTupleEq=n.tuple,n.getStructEq=n.struct,n.strictEqual=n.eqStrict.equals,n.eq=n.Contravariant,n.eqBoolean=n.eqStrict,n.eqString=n.eqStrict,n.eqNumber=n.eqStrict,n.eqDate={equals:function(S,I){return S.valueOf()===I.valueOf()}}})(Dt);(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.ordDate=n.ordNumber=n.ordString=n.ordBoolean=n.ord=n.getDualOrd=n.getTupleOrd=n.between=n.clamp=n.max=n.min=n.geq=n.leq=n.gt=n.lt=n.equals=n.trivial=n.Contravariant=n.getMonoid=n.getSemigroup=n.URI=n.contramap=n.reverse=n.tuple=n.fromCompare=n.equalsDefault=void 0;var t=Dt,e=$,r=function(i){return function(d,y){return d===y||i(d,y)===0}};n.equalsDefault=r;var a=function(i){return{equals:(0,n.equalsDefault)(i),compare:function(d,y){return d===y?0:i(d,y)}}};n.fromCompare=a;var u=function(){for(var i=[],d=0;d<arguments.length;d++)i[d]=arguments[d];return(0,n.fromCompare)(function(y,N){for(var j=0;j<i.length-1;j++){var K=i[j].compare(y[j],N[j]);if(K!==0)return K}return i[j].compare(y[j],N[j])})};n.tuple=u;var g=function(i){return(0,n.fromCompare)(function(d,y){return i.compare(y,d)})};n.reverse=g;var b=function(i,d){return(0,e.pipe)(i,(0,n.contramap)(d))},v=function(i){return function(d){return(0,n.fromCompare)(function(y,N){return d.compare(i(y),i(N))})}};n.contramap=v,n.URI="Ord";var _=function(){return{concat:function(i,d){return(0,n.fromCompare)(function(y,N){var j=i.compare(y,N);return j!==0?j:d.compare(y,N)})}}};n.getSemigroup=_;var S=function(){return{concat:(0,n.getSemigroup)().concat,empty:(0,n.fromCompare)(function(){return 0})}};n.getMonoid=S,n.Contravariant={URI:n.URI,contramap:b},n.trivial={equals:e.constTrue,compare:(0,e.constant)(0)};var I=function(i){return function(d){return function(y){return y===d||i.compare(y,d)===0}}};n.equals=I;var R=function(i){return function(d,y){return i.compare(d,y)===-1}};n.lt=R;var E=function(i){return function(d,y){return i.compare(d,y)===1}};n.gt=E;var M=function(i){return function(d,y){return i.compare(d,y)!==1}};n.leq=M;var F=function(i){return function(d,y){return i.compare(d,y)!==-1}};n.geq=F;var D=function(i){return function(d,y){return d===y||i.compare(d,y)<1?d:y}};n.min=D;var X=function(i){return function(d,y){return d===y||i.compare(d,y)>-1?d:y}};n.max=X;var O=function(i){var d=(0,n.min)(i),y=(0,n.max)(i);return function(N,j){return function(K){return y(d(K,j),N)}}};n.clamp=O;var A=function(i){var d=(0,n.lt)(i),y=(0,n.gt)(i);return function(N,j){return function(K){return!(d(K,N)||y(K,j))}}};n.between=A,n.getTupleOrd=n.tuple,n.getDualOrd=n.reverse,n.ord=n.Contravariant;function L(i,d){return i<d?-1:i>d?1:0}var o={equals:t.eqStrict.equals,compare:L};n.ordBoolean=o,n.ordString=o,n.ordNumber=o,n.ordDate=(0,e.pipe)(n.ordNumber,(0,n.contramap)(function(i){return i.valueOf()}))})(jt);var St={},ln={},Y={},T={},Pe=U&&U.__spreadArray||function(n,t,e){if(e||arguments.length===2)for(var r=0,a=t.length,u;r<a;r++)(u||!(r in t))&&(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))};Object.defineProperty(T,"__esModule",{value:!0});T.fromReadonlyNonEmptyArray=T.has=T.emptyRecord=T.emptyReadonlyArray=T.tail=T.head=T.isNonEmpty=T.singleton=T.right=T.left=T.isRight=T.isLeft=T.some=T.none=T.isSome=T.isNone=void 0;var Ue=function(n){return n._tag==="None"};T.isNone=Ue;var Ne=function(n){return n._tag==="Some"};T.isSome=Ne;T.none={_tag:"None"};var se=function(n){return{_tag:"Some",value:n}};T.some=se;var Te=function(n){return n._tag==="Left"};T.isLeft=Te;var Fe=function(n){return n._tag==="Right"};T.isRight=Fe;var Le=function(n){return{_tag:"Left",left:n}};T.left=Le;var We=function(n){return{_tag:"Right",right:n}};T.right=We;var qe=function(n){return[n]};T.singleton=qe;var Ce=function(n){return n.length>0};T.isNonEmpty=Ce;var je=function(n){return n[0]};T.head=je;var De=function(n){return n.slice(1)};T.tail=De;T.emptyReadonlyArray=[];T.emptyRecord={};T.has=Object.prototype.hasOwnProperty;var Ke=function(n){return Pe([n[0]],n.slice(1),!0)};T.fromReadonlyNonEmptyArray=Ke;var Be=U&&U.__createBinding||(Object.create?function(n,t,e,r){r===void 0&&(r=e);var a=Object.getOwnPropertyDescriptor(t,e);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(n,r,a)}:function(n,t,e,r){r===void 0&&(r=e),n[r]=t[e]}),Ve=U&&U.__setModuleDefault||(Object.create?function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}:function(n,t){n.default=t}),Je=U&&U.__importStar||function(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var e in n)e!=="default"&&Object.prototype.hasOwnProperty.call(n,e)&&Be(t,n,e);return Ve(t,n),t};Object.defineProperty(Y,"__esModule",{value:!0});var Un=Y.sequenceS=Mt=Y.sequenceT=Y.getApplySemigroup=Y.apS=Y.apSecond=Y.apFirst=Y.ap=void 0,Ye=$,Ze=Je(T);function Ge(n,t){return function(e){return function(r){return n.ap(n.map(r,function(a){return function(u){return t.ap(a,u)}}),e)}}}Y.ap=Ge;function He(n){return function(t){return function(e){return n.ap(n.map(e,function(r){return function(){return r}}),t)}}}Y.apFirst=He;function Xe(n){return function(t){return function(e){return n.ap(n.map(e,function(){return function(r){return r}}),t)}}}Y.apSecond=Xe;function $e(n){return function(t,e){return function(r){return n.ap(n.map(r,function(a){return function(u){var g;return Object.assign({},a,(g={},g[t]=u,g))}}),e)}}}Y.apS=$e;function Qe(n){return function(t){return{concat:function(e,r){return n.ap(n.map(e,function(a){return function(u){return t.concat(a,u)}}),r)}}}}Y.getApplySemigroup=Qe;function Rt(n,t,e){return function(r){for(var a=Array(e.length+1),u=0;u<e.length;u++)a[u]=e[u];return a[e.length]=r,t===0?n.apply(null,a):Rt(n,t-1,a)}}var ft={1:function(n){return[n]},2:function(n){return function(t){return[n,t]}},3:function(n){return function(t){return function(e){return[n,t,e]}}},4:function(n){return function(t){return function(e){return function(r){return[n,t,e,r]}}}},5:function(n){return function(t){return function(e){return function(r){return function(a){return[n,t,e,r,a]}}}}}};function pe(n){return Ze.has.call(ft,n)||(ft[n]=Rt(Ye.tuple,n-1,[])),ft[n]}function ke(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=t.length,a=pe(r),u=n.map(t[0],a),g=1;g<r;g++)u=n.ap(u,t[g]);return u}}var Mt=Y.sequenceT=ke;function ze(n){var t=n.length;switch(t){case 1:return function(e){var r;return r={},r[n[0]]=e,r};case 2:return function(e){return function(r){var a;return a={},a[n[0]]=e,a[n[1]]=r,a}};case 3:return function(e){return function(r){return function(a){var u;return u={},u[n[0]]=e,u[n[1]]=r,u[n[2]]=a,u}}};case 4:return function(e){return function(r){return function(a){return function(u){var g;return g={},g[n[0]]=e,g[n[1]]=r,g[n[2]]=a,g[n[3]]=u,g}}}};case 5:return function(e){return function(r){return function(a){return function(u){return function(g){var b;return b={},b[n[0]]=e,b[n[1]]=r,b[n[2]]=a,b[n[3]]=u,b[n[4]]=g,b}}}}};default:return Rt(function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];for(var a={},u=0;u<t;u++)a[n[u]]=e[u];return a},t-1,[])}}function xe(n){return function(t){for(var e=Object.keys(t),r=e.length,a=ze(e),u=n.map(t[e[0]],a),g=1;g<r;g++)u=n.ap(u,t[e[g]]);return u}}Un=Y.sequenceS=xe;var H={};Object.defineProperty(H,"__esModule",{value:!0});H.getFunctorComposition=H.let=H.bindTo=H.flap=H.map=void 0;var nr=$;function Kt(n,t){return function(e){return function(r){return n.map(r,function(a){return t.map(a,e)})}}}H.map=Kt;function tr(n){return function(t){return function(e){return n.map(e,function(r){return r(t)})}}}H.flap=tr;function er(n){return function(t){return function(e){return n.map(e,function(r){var a;return a={},a[t]=r,a})}}}H.bindTo=er;function rr(n){return function(t,e){return function(r){return n.map(r,function(a){var u;return Object.assign({},a,(u={},u[t]=e(a),u))})}}}H.let=rr;function ar(n,t){var e=Kt(n,t);return{map:function(r,a){return(0,nr.pipe)(r,e(a))}}}H.getFunctorComposition=ar;Object.defineProperty(ln,"__esModule",{value:!0});ln.getApplicativeComposition=ln.getApplicativeMonoid=void 0;var Bt=Y,ir=$,ur=H;function cr(n){var t=(0,Bt.getApplySemigroup)(n);return function(e){return{concat:t(e).concat,empty:n.of(e.empty)}}}ln.getApplicativeMonoid=cr;function lr(n,t){var e=(0,ur.getFunctorComposition)(n,t).map,r=(0,Bt.ap)(n,t);return{map:e,of:function(a){return n.of(t.of(a))},ap:function(a,u){return(0,ir.pipe)(a,r(u))}}}ln.getApplicativeComposition=lr;var an={};Object.defineProperty(an,"__esModule",{value:!0});an.bind=an.chainFirst=void 0;function fr(n){return function(t){return function(e){return n.chain(e,function(r){return n.map(t(r),function(){return r})})}}}an.chainFirst=fr;function or(n){return function(t,e){return function(r){return n.chain(r,function(a){return n.map(e(a),function(u){var g;return Object.assign({},a,(g={},g[t]=u,g))})})}}}an.bind=or;var Nn={};Object.defineProperty(Nn,"__esModule",{value:!0});Nn.tailRec=void 0;var hr=function(n,t){for(var e=t(n);e._tag==="Left";)e=t(e.left);return e.right};Nn.tailRec=hr;var J={},dr=U&&U.__createBinding||(Object.create?function(n,t,e,r){r===void 0&&(r=e);var a=Object.getOwnPropertyDescriptor(t,e);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(n,r,a)}:function(n,t,e,r){r===void 0&&(r=e),n[r]=t[e]}),gr=U&&U.__setModuleDefault||(Object.create?function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}:function(n,t){n.default=t}),mr=U&&U.__importStar||function(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var e in n)e!=="default"&&Object.prototype.hasOwnProperty.call(n,e)&&dr(t,n,e);return gr(t,n),t};Object.defineProperty(J,"__esModule",{value:!0});J.filterOrElse=J.chainFirstEitherK=J.chainEitherK=J.fromEitherK=J.chainOptionK=J.fromOptionK=J.fromPredicate=J.fromOption=void 0;var vr=an,It=$,mn=mr(T);function Vt(n){return function(t){return function(e){return n.fromEither(mn.isNone(e)?mn.left(t()):mn.right(e.value))}}}J.fromOption=Vt;function yr(n){return function(t,e){return function(r){return n.fromEither(t(r)?mn.right(r):mn.left(e(r)))}}}J.fromPredicate=yr;function Jt(n){var t=Vt(n);return function(e){var r=t(e);return function(a){return(0,It.flow)(a,r)}}}J.fromOptionK=Jt;function br(n,t){var e=Jt(n);return function(r){var a=e(r);return function(u){return function(g){return t.chain(g,a(u))}}}}J.chainOptionK=br;function wt(n){return function(t){return(0,It.flow)(t,n.fromEither)}}J.fromEitherK=wt;function _r(n,t){var e=wt(n);return function(r){return function(a){return t.chain(a,e(r))}}}J.chainEitherK=_r;function Sr(n,t){return(0,It.flow)(wt(n),(0,vr.chainFirst)(t))}J.chainFirstEitherK=Sr;function Rr(n,t){return function(e,r){return function(a){return t.chain(a,function(u){return n.fromEither(e(u)?mn.right(u):mn.left(r(u)))})}}}J.filterOrElse=Rr;var At={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.right=n.left=n.flap=n.Functor=n.Bifunctor=n.URI=n.bimap=n.mapLeft=n.map=n.separated=void 0;var t=$,e=H,r=function(R,E){return{left:R,right:E}};n.separated=r;var a=function(R,E){return(0,t.pipe)(R,(0,n.map)(E))},u=function(R,E){return(0,t.pipe)(R,(0,n.mapLeft)(E))},g=function(R,E,M){return(0,t.pipe)(R,(0,n.bimap)(E,M))},b=function(R){return function(E){return(0,n.separated)((0,n.left)(E),R((0,n.right)(E)))}};n.map=b;var v=function(R){return function(E){return(0,n.separated)(R((0,n.left)(E)),(0,n.right)(E))}};n.mapLeft=v;var _=function(R,E){return function(M){return(0,n.separated)(R((0,n.left)(M)),E((0,n.right)(M)))}};n.bimap=_,n.URI="Separated",n.Bifunctor={URI:n.URI,mapLeft:u,bimap:g},n.Functor={URI:n.URI,map:a},n.flap=(0,e.flap)(n.Functor);var S=function(R){return R.left};n.left=S;var I=function(R){return R.right};n.right=I})(At);var rn={},Mr=U&&U.__createBinding||(Object.create?function(n,t,e,r){r===void 0&&(r=e);var a=Object.getOwnPropertyDescriptor(t,e);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(n,r,a)}:function(n,t,e,r){r===void 0&&(r=e),n[r]=t[e]}),Ir=U&&U.__setModuleDefault||(Object.create?function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}:function(n,t){n.default=t}),wr=U&&U.__importStar||function(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var e in n)e!=="default"&&Object.prototype.hasOwnProperty.call(n,e)&&Mr(t,n,e);return Ir(t,n),t};Object.defineProperty(rn,"__esModule",{value:!0});rn.filterE=rn.witherDefault=rn.wiltDefault=void 0;var Nt=wr(T);function Ar(n,t){return function(e){var r=n.traverse(e);return function(a,u){return e.map(r(a,u),t.separate)}}}rn.wiltDefault=Ar;function Er(n,t){return function(e){var r=n.traverse(e);return function(a,u){return e.map(r(a,u),t.compact)}}}rn.witherDefault=Er;function Or(n){return function(t){var e=n.wither(t);return function(r){return function(a){return e(a,function(u){return t.map(r(u),function(g){return g?Nt.some(u):Nt.none})})}}}}rn.filterE=Or;(function(n){var t=U&&U.__createBinding||(Object.create?function(f,c,m,q){q===void 0&&(q=m);var Z=Object.getOwnPropertyDescriptor(c,m);(!Z||("get"in Z?!c.__esModule:Z.writable||Z.configurable))&&(Z={enumerable:!0,get:function(){return c[m]}}),Object.defineProperty(f,q,Z)}:function(f,c,m,q){q===void 0&&(q=m),f[q]=c[m]}),e=U&&U.__setModuleDefault||(Object.create?function(f,c){Object.defineProperty(f,"default",{enumerable:!0,value:c})}:function(f,c){f.default=c}),r=U&&U.__importStar||function(f){if(f&&f.__esModule)return f;var c={};if(f!=null)for(var m in f)m!=="default"&&Object.prototype.hasOwnProperty.call(f,m)&&t(c,f,m);return e(c,f),c};Object.defineProperty(n,"__esModule",{value:!0}),n.fold=n.match=n.foldW=n.matchW=n.isRight=n.isLeft=n.fromOption=n.fromPredicate=n.FromEither=n.MonadThrow=n.throwError=n.ChainRec=n.Extend=n.extend=n.Alt=n.alt=n.altW=n.Bifunctor=n.mapLeft=n.bimap=n.Traversable=n.sequence=n.traverse=n.Foldable=n.reduceRight=n.foldMap=n.reduce=n.Monad=n.Chain=n.chain=n.chainW=n.Applicative=n.Apply=n.ap=n.apW=n.Pointed=n.of=n.Functor=n.map=n.getAltValidation=n.getApplicativeValidation=n.getWitherable=n.getFilterable=n.getCompactable=n.getSemigroup=n.getEq=n.getShow=n.URI=n.right=n.left=void 0,n.getValidation=n.getValidationMonoid=n.getValidationSemigroup=n.getApplyMonoid=n.getApplySemigroup=n.either=n.stringifyJSON=n.parseJSON=n.sequenceArray=n.traverseArray=n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex=n.traverseReadonlyNonEmptyArrayWithIndex=n.ApT=n.apSW=n.apS=n.bindW=n.bind=n.let=n.bindTo=n.Do=n.exists=n.elem=n.toError=n.toUnion=n.chainNullableK=n.fromNullableK=n.tryCatchK=n.tryCatch=n.fromNullable=n.orElse=n.orElseW=n.swap=n.filterOrElseW=n.filterOrElse=n.chainOptionK=n.fromOptionK=n.duplicate=n.flatten=n.flattenW=n.chainFirstW=n.chainFirst=n.apSecondW=n.apSecond=n.apFirstW=n.apFirst=n.flap=n.getOrElse=n.getOrElseW=void 0;var a=ln,u=Y,g=an,b=Nn,v=J,_=$,S=H,I=r(T),R=At,E=rn;n.left=I.left,n.right=I.right;var M=function(f,c){return(0,_.pipe)(f,(0,n.map)(c))},F=function(f,c){return(0,_.pipe)(f,(0,n.ap)(c))},D=function(f,c){return(0,_.pipe)(f,(0,n.chain)(c))},X=function(f,c,m){return(0,_.pipe)(f,(0,n.reduce)(c,m))},O=function(f){return function(c,m){var q=(0,n.foldMap)(f);return(0,_.pipe)(c,q(m))}},A=function(f,c,m){return(0,_.pipe)(f,(0,n.reduceRight)(c,m))},L=function(f){var c=(0,n.traverse)(f);return function(m,q){return(0,_.pipe)(m,c(q))}},o=function(f,c,m){return(0,_.pipe)(f,(0,n.bimap)(c,m))},i=function(f,c){return(0,_.pipe)(f,(0,n.mapLeft)(c))},d=function(f,c){return(0,_.pipe)(f,(0,n.alt)(c))},y=function(f,c){return(0,_.pipe)(f,(0,n.extend)(c))},N=function(f,c){return(0,b.tailRec)(c(f),function(m){return(0,n.isLeft)(m)?(0,n.right)((0,n.left)(m.left)):(0,n.isLeft)(m.right)?(0,n.left)(c(m.right.left)):(0,n.right)((0,n.right)(m.right.right))})};n.URI="Either";var j=function(f,c){return{show:function(m){return(0,n.isLeft)(m)?"left(".concat(f.show(m.left),")"):"right(".concat(c.show(m.right),")")}}};n.getShow=j;var K=function(f,c){return{equals:function(m,q){return m===q||((0,n.isLeft)(m)?(0,n.isLeft)(q)&&f.equals(m.left,q.left):(0,n.isRight)(q)&&c.equals(m.right,q.right))}}};n.getEq=K;var z=function(f){return{concat:function(c,m){return(0,n.isLeft)(m)?c:(0,n.isLeft)(c)?m:(0,n.right)(f.concat(c.right,m.right))}}};n.getSemigroup=z;var un=function(f){var c=(0,n.left)(f.empty);return{URI:n.URI,_E:void 0,compact:function(m){return(0,n.isLeft)(m)?m:m.right._tag==="None"?c:(0,n.right)(m.right.value)},separate:function(m){return(0,n.isLeft)(m)?(0,R.separated)(m,m):(0,n.isLeft)(m.right)?(0,R.separated)((0,n.right)(m.right.left),c):(0,R.separated)(c,(0,n.right)(m.right.right))}}};n.getCompactable=un;var nn=function(f){var c=(0,n.left)(f.empty),m=(0,n.getCompactable)(f),q=m.compact,Z=m.separate,fn=function(B,l){return(0,n.isLeft)(B)||l(B.right)?B:c},lt=function(B,l){return(0,n.isLeft)(B)?(0,R.separated)(B,B):l(B.right)?(0,R.separated)(c,(0,n.right)(B.right)):(0,R.separated)((0,n.right)(B.right),c)};return{URI:n.URI,_E:void 0,map:M,compact:q,separate:Z,filter:fn,filterMap:function(B,l){if((0,n.isLeft)(B))return B;var h=l(B.right);return h._tag==="None"?c:(0,n.right)(h.value)},partition:lt,partitionMap:function(B,l){if((0,n.isLeft)(B))return(0,R.separated)(B,B);var h=l(B.right);return(0,n.isLeft)(h)?(0,R.separated)((0,n.right)(h.left),c):(0,R.separated)(c,(0,n.right)(h.right))}}};n.getFilterable=nn;var tn=function(f){var c=(0,n.getFilterable)(f),m=(0,n.getCompactable)(f);return{URI:n.URI,_E:void 0,map:M,compact:c.compact,separate:c.separate,filter:c.filter,filterMap:c.filterMap,partition:c.partition,partitionMap:c.partitionMap,traverse:L,sequence:n.sequence,reduce:X,foldMap:O,reduceRight:A,wither:(0,E.witherDefault)(n.Traversable,m),wilt:(0,E.wiltDefault)(n.Traversable,m)}};n.getWitherable=tn;var Tn=function(f){return{URI:n.URI,_E:void 0,map:M,ap:function(c,m){return(0,n.isLeft)(c)?(0,n.isLeft)(m)?(0,n.left)(f.concat(c.left,m.left)):c:(0,n.isLeft)(m)?m:(0,n.right)(c.right(m.right))},of:n.of}};n.getApplicativeValidation=Tn;var Fn=function(f){return{URI:n.URI,_E:void 0,map:M,alt:function(c,m){if((0,n.isRight)(c))return c;var q=m();return(0,n.isLeft)(q)?(0,n.left)(f.concat(c.left,q.left)):q}}};n.getAltValidation=Fn;var Ln=function(f){return function(c){return(0,n.isLeft)(c)?c:(0,n.right)(f(c.right))}};n.map=Ln,n.Functor={URI:n.URI,map:M},n.of=n.right,n.Pointed={URI:n.URI,of:n.of};var Wn=function(f){return function(c){return(0,n.isLeft)(c)?c:(0,n.isLeft)(f)?f:(0,n.right)(c.right(f.right))}};n.apW=Wn,n.ap=n.apW,n.Apply={URI:n.URI,map:M,ap:F},n.Applicative={URI:n.URI,map:M,ap:F,of:n.of};var qn=function(f){return function(c){return(0,n.isLeft)(c)?c:f(c.right)}};n.chainW=qn,n.chain=n.chainW,n.Chain={URI:n.URI,map:M,ap:F,chain:D},n.Monad={URI:n.URI,map:M,ap:F,of:n.of,chain:D};var Cn=function(f,c){return function(m){return(0,n.isLeft)(m)?f:c(f,m.right)}};n.reduce=Cn;var jn=function(f){return function(c){return function(m){return(0,n.isLeft)(m)?f.empty:c(m.right)}}};n.foldMap=jn;var Dn=function(f,c){return function(m){return(0,n.isLeft)(m)?f:c(m.right,f)}};n.reduceRight=Dn,n.Foldable={URI:n.URI,reduce:X,foldMap:O,reduceRight:A};var Kn=function(f){return function(c){return function(m){return(0,n.isLeft)(m)?f.of((0,n.left)(m.left)):f.map(c(m.right),n.right)}}};n.traverse=Kn;var Bn=function(f){return function(c){return(0,n.isLeft)(c)?f.of((0,n.left)(c.left)):f.map(c.right,n.right)}};n.sequence=Bn,n.Traversable={URI:n.URI,map:M,reduce:X,foldMap:O,reduceRight:A,traverse:L,sequence:n.sequence};var Vn=function(f,c){return function(m){return(0,n.isLeft)(m)?(0,n.left)(f(m.left)):(0,n.right)(c(m.right))}};n.bimap=Vn;var Jn=function(f){return function(c){return(0,n.isLeft)(c)?(0,n.left)(f(c.left)):c}};n.mapLeft=Jn,n.Bifunctor={URI:n.URI,bimap:o,mapLeft:i};var Yn=function(f){return function(c){return(0,n.isLeft)(c)?f():c}};n.altW=Yn,n.alt=n.altW,n.Alt={URI:n.URI,map:M,alt:d};var Zn=function(f){return function(c){return(0,n.isLeft)(c)?c:(0,n.right)(f(c))}};n.extend=Zn,n.Extend={URI:n.URI,map:M,extend:y},n.ChainRec={URI:n.URI,map:M,ap:F,chain:D,chainRec:N},n.throwError=n.left,n.MonadThrow={URI:n.URI,map:M,ap:F,of:n.of,chain:D,throwError:n.throwError},n.FromEither={URI:n.URI,fromEither:_.identity},n.fromPredicate=(0,v.fromPredicate)(n.FromEither),n.fromOption=(0,v.fromOption)(n.FromEither),n.isLeft=I.isLeft,n.isRight=I.isRight;var Gn=function(f,c){return function(m){return(0,n.isLeft)(m)?f(m.left):c(m.right)}};n.matchW=Gn,n.foldW=n.matchW,n.match=n.matchW,n.fold=n.match;var Hn=function(f){return function(c){return(0,n.isLeft)(c)?f(c.left):c.right}};n.getOrElseW=Hn,n.getOrElse=n.getOrElseW,n.flap=(0,S.flap)(n.Functor),n.apFirst=(0,u.apFirst)(n.Apply),n.apFirstW=n.apFirst,n.apSecond=(0,u.apSecond)(n.Apply),n.apSecondW=n.apSecond,n.chainFirst=(0,g.chainFirst)(n.Chain),n.chainFirstW=n.chainFirst,n.flattenW=(0,n.chainW)(_.identity),n.flatten=n.flattenW,n.duplicate=(0,n.extend)(_.identity),n.fromOptionK=(0,v.fromOptionK)(n.FromEither),n.chainOptionK=(0,v.chainOptionK)(n.FromEither,n.Chain),n.filterOrElse=(0,v.filterOrElse)(n.FromEither,n.Chain),n.filterOrElseW=n.filterOrElse;var Xn=function(f){return(0,n.isLeft)(f)?(0,n.right)(f.left):(0,n.left)(f.right)};n.swap=Xn;var $n=function(f){return function(c){return(0,n.isLeft)(c)?f(c.left):c}};n.orElseW=$n,n.orElse=n.orElseW;var Qn=function(f){return function(c){return c==null?(0,n.left)(f):(0,n.right)(c)}};n.fromNullable=Qn;var pn=function(f,c){try{return(0,n.right)(f())}catch(m){return(0,n.left)(c(m))}};n.tryCatch=pn;var kn=function(f,c){return function(){for(var m=[],q=0;q<arguments.length;q++)m[q]=arguments[q];return(0,n.tryCatch)(function(){return f.apply(void 0,m)},c)}};n.tryCatchK=kn;var _n=function(f){var c=(0,n.fromNullable)(f);return function(m){return(0,_.flow)(m,c)}};n.fromNullableK=_n;var Sn=function(f){var c=(0,n.fromNullableK)(f);return function(m){return(0,n.chain)(c(m))}};n.chainNullableK=Sn,n.toUnion=(0,n.foldW)(_.identity,_.identity);function zn(f){return f instanceof Error?f:new Error(String(f))}n.toError=zn;function Mn(f){return function(c,m){if(m===void 0){var q=Mn(f);return function(Z){return q(c,Z)}}return(0,n.isLeft)(m)?!1:f.equals(c,m.right)}}n.elem=Mn;var xn=function(f){return function(c){return(0,n.isLeft)(c)?!1:f(c.right)}};n.exists=xn,n.Do=(0,n.of)(I.emptyRecord),n.bindTo=(0,S.bindTo)(n.Functor);var nt=(0,S.let)(n.Functor);n.let=nt,n.bind=(0,g.bind)(n.Chain),n.bindW=n.bind,n.apS=(0,u.apS)(n.Apply),n.apSW=n.apS,n.ApT=(0,n.of)(I.emptyReadonlyArray);var tt=function(f){return function(c){var m=f(0,I.head(c));if((0,n.isLeft)(m))return m;for(var q=[m.right],Z=1;Z<c.length;Z++){var fn=f(Z,c[Z]);if((0,n.isLeft)(fn))return fn;q.push(fn.right)}return(0,n.right)(q)}};n.traverseReadonlyNonEmptyArrayWithIndex=tt;var et=function(f){var c=(0,n.traverseReadonlyNonEmptyArrayWithIndex)(f);return function(m){return I.isNonEmpty(m)?c(m):n.ApT}};n.traverseReadonlyArrayWithIndex=et,n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex;var rt=function(f){return(0,n.traverseReadonlyArrayWithIndex)(function(c,m){return f(m)})};n.traverseArray=rt,n.sequenceArray=(0,n.traverseArray)(_.identity);function at(f,c){return(0,n.tryCatch)(function(){return JSON.parse(f)},c)}n.parseJSON=at;var it=function(f,c){return(0,n.tryCatch)(function(){var m=JSON.stringify(f);if(typeof m!="string")throw new Error("Converting unsupported structure to JSON");return m},c)};n.stringifyJSON=it,n.either={URI:n.URI,map:M,of:n.of,ap:F,chain:D,reduce:X,foldMap:O,reduceRight:A,traverse:L,sequence:n.sequence,bimap:o,mapLeft:i,alt:d,extend:y,chainRec:N,throwError:n.throwError},n.getApplySemigroup=(0,u.getApplySemigroup)(n.Apply),n.getApplyMonoid=(0,a.getApplicativeMonoid)(n.Applicative);var ut=function(f,c){return(0,u.getApplySemigroup)((0,n.getApplicativeValidation)(f))(c)};n.getValidationSemigroup=ut;var ct=function(f,c){return(0,a.getApplicativeMonoid)((0,n.getApplicativeValidation)(f))(c)};n.getValidationMonoid=ct;function In(f){var c=(0,n.getApplicativeValidation)(f).ap,m=(0,n.getAltValidation)(f).alt;return{URI:n.URI,_E:void 0,map:M,of:n.of,chain:D,bimap:o,mapLeft:i,reduce:X,foldMap:O,reduceRight:A,extend:y,traverse:L,sequence:n.sequence,chainRec:N,throwError:n.throwError,ap:c,alt:m}}n.getValidation=In})(St);var Et={},Yt={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.and=n.or=n.not=n.Contravariant=n.getMonoidAll=n.getSemigroupAll=n.getMonoidAny=n.getSemigroupAny=n.URI=n.contramap=void 0;var t=$,e=function(I,R){return(0,t.pipe)(I,(0,n.contramap)(R))},r=function(I){return function(R){return(0,t.flow)(I,R)}};n.contramap=r,n.URI="Predicate";var a=function(){return{concat:function(I,R){return(0,t.pipe)(I,(0,n.or)(R))}}};n.getSemigroupAny=a;var u=function(){return{concat:(0,n.getSemigroupAny)().concat,empty:t.constFalse}};n.getMonoidAny=u;var g=function(){return{concat:function(I,R){return(0,t.pipe)(I,(0,n.and)(R))}}};n.getSemigroupAll=g;var b=function(){return{concat:(0,n.getSemigroupAll)().concat,empty:t.constTrue}};n.getMonoidAll=b,n.Contravariant={URI:n.URI,contramap:e};var v=function(I){return function(R){return!I(R)}};n.not=v;var _=function(I){return function(R){return function(E){return R(E)||I(E)}}};n.or=_;var S=function(I){return function(R){return function(E){return R(E)&&I(E)}}};n.and=S})(Yt);var Zt={},k={};Object.defineProperty(k,"__esModule",{value:!0});k.concatAll=k.endo=k.filterSecond=k.filterFirst=k.reverse=void 0;var Pr=function(n){return{concat:function(t,e){return n.concat(e,t)}}};k.reverse=Pr;var Ur=function(n){return function(t){return{concat:function(e,r){return n(e)?t.concat(e,r):r}}}};k.filterFirst=Ur;var Nr=function(n){return function(t){return{concat:function(e,r){return n(r)?t.concat(e,r):e}}}};k.filterSecond=Nr;var sr=function(n){return function(t){return{concat:function(e,r){return t.concat(n(e),n(r))}}}};k.endo=sr;var Tr=function(n){return function(t){return function(e){return e.reduce(function(r,a){return n.concat(r,a)},t)}}};k.concatAll=Tr;(function(n){var t=U&&U.__createBinding||(Object.create?function(O,A,L,o){o===void 0&&(o=L);var i=Object.getOwnPropertyDescriptor(A,L);(!i||("get"in i?!A.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return A[L]}}),Object.defineProperty(O,o,i)}:function(O,A,L,o){o===void 0&&(o=L),O[o]=A[L]}),e=U&&U.__setModuleDefault||(Object.create?function(O,A){Object.defineProperty(O,"default",{enumerable:!0,value:A})}:function(O,A){O.default=A}),r=U&&U.__importStar||function(O){if(O&&O.__esModule)return O;var A={};if(O!=null)for(var L in O)L!=="default"&&Object.prototype.hasOwnProperty.call(O,L)&&t(A,O,L);return e(A,O),A};Object.defineProperty(n,"__esModule",{value:!0}),n.semigroupProduct=n.semigroupSum=n.semigroupString=n.getFunctionSemigroup=n.semigroupAny=n.semigroupAll=n.fold=n.getIntercalateSemigroup=n.getMeetSemigroup=n.getJoinSemigroup=n.getDualSemigroup=n.getStructSemigroup=n.getTupleSemigroup=n.getFirstSemigroup=n.getLastSemigroup=n.getObjectSemigroup=n.semigroupVoid=n.concatAll=n.last=n.first=n.intercalate=n.tuple=n.struct=n.reverse=n.constant=n.max=n.min=void 0;var a=$,u=r(T),g=r(k),b=r(jt),v=function(O){return{concat:b.min(O)}};n.min=v;var _=function(O){return{concat:b.max(O)}};n.max=_;var S=function(O){return{concat:function(){return O}}};n.constant=S,n.reverse=g.reverse;var I=function(O){return{concat:function(A,L){var o={};for(var i in O)u.has.call(O,i)&&(o[i]=O[i].concat(A[i],L[i]));return o}}};n.struct=I;var R=function(){for(var O=[],A=0;A<arguments.length;A++)O[A]=arguments[A];return{concat:function(L,o){return O.map(function(i,d){return i.concat(L[d],o[d])})}}};n.tuple=R;var E=function(O){return function(A){return{concat:function(L,o){return A.concat(L,A.concat(O,o))}}}};n.intercalate=E;var M=function(){return{concat:a.identity}};n.first=M;var F=function(){return{concat:function(O,A){return A}}};n.last=F,n.concatAll=g.concatAll,n.semigroupVoid=(0,n.constant)(void 0);var D=function(){return{concat:function(O,A){return Object.assign({},O,A)}}};n.getObjectSemigroup=D,n.getLastSemigroup=n.last,n.getFirstSemigroup=n.first,n.getTupleSemigroup=n.tuple,n.getStructSemigroup=n.struct,n.getDualSemigroup=n.reverse,n.getJoinSemigroup=n.max,n.getMeetSemigroup=n.min,n.getIntercalateSemigroup=n.intercalate;function X(O){var A=(0,n.concatAll)(O);return function(L,o){return o===void 0?A(L):A(L)(o)}}n.fold=X,n.semigroupAll={concat:function(O,A){return O&&A}},n.semigroupAny={concat:function(O,A){return O||A}},n.getFunctionSemigroup=a.getSemigroup,n.semigroupString={concat:function(O,A){return O+A}},n.semigroupSum={concat:function(O,A){return O+A}},n.semigroupProduct={concat:function(O,A){return O*A}}})(Zt);var sn={};Object.defineProperty(sn,"__esModule",{value:!0});sn.guard=void 0;function Fr(n,t){return function(e){return e?t.of(void 0):n.zero()}}sn.guard=Fr;(function(n){var t=U&&U.__createBinding||(Object.create?function(l,h,w,V){V===void 0&&(V=w);var Q=Object.getOwnPropertyDescriptor(h,w);(!Q||("get"in Q?!h.__esModule:Q.writable||Q.configurable))&&(Q={enumerable:!0,get:function(){return h[w]}}),Object.defineProperty(l,V,Q)}:function(l,h,w,V){V===void 0&&(V=w),l[V]=h[w]}),e=U&&U.__setModuleDefault||(Object.create?function(l,h){Object.defineProperty(l,"default",{enumerable:!0,value:h})}:function(l,h){l.default=h}),r=U&&U.__importStar||function(l){if(l&&l.__esModule)return l;var h={};if(l!=null)for(var w in l)w!=="default"&&Object.prototype.hasOwnProperty.call(l,w)&&t(h,l,w);return e(h,l),h};Object.defineProperty(n,"__esModule",{value:!0}),n.fromEither=n.MonadThrow=n.throwError=n.Witherable=n.wilt=n.wither=n.Traversable=n.sequence=n.traverse=n.Filterable=n.partitionMap=n.partition=n.filterMap=n.filter=n.Compactable=n.separate=n.compact=n.Extend=n.extend=n.Alternative=n.guard=n.Zero=n.zero=n.Alt=n.alt=n.altW=n.Foldable=n.reduceRight=n.foldMap=n.reduce=n.Monad=n.Chain=n.chain=n.Applicative=n.Apply=n.ap=n.Pointed=n.of=n.Functor=n.map=n.getMonoid=n.getOrd=n.getEq=n.getShow=n.URI=n.getRight=n.getLeft=n.fromPredicate=n.some=n.none=void 0,n.getLastMonoid=n.getFirstMonoid=n.getApplyMonoid=n.getApplySemigroup=n.option=n.mapNullable=n.getRefinement=n.sequenceArray=n.traverseArray=n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex=n.traverseReadonlyNonEmptyArrayWithIndex=n.ApT=n.apS=n.bind=n.let=n.bindTo=n.Do=n.exists=n.elem=n.toUndefined=n.toNullable=n.chainNullableK=n.fromNullableK=n.tryCatchK=n.tryCatch=n.fromNullable=n.chainFirstEitherK=n.chainEitherK=n.fromEitherK=n.duplicate=n.chainFirst=n.flatten=n.apSecond=n.apFirst=n.flap=n.getOrElse=n.getOrElseW=n.fold=n.match=n.foldW=n.matchW=n.isNone=n.isSome=n.FromEither=void 0;var a=ln,u=Y,g=an,b=J,v=$,_=H,S=r(T),I=Yt,R=Zt,E=At,M=rn,F=sn;n.none=S.none,n.some=S.some;function D(l){return function(h){return l(h)?(0,n.some)(h):n.none}}n.fromPredicate=D;var X=function(l){return l._tag==="Right"?n.none:(0,n.some)(l.left)};n.getLeft=X;var O=function(l){return l._tag==="Left"?n.none:(0,n.some)(l.right)};n.getRight=O;var A=function(l,h){return(0,v.pipe)(l,(0,n.map)(h))},L=function(l,h){return(0,v.pipe)(l,(0,n.ap)(h))},o=function(l,h){return(0,v.pipe)(l,(0,n.chain)(h))},i=function(l,h,w){return(0,v.pipe)(l,(0,n.reduce)(h,w))},d=function(l){var h=(0,n.foldMap)(l);return function(w,V){return(0,v.pipe)(w,h(V))}},y=function(l,h,w){return(0,v.pipe)(l,(0,n.reduceRight)(h,w))},N=function(l){var h=(0,n.traverse)(l);return function(w,V){return(0,v.pipe)(w,h(V))}},j=function(l,h){return(0,v.pipe)(l,(0,n.alt)(h))},K=function(l,h){return(0,v.pipe)(l,(0,n.filter)(h))},z=function(l,h){return(0,v.pipe)(l,(0,n.filterMap)(h))},un=function(l,h){return(0,v.pipe)(l,(0,n.extend)(h))},nn=function(l,h){return(0,v.pipe)(l,(0,n.partition)(h))},tn=function(l,h){return(0,v.pipe)(l,(0,n.partitionMap)(h))};n.URI="Option";var Tn=function(l){return{show:function(h){return(0,n.isNone)(h)?"none":"some(".concat(l.show(h.value),")")}}};n.getShow=Tn;var Fn=function(l){return{equals:function(h,w){return h===w||((0,n.isNone)(h)?(0,n.isNone)(w):(0,n.isNone)(w)?!1:l.equals(h.value,w.value))}}};n.getEq=Fn;var Ln=function(l){return{equals:(0,n.getEq)(l).equals,compare:function(h,w){return h===w?0:(0,n.isSome)(h)?(0,n.isSome)(w)?l.compare(h.value,w.value):1:-1}}};n.getOrd=Ln;var Wn=function(l){return{concat:function(h,w){return(0,n.isNone)(h)?w:(0,n.isNone)(w)?h:(0,n.some)(l.concat(h.value,w.value))},empty:n.none}};n.getMonoid=Wn;var qn=function(l){return function(h){return(0,n.isNone)(h)?n.none:(0,n.some)(l(h.value))}};n.map=qn,n.Functor={URI:n.URI,map:A},n.of=n.some,n.Pointed={URI:n.URI,of:n.of};var Cn=function(l){return function(h){return(0,n.isNone)(h)||(0,n.isNone)(l)?n.none:(0,n.some)(h.value(l.value))}};n.ap=Cn,n.Apply={URI:n.URI,map:A,ap:L},n.Applicative={URI:n.URI,map:A,ap:L,of:n.of};var jn=function(l){return function(h){return(0,n.isNone)(h)?n.none:l(h.value)}};n.chain=jn,n.Chain={URI:n.URI,map:A,ap:L,chain:o},n.Monad={URI:n.URI,map:A,ap:L,of:n.of,chain:o};var Dn=function(l,h){return function(w){return(0,n.isNone)(w)?l:h(l,w.value)}};n.reduce=Dn;var Kn=function(l){return function(h){return function(w){return(0,n.isNone)(w)?l.empty:h(w.value)}}};n.foldMap=Kn;var Bn=function(l,h){return function(w){return(0,n.isNone)(w)?l:h(w.value,l)}};n.reduceRight=Bn,n.Foldable={URI:n.URI,reduce:i,foldMap:d,reduceRight:y};var Vn=function(l){return function(h){return(0,n.isNone)(h)?l():h}};n.altW=Vn,n.alt=n.altW,n.Alt={URI:n.URI,map:A,alt:j};var Jn=function(){return n.none};n.zero=Jn,n.Zero={URI:n.URI,zero:n.zero},n.guard=(0,F.guard)(n.Zero,n.Pointed),n.Alternative={URI:n.URI,map:A,ap:L,of:n.of,alt:j,zero:n.zero};var Yn=function(l){return function(h){return(0,n.isNone)(h)?n.none:(0,n.some)(l(h))}};n.extend=Yn,n.Extend={URI:n.URI,map:A,extend:un},n.compact=(0,n.chain)(v.identity);var Zn=(0,E.separated)(n.none,n.none),Gn=function(l){return(0,n.isNone)(l)?Zn:(0,E.separated)((0,n.getLeft)(l.value),(0,n.getRight)(l.value))};n.separate=Gn,n.Compactable={URI:n.URI,compact:n.compact,separate:n.separate};var Hn=function(l){return function(h){return(0,n.isNone)(h)?n.none:l(h.value)?h:n.none}};n.filter=Hn;var Xn=function(l){return function(h){return(0,n.isNone)(h)?n.none:l(h.value)}};n.filterMap=Xn;var $n=function(l){return function(h){return(0,E.separated)(K(h,(0,I.not)(l)),K(h,l))}};n.partition=$n;var Qn=function(l){return(0,v.flow)((0,n.map)(l),n.separate)};n.partitionMap=Qn,n.Filterable={URI:n.URI,map:A,compact:n.compact,separate:n.separate,filter:K,filterMap:z,partition:nn,partitionMap:tn};var pn=function(l){return function(h){return function(w){return(0,n.isNone)(w)?l.of(n.none):l.map(h(w.value),n.some)}}};n.traverse=pn;var kn=function(l){return function(h){return(0,n.isNone)(h)?l.of(n.none):l.map(h.value,n.some)}};n.sequence=kn,n.Traversable={URI:n.URI,map:A,reduce:i,foldMap:d,reduceRight:y,traverse:N,sequence:n.sequence};var _n=(0,M.witherDefault)(n.Traversable,n.Compactable),Sn=(0,M.wiltDefault)(n.Traversable,n.Compactable),zn=function(l){var h=_n(l);return function(w){return function(V){return h(V,w)}}};n.wither=zn;var Mn=function(l){var h=Sn(l);return function(w){return function(V){return h(V,w)}}};n.wilt=Mn,n.Witherable={URI:n.URI,map:A,reduce:i,foldMap:d,reduceRight:y,traverse:N,sequence:n.sequence,compact:n.compact,separate:n.separate,filter:K,filterMap:z,partition:nn,partitionMap:tn,wither:_n,wilt:Sn};var xn=function(){return n.none};n.throwError=xn,n.MonadThrow={URI:n.URI,map:A,ap:L,of:n.of,chain:o,throwError:n.throwError},n.fromEither=n.getRight,n.FromEither={URI:n.URI,fromEither:n.fromEither},n.isSome=S.isSome;var nt=function(l){return l._tag==="None"};n.isNone=nt;var tt=function(l,h){return function(w){return(0,n.isNone)(w)?l():h(w.value)}};n.matchW=tt,n.foldW=n.matchW,n.match=n.matchW,n.fold=n.match;var et=function(l){return function(h){return(0,n.isNone)(h)?l():h.value}};n.getOrElseW=et,n.getOrElse=n.getOrElseW,n.flap=(0,_.flap)(n.Functor),n.apFirst=(0,u.apFirst)(n.Apply),n.apSecond=(0,u.apSecond)(n.Apply),n.flatten=n.compact,n.chainFirst=(0,g.chainFirst)(n.Chain),n.duplicate=(0,n.extend)(v.identity),n.fromEitherK=(0,b.fromEitherK)(n.FromEither),n.chainEitherK=(0,b.chainEitherK)(n.FromEither,n.Chain),n.chainFirstEitherK=(0,b.chainFirstEitherK)(n.FromEither,n.Chain);var rt=function(l){return l==null?n.none:(0,n.some)(l)};n.fromNullable=rt;var at=function(l){try{return(0,n.some)(l())}catch{return n.none}};n.tryCatch=at;var it=function(l){return function(){for(var h=[],w=0;w<arguments.length;w++)h[w]=arguments[w];return(0,n.tryCatch)(function(){return l.apply(void 0,h)})}};n.tryCatchK=it;var ut=function(l){return(0,v.flow)(l,n.fromNullable)};n.fromNullableK=ut;var ct=function(l){return function(h){return(0,n.isNone)(h)?n.none:(0,n.fromNullable)(l(h.value))}};n.chainNullableK=ct,n.toNullable=(0,n.match)(v.constNull,v.identity),n.toUndefined=(0,n.match)(v.constUndefined,v.identity);function In(l){return function(h,w){if(w===void 0){var V=In(l);return function(Q){return V(h,Q)}}return(0,n.isNone)(w)?!1:l.equals(h,w.value)}}n.elem=In;var f=function(l){return function(h){return(0,n.isNone)(h)?!1:l(h.value)}};n.exists=f,n.Do=(0,n.of)(S.emptyRecord),n.bindTo=(0,_.bindTo)(n.Functor);var c=(0,_.let)(n.Functor);n.let=c,n.bind=(0,g.bind)(n.Chain),n.apS=(0,u.apS)(n.Apply),n.ApT=(0,n.of)(S.emptyReadonlyArray);var m=function(l){return function(h){var w=l(0,S.head(h));if((0,n.isNone)(w))return n.none;for(var V=[w.value],Q=1;Q<h.length;Q++){var Ut=l(Q,h[Q]);if((0,n.isNone)(Ut))return n.none;V.push(Ut.value)}return(0,n.some)(V)}};n.traverseReadonlyNonEmptyArrayWithIndex=m;var q=function(l){var h=(0,n.traverseReadonlyNonEmptyArrayWithIndex)(l);return function(w){return S.isNonEmpty(w)?h(w):n.ApT}};n.traverseReadonlyArrayWithIndex=q,n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex;var Z=function(l){return(0,n.traverseReadonlyArrayWithIndex)(function(h,w){return l(w)})};n.traverseArray=Z,n.sequenceArray=(0,n.traverseArray)(v.identity);function fn(l){return function(h){return(0,n.isSome)(l(h))}}n.getRefinement=fn,n.mapNullable=n.chainNullableK,n.option={URI:n.URI,map:A,of:n.of,ap:L,chain:o,reduce:i,foldMap:d,reduceRight:y,traverse:N,sequence:n.sequence,zero:n.zero,alt:j,extend:un,compact:n.compact,separate:n.separate,filter:K,filterMap:z,partition:nn,partitionMap:tn,wither:_n,wilt:Sn,throwError:n.throwError},n.getApplySemigroup=(0,u.getApplySemigroup)(n.Apply),n.getApplyMonoid=(0,a.getApplicativeMonoid)(n.Applicative);var lt=function(){return(0,n.getMonoid)((0,R.first)())};n.getFirstMonoid=lt;var B=function(){return(0,n.getMonoid)((0,R.last)())};n.getLastMonoid=B})(Et);var Gt={};(function(n){var t=U&&U.__createBinding||(Object.create?function(o,i,d,y){y===void 0&&(y=d);var N=Object.getOwnPropertyDescriptor(i,d);(!N||("get"in N?!i.__esModule:N.writable||N.configurable))&&(N={enumerable:!0,get:function(){return i[d]}}),Object.defineProperty(o,y,N)}:function(o,i,d,y){y===void 0&&(y=d),o[y]=i[d]}),e=U&&U.__setModuleDefault||(Object.create?function(o,i){Object.defineProperty(o,"default",{enumerable:!0,value:i})}:function(o,i){o.default=i}),r=U&&U.__importStar||function(o){if(o&&o.__esModule)return o;var i={};if(o!=null)for(var d in o)d!=="default"&&Object.prototype.hasOwnProperty.call(o,d)&&t(i,o,d);return e(i,o),i};Object.defineProperty(n,"__esModule",{value:!0}),n.getMonoid=n.getSemigroup=n.io=n.sequenceArray=n.traverseArray=n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex=n.traverseReadonlyNonEmptyArrayWithIndex=n.ApT=n.apS=n.bind=n.let=n.bindTo=n.Do=n.FromIO=n.ChainRec=n.MonadIO=n.fromIO=n.chainFirst=n.Monad=n.Chain=n.Applicative=n.apSecond=n.apFirst=n.Apply=n.Pointed=n.flap=n.Functor=n.URI=n.flatten=n.chain=n.of=n.ap=n.map=void 0;var a=ln,u=Y,g=an,b=$,v=H,_=r(T),S=function(o,i){return function(){return i(o())}},I=function(o,i){return function(){return o()(i())}},R=function(o,i){return function(){return i(o())()}},E=function(o,i){return function(){for(var d=i(o)();d._tag==="Left";)d=i(d.left)();return d.right}},M=function(o){return function(i){return S(i,o)}};n.map=M;var F=function(o){return function(i){return I(i,o)}};n.ap=F,n.of=b.constant;var D=function(o){return function(i){return R(i,o)}};n.chain=D,n.flatten=(0,n.chain)(b.identity),n.URI="IO",n.Functor={URI:n.URI,map:S},n.flap=(0,v.flap)(n.Functor),n.Pointed={URI:n.URI,of:n.of},n.Apply={URI:n.URI,map:S,ap:I},n.apFirst=(0,u.apFirst)(n.Apply),n.apSecond=(0,u.apSecond)(n.Apply),n.Applicative={URI:n.URI,map:S,ap:I,of:n.of},n.Chain={URI:n.URI,map:S,ap:I,chain:R},n.Monad={URI:n.URI,map:S,ap:I,of:n.of,chain:R},n.chainFirst=(0,g.chainFirst)(n.Chain),n.fromIO=b.identity,n.MonadIO={URI:n.URI,map:S,ap:I,of:n.of,chain:R,fromIO:n.fromIO},n.ChainRec={URI:n.URI,map:S,ap:I,chain:R,chainRec:E},n.FromIO={URI:n.URI,fromIO:b.identity},n.Do=(0,n.of)(_.emptyRecord),n.bindTo=(0,v.bindTo)(n.Functor);var X=(0,v.let)(n.Functor);n.let=X,n.bind=(0,g.bind)(n.Chain),n.apS=(0,u.apS)(n.Apply),n.ApT=(0,n.of)(_.emptyReadonlyArray);var O=function(o){return function(i){return function(){for(var d=[o(0,_.head(i))()],y=1;y<i.length;y++)d.push(o(y,i[y])());return d}}};n.traverseReadonlyNonEmptyArrayWithIndex=O;var A=function(o){var i=(0,n.traverseReadonlyNonEmptyArrayWithIndex)(o);return function(d){return _.isNonEmpty(d)?i(d):n.ApT}};n.traverseReadonlyArrayWithIndex=A,n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex;var L=function(o){return(0,n.traverseReadonlyArrayWithIndex)(function(i,d){return o(d)})};n.traverseArray=L,n.sequenceArray=(0,n.traverseArray)(b.identity),n.io={URI:n.URI,map:S,of:n.of,ap:I,chain:R,fromIO:n.fromIO,chainRec:E},n.getSemigroup=(0,u.getApplySemigroup)(n.Apply),n.getMonoid=(0,a.getApplicativeMonoid)(n.Applicative)})(Gt);const{pipe:x,flow:Ta,constant:Fa,identity:La,tupled:Wa,constVoid:qa}=Oe;Mt(St.Apply);Mt(Et.Apply);Un(St.Apply);Un(Et.Apply);Un(Gt.Apply);let Ht=.01,ht=5;G.controls.subscribe(({friction:n,maxSpeed:t})=>{Ht=n,ht=t});const Ca=n=>t=>x(n,Lr(t),Wr(t)),Lr=n=>t=>{var _,S;const e=((_=n.physics)==null?void 0:_.mass)??10,r=((S=n.physics)==null?void 0:S.momentum)??{direction:0,magnitude:0},{thrust:a,breaks:u,angle:g}=t,b=a/e,v=Math.max(Math.min(r.magnitude+b,ht),-ht);return n.physics={mass:e,momentum:{...r,magnitude:Math.max(Math.abs(v)-Ht-u,0)*(v<0?-1:1)}},n.angle=(n.angle+g*v+Math.PI*2)%(Math.PI*2),v},Wr=n=>t=>(n.x+=Math.sin(n.angle)*t,n.y-=Math.cos(n.angle)*t,n),W=(n,t,e)=>n+(t-n)*e,Ot=(n,t)=>e=>e==null?t():n(e),qr=(n,t,e,r)=>{const a=(r[0]-e[0])*(n[1]-e[1])-(r[1]-e[1])*(n[0]-e[0]),u=(e[1]-n[1])*(n[0]-t[0])-(e[0]-n[0])*(n[1]-t[1]),g=(r[1]-e[1])*(t[0]-n[0])-(r[0]-e[0])*(t[1]-n[1]);if(g==0)return null;const b=a/g,v=u/g;return b>=0&&b<=1&&v>=0&&v<=1?{position:[W(n[0],t[0],b),W(n[1],t[1],b)],offset:b}:null};let dt=100,bn=5;G.brain.subscribe(({sensorLength:n})=>{dt=n});G.master.subscribe(({gridSize:n})=>{bn=n});const st=(n,t)=>{const r=[Math.floor((n[0]/200+bn)%bn),Math.floor((n[1]/200+bn)%bn)],a=(r[0]+r[1]*bn)*4,u=g=>g.map(b=>[(r[0]+b[0])*200,(r[1]+b[1])*200]);return[...t[a],...t[a+1],...t[a+2],...t[a+3]].map(u)},Cr=(n,t)=>[...st([n.x,n.y],t.borders),...st([n.x-Math.sin(n.angle)*dt,n.y-Math.cos(n.angle)*dt],t.borders),...jr(n,t)],jr=(n,t)=>t.polygons.reduce((e,r)=>[...e,...r.map((a,u)=>[a,r[(u+1)%r.length]])],[]),gt=n=>{const t=[],e=Math.hypot(n.width,n.height)/2,r=Math.atan2(n.width,n.height);return t.push([n.x-Math.sin(-n.angle-r)*e,n.y-Math.cos(-n.angle-r)*e]),t.push([n.x-Math.sin(-n.angle+r)*e,n.y-Math.cos(-n.angle+r)*e]),t.push([n.x-Math.sin(Math.PI-n.angle-r)*e,n.y-Math.cos(Math.PI-n.angle-r)*e]),t.push([n.x-Math.sin(Math.PI-n.angle+r)*e,n.y-Math.cos(Math.PI-n.angle+r)*e]),{box:n,polygon:t}},Dr=(n,t,e)=>({borders:t,polygons:e.filter(r=>r!==n&&Kr(r.box,n.box)<=Math.max(r.box.width,r.box.height)).map(r=>gt(r.box).polygon)}),Kr=(n,t)=>Math.sqrt((n.x-t.x)**2+(n.y-t.y)**2),Br=2*Math.PI,Vr=n=>{const t=n.path[0];return t?Math.atan((t[0]-n.box.x)/(t[1]-n.box.y))-(n.box.y<t[1]?Math.PI:0):0},Jr=n=>t=>{const[e,r]=n.destination;t.fillStyle="purple",t.beginPath(),t.arc(e,r,n.box.width/2,0,Br),t.fill(),t.strokeStyle="purple",t.beginPath(),t.setLineDash([9,3]),t.moveTo(n.box.x,n.box.y),t.lineTo(e,r),t.stroke();const a=Vr(n),u=[n.box.x,n.box.y],g=[n.box.x-Math.sin(a)*100,n.box.y-Math.cos(a)*100];return t.strokeStyle="red",t.beginPath(),t.setLineDash([9,3]),t.moveTo(...u),t.lineTo(...g),t.stroke(),t.strokeStyle="blue",t.setLineDash([9,3]),t.beginPath(),n.path.forEach((b,v)=>v===0?t.moveTo(...b):t.lineTo(...b)),t.stroke(),t};let On=3,mt=100,vt=Math.PI/4;Ct.update(n=>n);G.brain.subscribe(({sensorCount:n,sensorLength:t,sensorSpread:e})=>{On=n,mt=t,vt=e});const Yr=n=>t=>x(Cr(t,n),e=>new Array(On*2).fill(0).map((r,a)=>{const u=a%2*Math.PI+W(vt/2,-vt/2,On==1?.5:Math.floor(a/2)/(On-1))-t.angle,g=[t.x,t.y],b=[t.x-Math.sin(u)*mt,t.y-Math.cos(u)*mt],v=e.map(_=>qr(g,b,..._)).filter(_=>_!=null);return v.sort((_,S)=>_.offset-S.offset),{start:g,end:b,contacts:v}})),Zr=(n,t,e)=>r=>x(n.box,Yr(Dr(n,t,e)),Gr(r),Jr(n)),Gr=n=>t=>t.map(e=>{var a;const r=((a=e.contacts[0])==null?void 0:a.position)??e.end;return n.lineWidth=2,n.strokeStyle="yellow",n.beginPath(),n.moveTo(...e.start),n.lineTo(...r),n.stroke(),n.strokeStyle="black",n.beginPath(),n.moveTo(...e.end),n.lineTo(...r),n.stroke(),n})[0];G.controls.subscribe(({cameraFocus:n})=>{});let Xt=0;G.brain.subscribe(({minFitness:n})=>{Xt=n});const Hr=n=>t=>n.map(e=>{const r=gt(e.box).polygon;t.beginPath(),t.fillStyle=e.dead?"red":e.color,r.forEach((u,g)=>g==0?t.moveTo(...u):t.lineTo(...u)),t.fill();const a={...e.box,height:e.box.height*Math.max(e.fitness/Xt,0)};return t.beginPath(),t.fillStyle="red",gt(a).polygon.forEach((u,g)=>g==0?t.moveTo(...u):t.lineTo(...u)),t.fill(),t})[0],P=6,on=16,C=5,en="black",Rn="gray",p=[0,0],yn=[n=>t=>{n.fillStyle=Rn;const e=W(0,t.width,1/P);n.fillRect(e-C*2,0,t.width-e*2+C*4,t.height),n.lineWidth=C,n.strokeStyle=en;const r=t.height/on,a=[r,r];new Array(P-1).fill(0).forEach((u,g)=>{const b=W(0,t.width,(g+1)/P);n.beginPath(),n.setLineDash(g==0||g==P-2?p:a),n.moveTo(b,0),n.lineTo(b,t.height),n.stroke()})},n=>t=>{n.fillStyle=Rn;const e={x:W(0,t.width,1/P),y:W(0,t.height,1/P)};n.fillRect(e.x-C*2,0,t.width-e.x*2+C*4,t.height),n.fillRect(0,e.y-C*2,t.width,t.height-e.y*2+C*4),n.fillStyle=en,n.beginPath(),n.arc(e.x,e.y,C/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(t.width-e.x,e.y,C/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(e.x,t.height-e.y,C/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(t.width-e.x,t.height-e.y,C/2,0,2*Math.PI),n.fill(),n.lineWidth=C,n.strokeStyle=en;const r=t.height/on,a=t.width/on,u=[r,r],g=[a,a];new Array(P-1).fill(0).forEach((b,v)=>{let _=W(0,t.width,(v+1)/P),S=W(0,t.height,1/P);n.setLineDash(v==0||v==P-2?p:u),n.beginPath(),n.moveTo(_,0),n.lineTo(_,S),n.stroke(),n.beginPath(),n.moveTo(_,t.height-S),n.lineTo(_,t.height),n.stroke(),_=W(0,t.width,1/P),S=W(0,t.height,(v+1)/P),n.setLineDash(v==0||v==P-2?p:g),n.beginPath(),n.moveTo(0,S),n.lineTo(_,S),n.stroke(),n.beginPath(),n.moveTo(t.width-_,S),n.lineTo(t.width,S),n.stroke()})},n=>t=>{n.fillStyle=Rn;const e={x:W(0,t.width,1/P),y:W(0,t.height,1/P)};n.fillRect(e.x-C*2,0,t.width-e.x*2+C*4,t.height),n.fillRect(0,e.y-C*2,t.width/2,t.height-e.y*2+C*4),n.fillStyle=en,n.beginPath(),n.arc(e.x,e.y,C/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(e.x,t.height-e.y,C/2,0,2*Math.PI),n.fill(),n.lineWidth=C,n.strokeStyle=en;const r=t.height/on,a=t.width/on,u=[r,r],g=[a,a];new Array(P-1).fill(0).forEach((b,v)=>{let _=W(0,t.width,(v+1)/P),S=W(0,t.height,1/P);v==P-2?(n.setLineDash(p),n.beginPath(),n.moveTo(_,0),n.lineTo(_,t.height),n.stroke()):(n.setLineDash(v==0||v==P-2?p:u),n.beginPath(),n.moveTo(_,0),n.lineTo(_,S),n.stroke(),n.beginPath(),n.moveTo(_,t.height-S),n.lineTo(_,t.height),n.stroke()),_=W(0,t.width,1/P),S=W(0,t.height,(v+1)/P),n.setLineDash(v==0||v==P-2?p:g),n.beginPath(),n.moveTo(0,S),n.lineTo(_,S),n.stroke()})},n=>t=>{n.fillStyle=Rn;const e={x:W(0,t.width,1/P),y:W(0,t.height,1/P)};n.fillRect(e.x-C*2,0,t.width-e.x*2+C*4,t.height-e.y),n.fillRect(0,e.y-C*2,t.width-e.x+C*2,t.height-e.y*2+C*4),n.fillStyle=en,n.beginPath(),n.arc(e.x,e.y,C/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(t.width-e.x,t.height-e.y,C/2,0,2*Math.PI),n.fill(),n.lineWidth=C,n.strokeStyle=en;const r=t.height/on,a=[r,r];new Array(P-1).fill(0).forEach((u,g)=>{let b=W(0,t.width,(g+1)/P),v=W(0,t.height,1/P);g==P-2?(n.setLineDash(p),n.beginPath(),n.moveTo(b,0),n.lineTo(b,t.height-e.y),n.stroke()):(n.setLineDash(g==0||g==P-2?p:a),n.beginPath(),n.moveTo(b,0),n.lineTo(b,v),n.stroke()),b=W(0,t.width,1/P),v=W(0,t.height,(g+1)/P),g==P-2?(n.setLineDash(p),n.beginPath(),n.moveTo(0,v),n.lineTo(t.width-e.x,v),n.stroke()):(n.setLineDash(g==0||g==P-2?p:a),n.beginPath(),n.moveTo(0,v),n.lineTo(b,v),n.stroke())})},()=>()=>{},n=>t=>{n.fillStyle=Rn;const e={x:W(0,t.width,1/P),y:W(0,t.height,1/P)};n.fillRect(e.x-C*2,0,t.width-e.x*2+C*4,t.height-e.y+C*2),n.fillStyle=en,n.beginPath(),n.arc(e.x,t.height-e.y,C/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(t.width-e.x,t.height-e.y,C/2,0,2*Math.PI),n.fill(),n.lineWidth=C,n.strokeStyle=en;const r=t.height/on,a=[r,r];new Array(P-1).fill(0).forEach((u,g)=>{let b=W(0,t.width,(g+1)/P),v=W(0,t.height,1/P);g==0||g==P-2?(n.setLineDash(p),n.beginPath(),n.moveTo(b,0),n.lineTo(b,t.height-e.y),n.stroke()):(n.setLineDash(a),n.beginPath(),n.moveTo(b,0),n.lineTo(b,v),n.stroke()),b=W(0,t.width,1/P),v=W(0,t.height,(g+1)/P),g==P-2&&(n.setLineDash(p),n.beginPath(),n.moveTo(e.x,v),n.lineTo(t.width-e.x,v),n.stroke())})}],Xr=[()=>({type:0,rotate:0,draw:yn[4]}),n=>({type:1,rotate:n.indexOf(!0),draw:yn[5]}),n=>{const t=n[0]==n[2],e=t?n[0]?0:1:n[0]&&n[3]?0:n[1]&&n[0]?1:n[2]&&n[1]?2:3,r=t?yn[0]:yn[3];return{type:t?2:3,rotate:e,draw:r}},n=>({type:4,rotate:n[2]&&n[3]&&n[0]?0:n[3]&&n[0]&&n[1]?1:n[0]&&n[1]&&n[2]?2:3,draw:yn[2]}),()=>({type:5,rotate:0,draw:yn[1]})],s=W(0,1,1/P),$r=[[[s,s],[1-s,s]],[[1-s,s],[1-s,1-s]],[[1-s,1-s],[s,1-s]],[[s,1-s],[s,s]]],Qr=[[[[s,0],[s,s]],[[1-s,0],[1-s,s]]],[[[1,s],[1-s,s]],[[1,1-s],[1-s,1-s]]],[[[1-s,1],[1-s,1-s]],[[s,1],[s,1-s]]],[[[0,s],[s,s]],[[0,1-s],[s,1-s]]]],pr=n=>n.map((t,e)=>t?Qr[e]:[$r[e]]),$t=(n,t,e)=>(n-e+t)%t,Qt=(n,t,e)=>{let r=(n+1)%t;return r=Math.abs(r%e-n%e)>1?(r-e+t)%t:r,r},pt=(n,t,e)=>(n+e)%t,kt=(n,t,e)=>{let r=(n-1+t)%t;return r=Math.abs(r%e-n%e)>1?(r+e)%t:r,r},kr=n=>{const t=Math.sqrt(n.map.length),e=n.map.map(a=>1/0),r=n.map.map(a=>1/0);return e[n.start]=0,r[n.start]=ne(vn(n.start,t),vn(n.end,t)),zt({...n,width:t,open:[n.start],closed:[],costs:e,guesses:r,cameFrom:n.map.map(a=>0)})},zt=n=>{const{map:t,start:e,end:r,width:a,open:u,closed:g,costs:b,guesses:v,cameFrom:_}=n,S=M=>ne(vn(M,a),vn(r,a)),I=u.map(M=>S(M)),R=I.reduce((M,F,D)=>F<I[M]?D:M,0),E=u[R];return u.splice(R,1),g.push(E),t[E].map((M,F)=>M?zr[F](E,t.length,a):null).filter(M=>M!=null).filter(M=>!g.includes(M)).forEach(M=>{const D=b[E]+1;D<b[M]&&(_[M]=E,b[M]=D,v[M]=D+S(M),u.includes(M)||u.push(M))}),u.length===0?[]:E===r?xt(_,E,e):zt(n)},xt=(n,t,e,r=[t])=>t===e?r:xt(n,n[t],e,[n[t],...r]),vn=(n,t)=>[n%t,Math.floor(n/t)],ne=(n,t)=>Math.abs(n[0]-t[0])+Math.abs(n[1]-t[1]),zr=[$t,Qt,pt,kt],xr=n=>({connections:Pn[0].slice(),possibilities:new Array(Pn.length).fill(0).map((t,e)=>e),index:n}),Pn=[[!1,!1,!1,!1],[!0,!0,!0,!0],[!0,!1,!0,!1],[!1,!0,!1,!0],[!0,!0,!1,!1],[!1,!1,!0,!0],[!0,!0,!0,!1],[!0,!0,!1,!0],[!0,!1,!0,!0],[!1,!0,!0,!0]],na=[$t,Qt,pt,kt],ta=(n,t,e)=>{const r=Pn[e.possibilities[Math.floor(Math.random()*e.possibilities.length)]];r.forEach((a,u)=>x(na[u](e.index,t.length,n),g=>{const b=(u+2)%4;t[g].connections[b]=a,t[g].possibilities=t[g].possibilities.filter(v=>Pn[v][b]===a)})),e.connections=r,e.possibilities=[]},ea=n=>new Array(n**2).fill(null).map((t,e)=>xr(e)),ra=(n,t)=>n.possibilities.length-t.possibilities.length,te=n=>t=>{if(t.filter(a=>a.possibilities.length!=0).length==0)return t.map(a=>a.connections);const e=t.slice().sort(ra).filter(a=>a.possibilities.length!=0),r=e.filter(a=>a.possibilities.length==e[0].possibilities.length);return ta(n,t,r[Math.floor(Math.random()*r.length)]),te(n)(t)},aa=n=>n.map(t=>Xr[t.reduce((e,r)=>e+Number(r),0)](t)),ia=n=>x(ea(n),te(n),t=>({connections:t,map:aa(t),borders:t.reduce((e,r)=>[...e,...pr(r)],[])}));G.master.subscribe(n=>{n.gridSize*200});G.brain.subscribe(({minFitness:n})=>{});G.controls.subscribe(({cameraFocus:n,playerControls:t})=>{});G.brain.subscribe(({minFitness:n})=>{});const ja={onkeydown:n=>{n.preventDefault(),Tt[n.key]=ua[n.key]||ca},onkeyup:n=>{n.preventDefault(),delete Tt[n.key]}};let yt=3,bt=.1,_t=.5*Math.PI/180;G.controls.subscribe(({carThrust:n,carTurnSpeed:t,carBreakStrength:e})=>{yt=n,bt=e,_t=t*Math.PI/180});const Tt={},ua={ArrowUp:n=>n.thrust=yt,ArrowDown:n=>n.thrust=yt*-.4,ArrowLeft:n=>n.angle=-_t,ArrowRight:n=>n.angle=_t,Shift:n=>n.breaks=bt,Space:n=>n.breaks=bt},ca=n=>{};let ee,re;Ie.subscribe(n=>{ee=n});Ct.subscribe(n=>{re=n});const la=(n,t)=>{const e=document.getElementById(n)||Ft("error: declaring canvas returned null",ee);e.width=t.width,e.height=t.height;const r=e.getContext("2d")||Ft("error: declaring context returned null",re);return{canvas:e,ctx:r}},Ft=(n,t)=>(console.error(n),t);let ot;const fa="background-canvas",oa=n=>t=>n.backgroundSaved?(t.drawImage(ot,0,0),t):(ot=x(la(fa,n.size),ha(n)),t.drawImage(ot,0,0),n.backgroundSaved=!0,t),ha=n=>t=>{const{canvas:e,ctx:r}=t,{generatedMap:a,size:u,dim:g}=n;r.fillStyle="green",r.fillRect(0,0,u.width,u.height);const b={width:u.width/g,height:u.height/g};return new Array(a.map.length).fill(0).map((v,_)=>{r.save(),r.translate(W(0,u.width,_%g/g)+b.width/2,W(0,u.height,Math.floor(_/g)/g)+b.height/2),r.rotate(a.map[_].rotate*90*Math.PI/180),r.translate(-b.width/2,-b.height/2),a.map[_].draw(r)(b),r.restore()}),e},da=[[-1,-1],[0,1],[1,0],[0,-1],[-1,0],[1,-1],[-1,1],[1,1]],Da=(n,t,e,r)=>ga(n,da.filter(a=>!0),e);let ae=!1,ie=0;G.controls.subscribe(({drawSensors:n,cameraFocus:t})=>{ie=t,ae=n});const ga=(n,t,e)=>{const r=a=>x(a,oa(n),Hr(e),ae?Zr(e[ie],n.generatedMap.borders,e):u=>u);return a=>(t.forEach(u=>{a.save(),a.translate(n.size.width*u[0],n.size.height*u[1]),r(a),a.restore()}),r(a))},Ka=n=>t=>(t.clearRect(0,0,n.width,n.height),t);G.controls.subscribe(n=>{n.cameraFocus,n.playerControls,n.carThrust,n.carBreakStrength,n.carTurnSpeed*Math.PI/180});const ue="bestNetwork";let Pt=!1;En.subscribe(n=>Pt=n);const ma=()=>{if(!Pt)return!1;try{localStorage.removeItem(ue)}catch{return!1}return!0},va=()=>{if(!Pt)return null;try{return localStorage.getItem(ue)}catch{return null}},ce=()=>JSON.parse(va()??"null"),ya=ce,ba=()=>x(ce(),Ot(n=>n,ya)),_a=ma,Sa=(n,t=.3)=>({layers:Ra(n.layers,t)}),Ra=(n,t)=>n.map(e=>x(e,Ma(t),Ia(t))),Ma=n=>t=>(t.biases=t.biases.map(e=>W(e,Math.random()*2-1,n)),t),Ia=n=>t=>(t.weights=t.weights.map(e=>e.map(r=>W(r,Math.random()*2-1,n))),t),{simulation:wa,master:Aa}=G,gn=200,Lt=gn/P*.6,Wt=["#0f0","#000","#0ff","#f0f","#fff"];let hn=dn.master,le=dn.simulation;Aa.subscribe(n=>hn=n);wa.subscribe(n=>le=n);const Ea=(n,t,e)=>{const r=Number(hn.gridSize),a=n.connections.map((F,D)=>({connection:F,tile:D})).filter(F=>F.connection.includes(!0)),u=Math.floor(Math.random()*a.length),g=a[u].tile,b=a.map(F=>({...F,path:kr({map:n.connections,start:g,end:F.tile})})).reduce((F,D)=>F.path.length>D.path.length?F:D),v=b.tile,_=b.path.map(F=>vn(F,r).map(D=>D*200+100)),[S,I]=vn(g,r),R=vn(v,r).map(F=>F*200+100),E=(b.path[1]+r+1)%n.connections.length-(b.path[0]+r+1)%n.connections.length,M=E===1?Math.PI/2:E===r?Math.PI:E===-r?0:3*Math.PI/2;return{brain:x(e,Ot(Sa,()=>qt([t*2+1,...le.layers]))),box:{x:S*gn+W(0,gn,(Math.floor(1+Math.random()*(P-2))+.5)/P),y:I*gn+W(0,gn,(Math.floor(1+Math.random()*(P-2))+.5)/P),width:Lt,height:Lt*1.6,angle:M,physics:{momentum:{direction:0,magnitude:0},mass:Math.random()*5+5}},destination:R,color:Wt[Math.floor(Math.random()*Wt.length)],dead:!1,fitness:0,performace:0,path:_}},Oa=(n,t)=>{const r=ia(Number(hn.gridSize)),a=(t==null?void 0:t.world)??{generatedMap:r,dim:hn.gridSize,size:{width:hn.gridSize*gn,height:hn.gridSize*gn},backgroundSaved:!1},u=x(ba(),Ot(b=>n.sensorCount===b.layers[0].inputs.length?b:null,()=>null)),g=(t==null?void 0:t.carSpots)??new Array(hn.carAmount).fill(dn.simulation.carSpots[0]).map(()=>Ea(r,n.sensorCount,u));return{world:a,carSpots:g,currentId:null}};function Pa(n){let t;const e=n[7].default,r=de(e,n,n[6],null);return{c(){r&&r.c()},l(a){r&&r.l(a)},m(a,u){r&&r.m(a,u),t=!0},p(a,[u]){r&&r.p&&(!t||u&64)&&ge(r,e,a,a[6],t?ve(e,a[6],u,null):me(a[6]),null)},i(a){t||(ye(r,a),t=!0)},o(a){be(r,a),t=!1},d(a){r&&r.d(a)}}}function Ua(n,t,e){let r,a,u,g;wn(n,En,M=>e(8,u=M));let{$$slots:b={},$$scope:v}=t,{input:_}=t;const{master:S,simulation:I,brain:R,controls:E}=G;return wn(n,S,M=>e(4,r=M)),wn(n,I,M=>e(9,g=M)),wn(n,R,M=>e(5,a=M)),_e(()=>{An(En,u=!0,u),An(I,g.destroyed=!1,g)}),Se(()=>{An(I,g.destroyed=!0,g),An(En,u=!1,u)}),n.$$set=M=>{"input"in M&&e(3,_=M.input),"$$scope"in M&&e(6,v=M.$$scope)},n.$$.update=()=>{n.$$.dirty&56&&G.simulation.update(M=>({...M,...Oa(a,_)})),n.$$.dirty&32&&_a(),n.$$.dirty&16},[S,I,R,_,r,a,v,b]}class Ba extends fe{constructor(t){super(),oe(this,t,Ua,Pa,he,{input:3})}}export{ja as C,Ba as E,Ka as a,Ie as b,G as c,la as d,Ct as e,Da as f,sa as g,we as h,Ca as i,W as l,x as p};
