import{S as Vt,i as pt,s as Gt,U as Jt,k as be,a as He,l as _e,m as Se,h as gn,c as Ye,n as en,p as Ht,b as Nn,Q as we,A as Xe,V as Yt,T as _n,W as Un,o as Xt,H as Zt,X as kt}from"./index-7bc860ef.js";import{w as mn}from"./index-17f28254.js";function Qt(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const a in r)if(a!=="default"&&!(a in n)){const i=Object.getOwnPropertyDescriptor(r,a);i&&Object.defineProperty(n,a,i.get?i:{enumerable:!0,get:()=>r[a]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var N=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $t(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Q={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.getEndomorphismMonoid=n.not=n.SK=n.hole=n.pipe=n.untupled=n.tupled=n.absurd=n.decrement=n.increment=n.tuple=n.flow=n.flip=n.constVoid=n.constUndefined=n.constNull=n.constFalse=n.constTrue=n.constant=n.unsafeCoerce=n.identity=n.apply=n.getRing=n.getSemiring=n.getMonoid=n.getSemigroup=n.getBooleanAlgebra=void 0;var e=function(f){return function(){return{meet:function(l,v){return function(_){return f.meet(l(_),v(_))}},join:function(l,v){return function(_){return f.join(l(_),v(_))}},zero:function(){return f.zero},one:function(){return f.one},implies:function(l,v){return function(_){return f.implies(l(_),v(_))}},not:function(l){return function(v){return f.not(l(v))}}}}};n.getBooleanAlgebra=e;var t=function(f){return function(){return{concat:function(l,v){return function(_){return f.concat(l(_),v(_))}}}}};n.getSemigroup=t;var r=function(f){var l=(0,n.getSemigroup)(f);return function(){return{concat:l().concat,empty:function(){return f.empty}}}};n.getMonoid=r;var a=function(f){return{add:function(l,v){return function(_){return f.add(l(_),v(_))}},zero:function(){return f.zero},mul:function(l,v){return function(_){return f.mul(l(_),v(_))}},one:function(){return f.one}}};n.getSemiring=a;var i=function(f){var l=(0,n.getSemiring)(f);return{add:l.add,mul:l.mul,one:l.one,zero:l.zero,sub:function(v,_){return function(L){return f.sub(v(L),_(L))}}}};n.getRing=i;var d=function(f){return function(l){return l(f)}};n.apply=d;function b(f){return f}n.identity=b,n.unsafeCoerce=b;function g(f){return function(){return f}}n.constant=g,n.constTrue=g(!0),n.constFalse=g(!1),n.constNull=g(null),n.constUndefined=g(void 0),n.constVoid=n.constUndefined;function S(f){return function(l,v){return f(v,l)}}n.flip=S;function y(f,l,v,_,L,D,K,z,cn){switch(arguments.length){case 1:return f;case 2:return function(){return l(f.apply(this,arguments))};case 3:return function(){return v(l(f.apply(this,arguments)))};case 4:return function(){return _(v(l(f.apply(this,arguments))))};case 5:return function(){return L(_(v(l(f.apply(this,arguments)))))};case 6:return function(){return D(L(_(v(l(f.apply(this,arguments))))))};case 7:return function(){return K(D(L(_(v(l(f.apply(this,arguments)))))))};case 8:return function(){return z(K(D(L(_(v(l(f.apply(this,arguments))))))))};case 9:return function(){return cn(z(K(D(L(_(v(l(f.apply(this,arguments)))))))))}}}n.flow=y;function w(){for(var f=[],l=0;l<arguments.length;l++)f[l]=arguments[l];return f}n.tuple=w;function M(f){return f+1}n.increment=M;function E(f){return f-1}n.decrement=E;function O(f){throw new Error("Called `absurd` function which should be uncallable")}n.absurd=O;function F(f){return function(l){return f.apply(void 0,l)}}n.tupled=F;function p(f){return function(){for(var l=[],v=0;v<arguments.length;v++)l[v]=arguments[v];return f(l)}}n.untupled=p;function X(f,l,v,_,L,D,K,z,cn){switch(arguments.length){case 1:return f;case 2:return l(f);case 3:return v(l(f));case 4:return _(v(l(f)));case 5:return L(_(v(l(f))));case 6:return D(L(_(v(l(f)))));case 7:return K(D(L(_(v(l(f))))));case 8:return z(K(D(L(_(v(l(f)))))));case 9:return cn(z(K(D(L(_(v(l(f))))))));default:{for(var an=arguments[0],un=1;un<arguments.length;un++)an=arguments[un](an);return an}}}n.pipe=X,n.hole=O;var I=function(f,l){return l};n.SK=I;function s(f){return function(l){return!f(l)}}n.not=s;var R=function(){return{concat:function(f,l){return y(f,l)},empty:b}};n.getEndomorphismMonoid=R})(Q);const zt=$t(Q),xt=Qt({__proto__:null,default:zt},[Q]);var tt={},rt={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.eqDate=n.eqNumber=n.eqString=n.eqBoolean=n.eq=n.strictEqual=n.getStructEq=n.getTupleEq=n.Contravariant=n.getMonoid=n.getSemigroup=n.eqStrict=n.URI=n.contramap=n.tuple=n.struct=n.fromEquals=void 0;var e=Q,t=function(y){return{equals:function(w,M){return w===M||y(w,M)}}};n.fromEquals=t;var r=function(y){return(0,n.fromEquals)(function(w,M){for(var E in y)if(!y[E].equals(w[E],M[E]))return!1;return!0})};n.struct=r;var a=function(){for(var y=[],w=0;w<arguments.length;w++)y[w]=arguments[w];return(0,n.fromEquals)(function(M,E){return y.every(function(O,F){return O.equals(M[F],E[F])})})};n.tuple=a;var i=function(y,w){return(0,e.pipe)(y,(0,n.contramap)(w))},d=function(y){return function(w){return(0,n.fromEquals)(function(M,E){return w.equals(y(M),y(E))})}};n.contramap=d,n.URI="Eq",n.eqStrict={equals:function(y,w){return y===w}};var b={equals:function(){return!0}},g=function(){return{concat:function(y,w){return(0,n.fromEquals)(function(M,E){return y.equals(M,E)&&w.equals(M,E)})}}};n.getSemigroup=g;var S=function(){return{concat:(0,n.getSemigroup)().concat,empty:b}};n.getMonoid=S,n.Contravariant={URI:n.URI,contramap:i},n.getTupleEq=n.tuple,n.getStructEq=n.struct,n.strictEqual=n.eqStrict.equals,n.eq=n.Contravariant,n.eqBoolean=n.eqStrict,n.eqString=n.eqStrict,n.eqNumber=n.eqStrict,n.eqDate={equals:function(y,w){return y.valueOf()===w.valueOf()}}})(rt);(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.ordDate=n.ordNumber=n.ordString=n.ordBoolean=n.ord=n.getDualOrd=n.getTupleOrd=n.between=n.clamp=n.max=n.min=n.geq=n.leq=n.gt=n.lt=n.equals=n.trivial=n.Contravariant=n.getMonoid=n.getSemigroup=n.URI=n.contramap=n.reverse=n.tuple=n.fromCompare=n.equalsDefault=void 0;var e=rt,t=Q,r=function(l){return function(v,_){return v===_||l(v,_)===0}};n.equalsDefault=r;var a=function(l){return{equals:(0,n.equalsDefault)(l),compare:function(v,_){return v===_?0:l(v,_)}}};n.fromCompare=a;var i=function(){for(var l=[],v=0;v<arguments.length;v++)l[v]=arguments[v];return(0,n.fromCompare)(function(_,L){for(var D=0;D<l.length-1;D++){var K=l[D].compare(_[D],L[D]);if(K!==0)return K}return l[D].compare(_[D],L[D])})};n.tuple=i;var d=function(l){return(0,n.fromCompare)(function(v,_){return l.compare(_,v)})};n.reverse=d;var b=function(l,v){return(0,t.pipe)(l,(0,n.contramap)(v))},g=function(l){return function(v){return(0,n.fromCompare)(function(_,L){return v.compare(l(_),l(L))})}};n.contramap=g,n.URI="Ord";var S=function(){return{concat:function(l,v){return(0,n.fromCompare)(function(_,L){var D=l.compare(_,L);return D!==0?D:v.compare(_,L)})}}};n.getSemigroup=S;var y=function(){return{concat:(0,n.getSemigroup)().concat,empty:(0,n.fromCompare)(function(){return 0})}};n.getMonoid=y,n.Contravariant={URI:n.URI,contramap:b},n.trivial={equals:t.constTrue,compare:(0,t.constant)(0)};var w=function(l){return function(v){return function(_){return _===v||l.compare(_,v)===0}}};n.equals=w;var M=function(l){return function(v,_){return l.compare(v,_)===-1}};n.lt=M;var E=function(l){return function(v,_){return l.compare(v,_)===1}};n.gt=E;var O=function(l){return function(v,_){return l.compare(v,_)!==1}};n.leq=O;var F=function(l){return function(v,_){return l.compare(v,_)!==-1}};n.geq=F;var p=function(l){return function(v,_){return v===_||l.compare(v,_)<1?v:_}};n.min=p;var X=function(l){return function(v,_){return v===_||l.compare(v,_)>-1?v:_}};n.max=X;var I=function(l){var v=(0,n.min)(l),_=(0,n.max)(l);return function(L,D){return function(K){return _(v(K,D),L)}}};n.clamp=I;var s=function(l){var v=(0,n.lt)(l),_=(0,n.gt)(l);return function(L,D){return function(K){return!(v(K,L)||_(K,D))}}};n.between=s,n.getTupleOrd=n.tuple,n.getDualOrd=n.reverse,n.ord=n.Contravariant;function R(l,v){return l<v?-1:l>v?1:0}var f={equals:e.eqStrict.equals,compare:R};n.ordBoolean=f,n.ordString=f,n.ordNumber=f,n.ordDate=(0,t.pipe)(n.ordNumber,(0,n.contramap)(function(l){return l.valueOf()}))})(tt);var We={},vn={},H={},T={},nr=N&&N.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,a=e.length,i;r<a;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(T,"__esModule",{value:!0});T.fromReadonlyNonEmptyArray=T.has=T.emptyRecord=T.emptyReadonlyArray=T.tail=T.head=T.isNonEmpty=T.singleton=T.right=T.left=T.isRight=T.isLeft=T.some=T.none=T.isSome=T.isNone=void 0;var er=function(n){return n._tag==="None"};T.isNone=er;var tr=function(n){return n._tag==="Some"};T.isSome=tr;T.none={_tag:"None"};var rr=function(n){return{_tag:"Some",value:n}};T.some=rr;var ar=function(n){return n._tag==="Left"};T.isLeft=ar;var ir=function(n){return n._tag==="Right"};T.isRight=ir;var ur=function(n){return{_tag:"Left",left:n}};T.left=ur;var lr=function(n){return{_tag:"Right",right:n}};T.right=lr;var cr=function(n){return[n]};T.singleton=cr;var or=function(n){return n.length>0};T.isNonEmpty=or;var fr=function(n){return n[0]};T.head=fr;var hr=function(n){return n.slice(1)};T.tail=hr;T.emptyReadonlyArray=[];T.emptyRecord={};T.has=Object.prototype.hasOwnProperty;var dr=function(n){return nr([n[0]],n.slice(1),!0)};T.fromReadonlyNonEmptyArray=dr;var gr=N&&N.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,a)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),mr=N&&N.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),vr=N&&N.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&gr(e,n,t);return mr(e,n),e};Object.defineProperty(H,"__esModule",{value:!0});var Gn=H.sequenceS=De=H.sequenceT=H.getApplySemigroup=H.apS=H.apSecond=H.apFirst=H.ap=void 0,yr=Q,br=vr(T);function _r(n,e){return function(t){return function(r){return n.ap(n.map(r,function(a){return function(i){return e.ap(a,i)}}),t)}}}H.ap=_r;function Sr(n){return function(e){return function(t){return n.ap(n.map(t,function(r){return function(){return r}}),e)}}}H.apFirst=Sr;function wr(n){return function(e){return function(t){return n.ap(n.map(t,function(){return function(r){return r}}),e)}}}H.apSecond=wr;function Rr(n){return function(e,t){return function(r){return n.ap(n.map(r,function(a){return function(i){var d;return Object.assign({},a,(d={},d[e]=i,d))}}),t)}}}H.apS=Rr;function Mr(n){return function(e){return{concat:function(t,r){return n.ap(n.map(t,function(a){return function(i){return e.concat(a,i)}}),r)}}}}H.getApplySemigroup=Mr;function qe(n,e,t){return function(r){for(var a=Array(t.length+1),i=0;i<t.length;i++)a[i]=t[i];return a[t.length]=r,e===0?n.apply(null,a):qe(n,e-1,a)}}var Re={1:function(n){return[n]},2:function(n){return function(e){return[n,e]}},3:function(n){return function(e){return function(t){return[n,e,t]}}},4:function(n){return function(e){return function(t){return function(r){return[n,e,t,r]}}}},5:function(n){return function(e){return function(t){return function(r){return function(a){return[n,e,t,r,a]}}}}}};function sr(n){return br.has.call(Re,n)||(Re[n]=qe(yr.tuple,n-1,[])),Re[n]}function Ar(n){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=e.length,a=sr(r),i=n.map(e[0],a),d=1;d<r;d++)i=n.ap(i,e[d]);return i}}var De=H.sequenceT=Ar;function Ir(n){var e=n.length;switch(e){case 1:return function(t){var r;return r={},r[n[0]]=t,r};case 2:return function(t){return function(r){var a;return a={},a[n[0]]=t,a[n[1]]=r,a}};case 3:return function(t){return function(r){return function(a){var i;return i={},i[n[0]]=t,i[n[1]]=r,i[n[2]]=a,i}}};case 4:return function(t){return function(r){return function(a){return function(i){var d;return d={},d[n[0]]=t,d[n[1]]=r,d[n[2]]=a,d[n[3]]=i,d}}}};case 5:return function(t){return function(r){return function(a){return function(i){return function(d){var b;return b={},b[n[0]]=t,b[n[1]]=r,b[n[2]]=a,b[n[3]]=i,b[n[4]]=d,b}}}}};default:return qe(function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];for(var a={},i=0;i<e;i++)a[n[i]]=t[i];return a},e-1,[])}}function Er(n){return function(e){for(var t=Object.keys(e),r=t.length,a=Ir(t),i=n.map(e[t[0]],a),d=1;d<r;d++)i=n.ap(i,e[t[d]]);return i}}Gn=H.sequenceS=Er;var $={};Object.defineProperty($,"__esModule",{value:!0});$.getFunctorComposition=$.bindTo=$.flap=$.map=void 0;var Or=Q;function at(n,e){return function(t){return function(r){return n.map(r,function(a){return e.map(a,t)})}}}$.map=at;function Pr(n){return function(e){return function(t){return n.map(t,function(r){return r(e)})}}}$.flap=Pr;function Nr(n){return function(e){return function(t){return n.map(t,function(r){var a;return a={},a[e]=r,a})}}}$.bindTo=Nr;function Ur(n,e){var t=at(n,e);return{map:function(r,a){return(0,Or.pipe)(r,t(a))}}}$.getFunctorComposition=Ur;Object.defineProperty(vn,"__esModule",{value:!0});vn.getApplicativeComposition=vn.getApplicativeMonoid=void 0;var it=H,Tr=Q,Lr=$;function Cr(n){var e=(0,it.getApplySemigroup)(n);return function(t){return{concat:e(t).concat,empty:n.of(t.empty)}}}vn.getApplicativeMonoid=Cr;function Fr(n,e){var t=(0,Lr.getFunctorComposition)(n,e).map,r=(0,it.ap)(n,e);return{map:t,of:function(a){return n.of(e.of(a))},ap:function(a,i){return(0,Tr.pipe)(a,r(i))}}}vn.getApplicativeComposition=Fr;var dn={};Object.defineProperty(dn,"__esModule",{value:!0});dn.bind=dn.chainFirst=void 0;function Wr(n){return function(e){return function(t){return n.chain(t,function(r){return n.map(e(r),function(){return r})})}}}dn.chainFirst=Wr;function qr(n){return function(e,t){return function(r){return n.chain(r,function(a){return n.map(t(a),function(i){var d;return Object.assign({},a,(d={},d[e]=i,d))})})}}}dn.bind=qr;var Jn={};Object.defineProperty(Jn,"__esModule",{value:!0});Jn.tailRec=void 0;var Dr=function(n,e){for(var t=e(n);t._tag==="Left";)t=e(t.left);return t.right};Jn.tailRec=Dr;var J={},jr=N&&N.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,a)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Kr=N&&N.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Br=N&&N.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&jr(e,n,t);return Kr(e,n),e};Object.defineProperty(J,"__esModule",{value:!0});J.filterOrElse=J.chainFirstEitherK=J.chainEitherK=J.fromEitherK=J.chainOptionK=J.fromOptionK=J.fromPredicate=J.fromOption=void 0;var Vr=dn,je=Q,Rn=Br(T);function ut(n){return function(e){return function(t){return n.fromEither(Rn.isNone(t)?Rn.left(e()):Rn.right(t.value))}}}J.fromOption=ut;function pr(n){return function(e,t){return function(r){return n.fromEither(e(r)?Rn.right(r):Rn.left(t(r)))}}}J.fromPredicate=pr;function lt(n){var e=ut(n);return function(t){var r=e(t);return function(a){return(0,je.flow)(a,r)}}}J.fromOptionK=lt;function Gr(n,e){var t=lt(n);return function(r){var a=t(r);return function(i){return function(d){return e.chain(d,a(i))}}}}J.chainOptionK=Gr;function Ke(n){return function(e){return(0,je.flow)(e,n.fromEither)}}J.fromEitherK=Ke;function Jr(n,e){var t=Ke(n);return function(r){return function(a){return e.chain(a,t(r))}}}J.chainEitherK=Jr;function Hr(n,e){return(0,je.flow)(Ke(n),(0,Vr.chainFirst)(e))}J.chainFirstEitherK=Hr;function Yr(n,e){return function(t,r){return function(a){return e.chain(a,function(i){return n.fromEither(t(i)?Rn.right(i):Rn.left(r(i)))})}}}J.filterOrElse=Yr;var Be={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.right=n.left=n.flap=n.Functor=n.Bifunctor=n.URI=n.bimap=n.mapLeft=n.map=n.separated=void 0;var e=Q,t=$,r=function(M,E){return{left:M,right:E}};n.separated=r;var a=function(M,E){return(0,e.pipe)(M,(0,n.map)(E))},i=function(M,E){return(0,e.pipe)(M,(0,n.mapLeft)(E))},d=function(M,E,O){return(0,e.pipe)(M,(0,n.bimap)(E,O))},b=function(M){return function(E){return(0,n.separated)((0,n.left)(E),M((0,n.right)(E)))}};n.map=b;var g=function(M){return function(E){return(0,n.separated)(M((0,n.left)(E)),(0,n.right)(E))}};n.mapLeft=g;var S=function(M,E){return function(O){return(0,n.separated)(M((0,n.left)(O)),E((0,n.right)(O)))}};n.bimap=S,n.URI="Separated",n.Bifunctor={URI:n.URI,mapLeft:i,bimap:d},n.Functor={URI:n.URI,map:a},n.flap=(0,t.flap)(n.Functor);var y=function(M){return M.left};n.left=y;var w=function(M){return M.right};n.right=w})(Be);var hn={},Xr=N&&N.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,a)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Zr=N&&N.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),kr=N&&N.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Xr(e,n,t);return Zr(e,n),e};Object.defineProperty(hn,"__esModule",{value:!0});hn.filterE=hn.witherDefault=hn.wiltDefault=void 0;var Ze=kr(T);function Qr(n,e){return function(t){var r=n.traverse(t);return function(a,i){return t.map(r(a,i),e.separate)}}}hn.wiltDefault=Qr;function $r(n,e){return function(t){var r=n.traverse(t);return function(a,i){return t.map(r(a,i),e.compact)}}}hn.witherDefault=$r;function zr(n){return function(e){var t=n.wither(e);return function(r){return function(a){return t(a,function(i){return e.map(r(i),function(d){return d?Ze.some(i):Ze.none})})}}}}hn.filterE=zr;(function(n){var e=N&&N.__createBinding||(Object.create?function(o,u,m,q){q===void 0&&(q=m);var Z=Object.getOwnPropertyDescriptor(u,m);(!Z||("get"in Z?!u.__esModule:Z.writable||Z.configurable))&&(Z={enumerable:!0,get:function(){return u[m]}}),Object.defineProperty(o,q,Z)}:function(o,u,m,q){q===void 0&&(q=m),o[q]=u[m]}),t=N&&N.__setModuleDefault||(Object.create?function(o,u){Object.defineProperty(o,"default",{enumerable:!0,value:u})}:function(o,u){o.default=u}),r=N&&N.__importStar||function(o){if(o&&o.__esModule)return o;var u={};if(o!=null)for(var m in o)m!=="default"&&Object.prototype.hasOwnProperty.call(o,m)&&e(u,o,m);return t(u,o),u};Object.defineProperty(n,"__esModule",{value:!0}),n.fold=n.match=n.foldW=n.matchW=n.isRight=n.isLeft=n.fromOption=n.fromPredicate=n.FromEither=n.MonadThrow=n.throwError=n.ChainRec=n.Extend=n.extend=n.Alt=n.alt=n.altW=n.Bifunctor=n.mapLeft=n.bimap=n.Traversable=n.sequence=n.traverse=n.Foldable=n.reduceRight=n.foldMap=n.reduce=n.Monad=n.Chain=n.chain=n.chainW=n.Applicative=n.Apply=n.ap=n.apW=n.Pointed=n.of=n.Functor=n.map=n.getAltValidation=n.getApplicativeValidation=n.getWitherable=n.getFilterable=n.getCompactable=n.getSemigroup=n.getEq=n.getShow=n.URI=n.right=n.left=void 0,n.getValidation=n.getValidationMonoid=n.getValidationSemigroup=n.getApplyMonoid=n.getApplySemigroup=n.either=n.stringifyJSON=n.parseJSON=n.sequenceArray=n.traverseArray=n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex=n.traverseReadonlyNonEmptyArrayWithIndex=n.ApT=n.apSW=n.apS=n.bindW=n.bind=n.bindTo=n.Do=n.exists=n.elem=n.toError=n.toUnion=n.chainNullableK=n.fromNullableK=n.tryCatchK=n.tryCatch=n.fromNullable=n.orElse=n.orElseW=n.swap=n.filterOrElseW=n.filterOrElse=n.chainOptionK=n.fromOptionK=n.duplicate=n.flatten=n.flattenW=n.chainFirstW=n.chainFirst=n.apSecondW=n.apSecond=n.apFirstW=n.apFirst=n.flap=n.getOrElse=n.getOrElseW=void 0;var a=vn,i=H,d=dn,b=Jn,g=J,S=Q,y=$,w=r(T),M=Be,E=hn;n.left=w.left,n.right=w.right;var O=function(o,u){return(0,S.pipe)(o,(0,n.map)(u))},F=function(o,u){return(0,S.pipe)(o,(0,n.ap)(u))},p=function(o,u){return(0,S.pipe)(o,(0,n.chain)(u))},X=function(o,u,m){return(0,S.pipe)(o,(0,n.reduce)(u,m))},I=function(o){return function(u,m){var q=(0,n.foldMap)(o);return(0,S.pipe)(u,q(m))}},s=function(o,u,m){return(0,S.pipe)(o,(0,n.reduceRight)(u,m))},R=function(o){var u=(0,n.traverse)(o);return function(m,q){return(0,S.pipe)(m,u(q))}},f=function(o,u,m){return(0,S.pipe)(o,(0,n.bimap)(u,m))},l=function(o,u){return(0,S.pipe)(o,(0,n.mapLeft)(u))},v=function(o,u){return(0,S.pipe)(o,(0,n.alt)(u))},_=function(o,u){return(0,S.pipe)(o,(0,n.extend)(u))},L=function(o,u){return(0,b.tailRec)(u(o),function(m){return(0,n.isLeft)(m)?(0,n.right)((0,n.left)(m.left)):(0,n.isLeft)(m.right)?(0,n.left)(u(m.right.left)):(0,n.right)((0,n.right)(m.right.right))})};n.URI="Either";var D=function(o,u){return{show:function(m){return(0,n.isLeft)(m)?"left(".concat(o.show(m.left),")"):"right(".concat(u.show(m.right),")")}}};n.getShow=D;var K=function(o,u){return{equals:function(m,q){return m===q||((0,n.isLeft)(m)?(0,n.isLeft)(q)&&o.equals(m.left,q.left):(0,n.isRight)(q)&&u.equals(m.right,q.right))}}};n.getEq=K;var z=function(o){return{concat:function(u,m){return(0,n.isLeft)(m)?u:(0,n.isLeft)(u)?m:(0,n.right)(o.concat(u.right,m.right))}}};n.getSemigroup=z;var cn=function(o){var u=(0,n.left)(o.empty);return{URI:n.URI,_E:void 0,compact:function(m){return(0,n.isLeft)(m)?m:m.right._tag==="None"?u:(0,n.right)(m.right.value)},separate:function(m){return(0,n.isLeft)(m)?(0,M.separated)(m,m):(0,n.isLeft)(m.right)?(0,M.separated)((0,n.right)(m.right.left),u):(0,M.separated)(u,(0,n.right)(m.right.right))}}};n.getCompactable=cn;var an=function(o){var u=(0,n.left)(o.empty),m=(0,n.getCompactable)(o),q=m.compact,Z=m.separate,bn=function(B,c){return(0,n.isLeft)(B)||c(B.right)?B:u},ye=function(B,c){return(0,n.isLeft)(B)?(0,M.separated)(B,B):c(B.right)?(0,M.separated)(u,(0,n.right)(B.right)):(0,M.separated)((0,n.right)(B.right),u)};return{URI:n.URI,_E:void 0,map:O,compact:q,separate:Z,filter:bn,filterMap:function(B,c){if((0,n.isLeft)(B))return B;var h=c(B.right);return h._tag==="None"?u:(0,n.right)(h.value)},partition:ye,partitionMap:function(B,c){if((0,n.isLeft)(B))return(0,M.separated)(B,B);var h=c(B.right);return(0,n.isLeft)(h)?(0,M.separated)((0,n.right)(h.left),u):(0,M.separated)(u,(0,n.right)(h.right))}}};n.getFilterable=an;var un=function(o){var u=(0,n.getFilterable)(o),m=(0,n.getCompactable)(o);return{URI:n.URI,_E:void 0,map:O,compact:u.compact,separate:u.separate,filter:u.filter,filterMap:u.filterMap,partition:u.partition,partitionMap:u.partitionMap,traverse:R,sequence:n.sequence,reduce:X,foldMap:I,reduceRight:s,wither:(0,E.witherDefault)(n.Traversable,m),wilt:(0,E.wiltDefault)(n.Traversable,m)}};n.getWitherable=un;var In=function(o){return{URI:n.URI,_E:void 0,map:O,ap:function(u,m){return(0,n.isLeft)(u)?(0,n.isLeft)(m)?(0,n.left)(o.concat(u.left,m.left)):u:(0,n.isLeft)(m)?m:(0,n.right)(u.right(m.right))},of:n.of}};n.getApplicativeValidation=In;var W=function(o){return{URI:n.URI,_E:void 0,map:O,alt:function(u,m){if((0,n.isRight)(u))return u;var q=m();return(0,n.isLeft)(q)?(0,n.left)(o.concat(u.left,q.left)):q}}};n.getAltValidation=W;var x=function(o){return function(u){return(0,n.isLeft)(u)?u:(0,n.right)(o(u.right))}};n.map=x,n.Functor={URI:n.URI,map:O},n.of=n.right,n.Pointed={URI:n.URI,of:n.of};var G=function(o){return function(u){return(0,n.isLeft)(u)?u:(0,n.isLeft)(o)?o:(0,n.right)(u.right(o.right))}};n.apW=G,n.ap=n.apW,n.Apply={URI:n.URI,map:O,ap:F},n.Applicative={URI:n.URI,map:O,ap:F,of:n.of};var ln=function(o){return function(u){return(0,n.isLeft)(u)?u:o(u.right)}};n.chainW=ln,n.chain=n.chainW,n.Chain={URI:n.URI,map:O,ap:F,chain:p},n.Monad={URI:n.URI,map:O,ap:F,of:n.of,chain:p};var yn=function(o,u){return function(m){return(0,n.isLeft)(m)?o:u(o,m.right)}};n.reduce=yn;var Cn=function(o){return function(u){return function(m){return(0,n.isLeft)(m)?o.empty:u(m.right)}}};n.foldMap=Cn;var En=function(o,u){return function(m){return(0,n.isLeft)(m)?o:u(m.right,o)}};n.reduceRight=En,n.Foldable={URI:n.URI,reduce:X,foldMap:I,reduceRight:s};var Xn=function(o){return function(u){return function(m){return(0,n.isLeft)(m)?o.of((0,n.left)(m.left)):o.map(u(m.right),n.right)}}};n.traverse=Xn;var Zn=function(o){return function(u){return(0,n.isLeft)(u)?o.of((0,n.left)(u.left)):o.map(u.right,n.right)}};n.sequence=Zn,n.Traversable={URI:n.URI,map:O,reduce:X,foldMap:I,reduceRight:s,traverse:R,sequence:n.sequence};var kn=function(o,u){return function(m){return(0,n.isLeft)(m)?(0,n.left)(o(m.left)):(0,n.right)(u(m.right))}};n.bimap=kn;var Qn=function(o){return function(u){return(0,n.isLeft)(u)?(0,n.left)(o(u.left)):u}};n.mapLeft=Qn,n.Bifunctor={URI:n.URI,bimap:f,mapLeft:l};var $n=function(o){return function(u){return(0,n.isLeft)(u)?o():u}};n.altW=$n,n.alt=n.altW,n.Alt={URI:n.URI,map:O,alt:v};var zn=function(o){return function(u){return(0,n.isLeft)(u)?u:(0,n.right)(o(u))}};n.extend=zn,n.Extend={URI:n.URI,map:O,extend:_},n.ChainRec={URI:n.URI,map:O,ap:F,chain:p,chainRec:L},n.throwError=n.left,n.MonadThrow={URI:n.URI,map:O,ap:F,of:n.of,chain:p,throwError:n.throwError},n.FromEither={URI:n.URI,fromEither:S.identity},n.fromPredicate=(0,g.fromPredicate)(n.FromEither),n.fromOption=(0,g.fromOption)(n.FromEither),n.isLeft=w.isLeft,n.isRight=w.isRight;var xn=function(o,u){return function(m){return(0,n.isLeft)(m)?o(m.left):u(m.right)}};n.matchW=xn,n.foldW=n.matchW,n.match=n.matchW,n.fold=n.match;var ne=function(o){return function(u){return(0,n.isLeft)(u)?o(u.left):u.right}};n.getOrElseW=ne,n.getOrElse=n.getOrElseW,n.flap=(0,y.flap)(n.Functor),n.apFirst=(0,i.apFirst)(n.Apply),n.apFirstW=n.apFirst,n.apSecond=(0,i.apSecond)(n.Apply),n.apSecondW=n.apSecond,n.chainFirst=(0,d.chainFirst)(n.Chain),n.chainFirstW=n.chainFirst,n.flattenW=(0,n.chainW)(S.identity),n.flatten=n.flattenW,n.duplicate=(0,n.extend)(S.identity),n.fromOptionK=(0,g.fromOptionK)(n.FromEither),n.chainOptionK=(0,g.chainOptionK)(n.FromEither,n.Chain),n.filterOrElse=(0,g.filterOrElse)(n.FromEither,n.Chain),n.filterOrElseW=n.filterOrElse;var ee=function(o){return(0,n.isLeft)(o)?(0,n.right)(o.left):(0,n.left)(o.right)};n.swap=ee;var te=function(o){return function(u){return(0,n.isLeft)(u)?o(u.left):u}};n.orElseW=te,n.orElse=n.orElseW;var re=function(o){return function(u){return u==null?(0,n.left)(o):(0,n.right)(u)}};n.fromNullable=re;var ae=function(o,u){try{return(0,n.right)(o())}catch(m){return(0,n.left)(u(m))}};n.tryCatch=ae;var ie=function(o,u){return function(){for(var m=[],q=0;q<arguments.length;q++)m[q]=arguments[q];return(0,n.tryCatch)(function(){return o.apply(void 0,m)},u)}};n.tryCatchK=ie;var On=function(o){var u=(0,n.fromNullable)(o);return function(m){return(0,S.flow)(m,u)}};n.fromNullableK=On;var Pn=function(o){var u=(0,n.fromNullableK)(o);return function(m){return(0,n.chain)(u(m))}};n.chainNullableK=Pn,n.toUnion=(0,n.foldW)(S.identity,S.identity);function ue(o){return o instanceof Error?o:new Error(String(o))}n.toError=ue;function Fn(o){return function(u,m){if(m===void 0){var q=Fn(o);return function(Z){return q(u,Z)}}return(0,n.isLeft)(m)?!1:o.equals(u,m.right)}}n.elem=Fn;var le=function(o){return function(u){return(0,n.isLeft)(u)?!1:o(u.right)}};n.exists=le,n.Do=(0,n.of)(w.emptyRecord),n.bindTo=(0,y.bindTo)(n.Functor),n.bind=(0,d.bind)(n.Chain),n.bindW=n.bind,n.apS=(0,i.apS)(n.Apply),n.apSW=n.apS,n.ApT=(0,n.of)(w.emptyReadonlyArray);var ce=function(o){return function(u){var m=o(0,w.head(u));if((0,n.isLeft)(m))return m;for(var q=[m.right],Z=1;Z<u.length;Z++){var bn=o(Z,u[Z]);if((0,n.isLeft)(bn))return bn;q.push(bn.right)}return(0,n.right)(q)}};n.traverseReadonlyNonEmptyArrayWithIndex=ce;var oe=function(o){var u=(0,n.traverseReadonlyNonEmptyArrayWithIndex)(o);return function(m){return w.isNonEmpty(m)?u(m):n.ApT}};n.traverseReadonlyArrayWithIndex=oe,n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex;var fe=function(o){return(0,n.traverseReadonlyArrayWithIndex)(function(u,m){return o(m)})};n.traverseArray=fe,n.sequenceArray=(0,n.traverseArray)(S.identity);function he(o,u){return(0,n.tryCatch)(function(){return JSON.parse(o)},u)}n.parseJSON=he;var de=function(o,u){return(0,n.tryCatch)(function(){var m=JSON.stringify(o);if(typeof m!="string")throw new Error("Converting unsupported structure to JSON");return m},u)};n.stringifyJSON=de,n.either={URI:n.URI,map:O,of:n.of,ap:F,chain:p,reduce:X,foldMap:I,reduceRight:s,traverse:R,sequence:n.sequence,bimap:f,mapLeft:l,alt:v,extend:_,chainRec:L,throwError:n.throwError},n.getApplySemigroup=(0,i.getApplySemigroup)(n.Apply),n.getApplyMonoid=(0,a.getApplicativeMonoid)(n.Applicative);var ge=function(o,u){return(0,i.getApplySemigroup)((0,n.getApplicativeValidation)(o))(u)};n.getValidationSemigroup=ge;var me=function(o,u){return(0,a.getApplicativeMonoid)((0,n.getApplicativeValidation)(o))(u)};n.getValidationMonoid=me;function ve(o){var u=(0,n.getApplicativeValidation)(o).ap,m=(0,n.getAltValidation)(o).alt;return{URI:n.URI,_E:void 0,map:O,of:n.of,chain:p,bimap:f,mapLeft:l,reduce:X,foldMap:I,reduceRight:s,extend:_,traverse:R,sequence:n.sequence,chainRec:L,throwError:n.throwError,ap:u,alt:m}}n.getValidation=ve})(We);var Ve={},ct={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.and=n.or=n.not=n.Contravariant=n.getMonoidAll=n.getSemigroupAll=n.getMonoidAny=n.getSemigroupAny=n.URI=n.contramap=void 0;var e=Q,t=function(w,M){return(0,e.pipe)(w,(0,n.contramap)(M))},r=function(w){return function(M){return(0,e.flow)(w,M)}};n.contramap=r,n.URI="Predicate";var a=function(){return{concat:function(w,M){return(0,e.pipe)(w,(0,n.or)(M))}}};n.getSemigroupAny=a;var i=function(){return{concat:(0,n.getSemigroupAny)().concat,empty:e.constFalse}};n.getMonoidAny=i;var d=function(){return{concat:function(w,M){return(0,e.pipe)(w,(0,n.and)(M))}}};n.getSemigroupAll=d;var b=function(){return{concat:(0,n.getSemigroupAll)().concat,empty:e.constTrue}};n.getMonoidAll=b,n.Contravariant={URI:n.URI,contramap:t};var g=function(w){return function(M){return!w(M)}};n.not=g;var S=function(w){return function(M){return function(E){return M(E)||w(E)}}};n.or=S;var y=function(w){return function(M){return function(E){return M(E)&&w(E)}}};n.and=y})(ct);var ot={},rn={};Object.defineProperty(rn,"__esModule",{value:!0});rn.concatAll=rn.endo=rn.filterSecond=rn.filterFirst=rn.reverse=void 0;var xr=function(n){return{concat:function(e,t){return n.concat(t,e)}}};rn.reverse=xr;var na=function(n){return function(e){return{concat:function(t,r){return n(t)?e.concat(t,r):r}}}};rn.filterFirst=na;var ea=function(n){return function(e){return{concat:function(t,r){return n(r)?e.concat(t,r):t}}}};rn.filterSecond=ea;var ta=function(n){return function(e){return{concat:function(t,r){return e.concat(n(t),n(r))}}}};rn.endo=ta;var ra=function(n){return function(e){return function(t){return t.reduce(function(r,a){return n.concat(r,a)},e)}}};rn.concatAll=ra;(function(n){var e=N&&N.__createBinding||(Object.create?function(I,s,R,f){f===void 0&&(f=R);var l=Object.getOwnPropertyDescriptor(s,R);(!l||("get"in l?!s.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return s[R]}}),Object.defineProperty(I,f,l)}:function(I,s,R,f){f===void 0&&(f=R),I[f]=s[R]}),t=N&&N.__setModuleDefault||(Object.create?function(I,s){Object.defineProperty(I,"default",{enumerable:!0,value:s})}:function(I,s){I.default=s}),r=N&&N.__importStar||function(I){if(I&&I.__esModule)return I;var s={};if(I!=null)for(var R in I)R!=="default"&&Object.prototype.hasOwnProperty.call(I,R)&&e(s,I,R);return t(s,I),s};Object.defineProperty(n,"__esModule",{value:!0}),n.semigroupProduct=n.semigroupSum=n.semigroupString=n.getFunctionSemigroup=n.semigroupAny=n.semigroupAll=n.fold=n.getIntercalateSemigroup=n.getMeetSemigroup=n.getJoinSemigroup=n.getDualSemigroup=n.getStructSemigroup=n.getTupleSemigroup=n.getFirstSemigroup=n.getLastSemigroup=n.getObjectSemigroup=n.semigroupVoid=n.concatAll=n.last=n.first=n.intercalate=n.tuple=n.struct=n.reverse=n.constant=n.max=n.min=void 0;var a=Q,i=r(T),d=r(rn),b=r(tt),g=function(I){return{concat:b.min(I)}};n.min=g;var S=function(I){return{concat:b.max(I)}};n.max=S;var y=function(I){return{concat:function(){return I}}};n.constant=y,n.reverse=d.reverse;var w=function(I){return{concat:function(s,R){var f={};for(var l in I)i.has.call(I,l)&&(f[l]=I[l].concat(s[l],R[l]));return f}}};n.struct=w;var M=function(){for(var I=[],s=0;s<arguments.length;s++)I[s]=arguments[s];return{concat:function(R,f){return I.map(function(l,v){return l.concat(R[v],f[v])})}}};n.tuple=M;var E=function(I){return function(s){return{concat:function(R,f){return s.concat(R,s.concat(I,f))}}}};n.intercalate=E;var O=function(){return{concat:a.identity}};n.first=O;var F=function(){return{concat:function(I,s){return s}}};n.last=F,n.concatAll=d.concatAll,n.semigroupVoid=(0,n.constant)(void 0);var p=function(){return{concat:function(I,s){return Object.assign({},I,s)}}};n.getObjectSemigroup=p,n.getLastSemigroup=n.last,n.getFirstSemigroup=n.first,n.getTupleSemigroup=n.tuple,n.getStructSemigroup=n.struct,n.getDualSemigroup=n.reverse,n.getJoinSemigroup=n.max,n.getMeetSemigroup=n.min,n.getIntercalateSemigroup=n.intercalate;function X(I){var s=(0,n.concatAll)(I);return function(R,f){return f===void 0?s(R):s(R)(f)}}n.fold=X,n.semigroupAll={concat:function(I,s){return I&&s}},n.semigroupAny={concat:function(I,s){return I||s}},n.getFunctionSemigroup=a.getSemigroup,n.semigroupString={concat:function(I,s){return I+s}},n.semigroupSum={concat:function(I,s){return I+s}},n.semigroupProduct={concat:function(I,s){return I*s}}})(ot);var Hn={};Object.defineProperty(Hn,"__esModule",{value:!0});Hn.guard=void 0;function aa(n,e){return function(t){return t?e.of(void 0):n.zero()}}Hn.guard=aa;(function(n){var e=N&&N.__createBinding||(Object.create?function(c,h,A,V){V===void 0&&(V=A);var nn=Object.getOwnPropertyDescriptor(h,A);(!nn||("get"in nn?!h.__esModule:nn.writable||nn.configurable))&&(nn={enumerable:!0,get:function(){return h[A]}}),Object.defineProperty(c,V,nn)}:function(c,h,A,V){V===void 0&&(V=A),c[V]=h[A]}),t=N&&N.__setModuleDefault||(Object.create?function(c,h){Object.defineProperty(c,"default",{enumerable:!0,value:h})}:function(c,h){c.default=h}),r=N&&N.__importStar||function(c){if(c&&c.__esModule)return c;var h={};if(c!=null)for(var A in c)A!=="default"&&Object.prototype.hasOwnProperty.call(c,A)&&e(h,c,A);return t(h,c),h};Object.defineProperty(n,"__esModule",{value:!0}),n.fromEither=n.MonadThrow=n.throwError=n.Witherable=n.wilt=n.wither=n.Traversable=n.sequence=n.traverse=n.Filterable=n.partitionMap=n.partition=n.filterMap=n.filter=n.Compactable=n.separate=n.compact=n.Extend=n.extend=n.Alternative=n.guard=n.Zero=n.zero=n.Alt=n.alt=n.altW=n.Foldable=n.reduceRight=n.foldMap=n.reduce=n.Monad=n.Chain=n.chain=n.Applicative=n.Apply=n.ap=n.Pointed=n.of=n.Functor=n.map=n.getMonoid=n.getOrd=n.getEq=n.getShow=n.URI=n.getRight=n.getLeft=n.fromPredicate=n.some=n.none=void 0,n.getLastMonoid=n.getFirstMonoid=n.getApplyMonoid=n.getApplySemigroup=n.option=n.mapNullable=n.getRefinement=n.sequenceArray=n.traverseArray=n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex=n.traverseReadonlyNonEmptyArrayWithIndex=n.ApT=n.apS=n.bind=n.bindTo=n.Do=n.exists=n.elem=n.toUndefined=n.toNullable=n.chainNullableK=n.fromNullableK=n.tryCatchK=n.tryCatch=n.fromNullable=n.chainFirstEitherK=n.chainEitherK=n.fromEitherK=n.duplicate=n.chainFirst=n.flatten=n.apSecond=n.apFirst=n.flap=n.getOrElse=n.getOrElseW=n.fold=n.match=n.foldW=n.matchW=n.isNone=n.isSome=n.FromEither=void 0;var a=vn,i=H,d=dn,b=J,g=Q,S=$,y=r(T),w=ct,M=ot,E=Be,O=hn,F=Hn;n.none=y.none,n.some=y.some;function p(c){return function(h){return c(h)?(0,n.some)(h):n.none}}n.fromPredicate=p;var X=function(c){return c._tag==="Right"?n.none:(0,n.some)(c.left)};n.getLeft=X;var I=function(c){return c._tag==="Left"?n.none:(0,n.some)(c.right)};n.getRight=I;var s=function(c,h){return(0,g.pipe)(c,(0,n.map)(h))},R=function(c,h){return(0,g.pipe)(c,(0,n.ap)(h))},f=function(c,h){return(0,g.pipe)(c,(0,n.chain)(h))},l=function(c,h,A){return(0,g.pipe)(c,(0,n.reduce)(h,A))},v=function(c){var h=(0,n.foldMap)(c);return function(A,V){return(0,g.pipe)(A,h(V))}},_=function(c,h,A){return(0,g.pipe)(c,(0,n.reduceRight)(h,A))},L=function(c){var h=(0,n.traverse)(c);return function(A,V){return(0,g.pipe)(A,h(V))}},D=function(c,h){return(0,g.pipe)(c,(0,n.alt)(h))},K=function(c,h){return(0,g.pipe)(c,(0,n.filter)(h))},z=function(c,h){return(0,g.pipe)(c,(0,n.filterMap)(h))},cn=function(c,h){return(0,g.pipe)(c,(0,n.extend)(h))},an=function(c,h){return(0,g.pipe)(c,(0,n.partition)(h))},un=function(c,h){return(0,g.pipe)(c,(0,n.partitionMap)(h))};n.URI="Option";var In=function(c){return{show:function(h){return(0,n.isNone)(h)?"none":"some(".concat(c.show(h.value),")")}}};n.getShow=In;var W=function(c){return{equals:function(h,A){return h===A||((0,n.isNone)(h)?(0,n.isNone)(A):(0,n.isNone)(A)?!1:c.equals(h.value,A.value))}}};n.getEq=W;var x=function(c){return{equals:(0,n.getEq)(c).equals,compare:function(h,A){return h===A?0:(0,n.isSome)(h)?(0,n.isSome)(A)?c.compare(h.value,A.value):1:-1}}};n.getOrd=x;var G=function(c){return{concat:function(h,A){return(0,n.isNone)(h)?A:(0,n.isNone)(A)?h:(0,n.some)(c.concat(h.value,A.value))},empty:n.none}};n.getMonoid=G;var ln=function(c){return function(h){return(0,n.isNone)(h)?n.none:(0,n.some)(c(h.value))}};n.map=ln,n.Functor={URI:n.URI,map:s},n.of=n.some,n.Pointed={URI:n.URI,of:n.of};var yn=function(c){return function(h){return(0,n.isNone)(h)||(0,n.isNone)(c)?n.none:(0,n.some)(h.value(c.value))}};n.ap=yn,n.Apply={URI:n.URI,map:s,ap:R},n.Applicative={URI:n.URI,map:s,ap:R,of:n.of};var Cn=function(c){return function(h){return(0,n.isNone)(h)?n.none:c(h.value)}};n.chain=Cn,n.Chain={URI:n.URI,map:s,ap:R,chain:f},n.Monad={URI:n.URI,map:s,ap:R,of:n.of,chain:f};var En=function(c,h){return function(A){return(0,n.isNone)(A)?c:h(c,A.value)}};n.reduce=En;var Xn=function(c){return function(h){return function(A){return(0,n.isNone)(A)?c.empty:h(A.value)}}};n.foldMap=Xn;var Zn=function(c,h){return function(A){return(0,n.isNone)(A)?c:h(A.value,c)}};n.reduceRight=Zn,n.Foldable={URI:n.URI,reduce:l,foldMap:v,reduceRight:_};var kn=function(c){return function(h){return(0,n.isNone)(h)?c():h}};n.altW=kn,n.alt=n.altW,n.Alt={URI:n.URI,map:s,alt:D};var Qn=function(){return n.none};n.zero=Qn,n.Zero={URI:n.URI,zero:n.zero},n.guard=(0,F.guard)(n.Zero,n.Pointed),n.Alternative={URI:n.URI,map:s,ap:R,of:n.of,alt:D,zero:n.zero};var $n=function(c){return function(h){return(0,n.isNone)(h)?n.none:(0,n.some)(c(h))}};n.extend=$n,n.Extend={URI:n.URI,map:s,extend:cn},n.compact=(0,n.chain)(g.identity);var zn=(0,E.separated)(n.none,n.none),xn=function(c){return(0,n.isNone)(c)?zn:(0,E.separated)((0,n.getLeft)(c.value),(0,n.getRight)(c.value))};n.separate=xn,n.Compactable={URI:n.URI,compact:n.compact,separate:n.separate};var ne=function(c){return function(h){return(0,n.isNone)(h)?n.none:c(h.value)?h:n.none}};n.filter=ne;var ee=function(c){return function(h){return(0,n.isNone)(h)?n.none:c(h.value)}};n.filterMap=ee;var te=function(c){return function(h){return(0,E.separated)(K(h,(0,w.not)(c)),K(h,c))}};n.partition=te;var re=function(c){return(0,g.flow)((0,n.map)(c),n.separate)};n.partitionMap=re,n.Filterable={URI:n.URI,map:s,compact:n.compact,separate:n.separate,filter:K,filterMap:z,partition:an,partitionMap:un};var ae=function(c){return function(h){return function(A){return(0,n.isNone)(A)?c.of(n.none):c.map(h(A.value),n.some)}}};n.traverse=ae;var ie=function(c){return function(h){return(0,n.isNone)(h)?c.of(n.none):c.map(h.value,n.some)}};n.sequence=ie,n.Traversable={URI:n.URI,map:s,reduce:l,foldMap:v,reduceRight:_,traverse:L,sequence:n.sequence};var On=(0,O.witherDefault)(n.Traversable,n.Compactable),Pn=(0,O.wiltDefault)(n.Traversable,n.Compactable),ue=function(c){var h=On(c);return function(A){return function(V){return h(V,A)}}};n.wither=ue;var Fn=function(c){var h=Pn(c);return function(A){return function(V){return h(V,A)}}};n.wilt=Fn,n.Witherable={URI:n.URI,map:s,reduce:l,foldMap:v,reduceRight:_,traverse:L,sequence:n.sequence,compact:n.compact,separate:n.separate,filter:K,filterMap:z,partition:an,partitionMap:un,wither:On,wilt:Pn};var le=function(){return n.none};n.throwError=le,n.MonadThrow={URI:n.URI,map:s,ap:R,of:n.of,chain:f,throwError:n.throwError},n.fromEither=n.getRight,n.FromEither={URI:n.URI,fromEither:n.fromEither},n.isSome=y.isSome;var ce=function(c){return c._tag==="None"};n.isNone=ce;var oe=function(c,h){return function(A){return(0,n.isNone)(A)?c():h(A.value)}};n.matchW=oe,n.foldW=n.matchW,n.match=n.matchW,n.fold=n.match;var fe=function(c){return function(h){return(0,n.isNone)(h)?c():h.value}};n.getOrElseW=fe,n.getOrElse=n.getOrElseW,n.flap=(0,S.flap)(n.Functor),n.apFirst=(0,i.apFirst)(n.Apply),n.apSecond=(0,i.apSecond)(n.Apply),n.flatten=n.compact,n.chainFirst=(0,d.chainFirst)(n.Chain),n.duplicate=(0,n.extend)(g.identity),n.fromEitherK=(0,b.fromEitherK)(n.FromEither),n.chainEitherK=(0,b.chainEitherK)(n.FromEither,n.Chain),n.chainFirstEitherK=(0,b.chainFirstEitherK)(n.FromEither,n.Chain);var he=function(c){return c==null?n.none:(0,n.some)(c)};n.fromNullable=he;var de=function(c){try{return(0,n.some)(c())}catch{return n.none}};n.tryCatch=de;var ge=function(c){return function(){for(var h=[],A=0;A<arguments.length;A++)h[A]=arguments[A];return(0,n.tryCatch)(function(){return c.apply(void 0,h)})}};n.tryCatchK=ge;var me=function(c){return(0,g.flow)(c,n.fromNullable)};n.fromNullableK=me;var ve=function(c){return function(h){return(0,n.isNone)(h)?n.none:(0,n.fromNullable)(c(h.value))}};n.chainNullableK=ve,n.toNullable=(0,n.match)(g.constNull,g.identity),n.toUndefined=(0,n.match)(g.constUndefined,g.identity);function o(c){return function(h,A){if(A===void 0){var V=o(c);return function(nn){return V(h,nn)}}return(0,n.isNone)(A)?!1:c.equals(h,A.value)}}n.elem=o;var u=function(c){return function(h){return(0,n.isNone)(h)?!1:c(h.value)}};n.exists=u,n.Do=(0,n.of)(y.emptyRecord),n.bindTo=(0,S.bindTo)(n.Functor),n.bind=(0,d.bind)(n.Chain),n.apS=(0,i.apS)(n.Apply),n.ApT=(0,n.of)(y.emptyReadonlyArray);var m=function(c){return function(h){var A=c(0,y.head(h));if((0,n.isNone)(A))return n.none;for(var V=[A.value],nn=1;nn<h.length;nn++){var Je=c(nn,h[nn]);if((0,n.isNone)(Je))return n.none;V.push(Je.value)}return(0,n.some)(V)}};n.traverseReadonlyNonEmptyArrayWithIndex=m;var q=function(c){var h=(0,n.traverseReadonlyNonEmptyArrayWithIndex)(c);return function(A){return y.isNonEmpty(A)?h(A):n.ApT}};n.traverseReadonlyArrayWithIndex=q,n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex;var Z=function(c){return(0,n.traverseReadonlyArrayWithIndex)(function(h,A){return c(A)})};n.traverseArray=Z,n.sequenceArray=(0,n.traverseArray)(g.identity);function bn(c){return function(h){return(0,n.isSome)(c(h))}}n.getRefinement=bn,n.mapNullable=n.chainNullableK,n.option={URI:n.URI,map:s,of:n.of,ap:R,chain:f,reduce:l,foldMap:v,reduceRight:_,traverse:L,sequence:n.sequence,zero:n.zero,alt:D,extend:cn,compact:n.compact,separate:n.separate,filter:K,filterMap:z,partition:an,partitionMap:un,wither:On,wilt:Pn,throwError:n.throwError},n.getApplySemigroup=(0,i.getApplySemigroup)(n.Apply),n.getApplyMonoid=(0,a.getApplicativeMonoid)(n.Applicative);var ye=function(){return(0,n.getMonoid)((0,M.first)())};n.getFirstMonoid=ye;var B=function(){return(0,n.getMonoid)((0,M.last)())};n.getLastMonoid=B})(Ve);var ft={};(function(n){var e=N&&N.__createBinding||(Object.create?function(R,f,l,v){v===void 0&&(v=l);var _=Object.getOwnPropertyDescriptor(f,l);(!_||("get"in _?!f.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return f[l]}}),Object.defineProperty(R,v,_)}:function(R,f,l,v){v===void 0&&(v=l),R[v]=f[l]}),t=N&&N.__setModuleDefault||(Object.create?function(R,f){Object.defineProperty(R,"default",{enumerable:!0,value:f})}:function(R,f){R.default=f}),r=N&&N.__importStar||function(R){if(R&&R.__esModule)return R;var f={};if(R!=null)for(var l in R)l!=="default"&&Object.prototype.hasOwnProperty.call(R,l)&&e(f,R,l);return t(f,R),f};Object.defineProperty(n,"__esModule",{value:!0}),n.getMonoid=n.getSemigroup=n.io=n.sequenceArray=n.traverseArray=n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex=n.traverseReadonlyNonEmptyArrayWithIndex=n.ApT=n.apS=n.bind=n.bindTo=n.Do=n.FromIO=n.ChainRec=n.MonadIO=n.fromIO=n.chainFirst=n.Monad=n.Chain=n.Applicative=n.apSecond=n.apFirst=n.Apply=n.Pointed=n.flap=n.Functor=n.URI=n.flatten=n.chain=n.of=n.ap=n.map=void 0;var a=vn,i=H,d=dn,b=Q,g=$,S=r(T),y=function(R,f){return function(){return f(R())}},w=function(R,f){return function(){return R()(f())}},M=function(R,f){return function(){return f(R())()}},E=function(R,f){return function(){for(var l=f(R)();l._tag==="Left";)l=f(l.left)();return l.right}},O=function(R){return function(f){return y(f,R)}};n.map=O;var F=function(R){return function(f){return w(f,R)}};n.ap=F,n.of=b.constant;var p=function(R){return function(f){return M(f,R)}};n.chain=p,n.flatten=(0,n.chain)(b.identity),n.URI="IO",n.Functor={URI:n.URI,map:y},n.flap=(0,g.flap)(n.Functor),n.Pointed={URI:n.URI,of:n.of},n.Apply={URI:n.URI,map:y,ap:w},n.apFirst=(0,i.apFirst)(n.Apply),n.apSecond=(0,i.apSecond)(n.Apply),n.Applicative={URI:n.URI,map:y,ap:w,of:n.of},n.Chain={URI:n.URI,map:y,ap:w,chain:M},n.Monad={URI:n.URI,map:y,ap:w,of:n.of,chain:M},n.chainFirst=(0,d.chainFirst)(n.Chain),n.fromIO=b.identity,n.MonadIO={URI:n.URI,map:y,ap:w,of:n.of,chain:M,fromIO:n.fromIO},n.ChainRec={URI:n.URI,map:y,ap:w,chain:M,chainRec:E},n.FromIO={URI:n.URI,fromIO:b.identity},n.Do=(0,n.of)(S.emptyRecord),n.bindTo=(0,g.bindTo)(n.Functor),n.bind=(0,d.bind)(n.Chain),n.apS=(0,i.apS)(n.Apply),n.ApT=(0,n.of)(S.emptyReadonlyArray);var X=function(R){return function(f){return function(){for(var l=[R(0,S.head(f))()],v=1;v<f.length;v++)l.push(R(v,f[v])());return l}}};n.traverseReadonlyNonEmptyArrayWithIndex=X;var I=function(R){var f=(0,n.traverseReadonlyNonEmptyArrayWithIndex)(R);return function(l){return S.isNonEmpty(l)?f(l):n.ApT}};n.traverseReadonlyArrayWithIndex=I,n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex;var s=function(R){return(0,n.traverseReadonlyArrayWithIndex)(function(f,l){return R(l)})};n.traverseArray=s,n.sequenceArray=(0,n.traverseArray)(b.identity),n.io={URI:n.URI,map:y,of:n.of,ap:w,chain:M,fromIO:n.fromIO,chainRec:E},n.getSemigroup=(0,i.getApplySemigroup)(n.Apply),n.getMonoid=(0,a.getApplicativeMonoid)(n.Applicative)})(ft);const{pipe:Y,flow:Ni,constant:Ui,identity:Ti,tupled:Li,constVoid:Ci}=xt;De(We.Apply);De(Ve.Apply);Gn(We.Apply);Gn(Ve.Apply);Gn(ft.Apply);const C=(n,e,t)=>n+(e-n)*t,ht=(n,e)=>t=>[n(t),e(t)],dt=(n,e)=>t=>t==null?e():n(t),gt=(n,e,t,r)=>{const a=(r[0]-t[0])*(n[1]-t[1])-(r[1]-t[1])*(n[0]-t[0]),i=(t[1]-n[1])*(n[0]-e[0])-(t[0]-n[0])*(n[1]-e[1]),d=(r[1]-t[1])*(e[0]-n[0])-(r[0]-t[0])*(e[1]-n[1]);if(d==0)return null;const b=a/d,g=i/d;return b>=0&&b<=1&&g>=0&&g<=1?{position:[C(n[0],e[0],b),C(n[1],e[1],b)],offset:b}:null},ia=(n,e)=>n.every((t,r)=>e.every((a,i)=>gt(t,n[(r+1)%n.length],a,e[(i+1)%e.length])==null)),se=mn(),Bn=mn(),Dn=mn(),Ae=mn({}),k={master:mn({gridSize:35,carAmount:500}),brain:mn({sensorCount:5,sensorLength:200,sensorSpread:Math.PI/2,minFitness:-400}),controls:mn({showNetwork:!0,cameraFocus:0,playerControls:!1,drawSensors:!1,cameraSpeed:.06,carThrust:2,maxSpeed:8,carTurnSpeed:.5,carBreakStrength:.4,friction:.04})},ua={gridSize:{type:"number",where:"master",min:2,max:100,step:1},carAmount:{type:"number",where:"master",min:2,max:1e3,step:10},cameraFocus:{type:"number",where:"controls",min:0,max:5,step:1},playerControls:{type:"checkbox",where:"controls"},showNetwork:{type:"checkbox",where:"controls"},drawSensors:{type:"checkbox",where:"controls"},sensorCount:{type:"number",where:"brain",min:1,max:30,step:1},sensorLength:{type:"number",where:"brain",min:60,max:300,step:20},sensorSpread:{type:"number",where:"brain",min:0,max:Math.PI,step:.3},minFitness:{type:"number",where:"brain",min:-3e3,max:0,step:50},cameraSpeed:{type:"number",where:"controls",min:0,max:.15,step:.001},carThrust:{type:"number",where:"controls",min:1,max:15,step:1},carTurnSpeed:{type:"number",where:"controls",min:.3,max:1.5,step:.1},carBreakStrength:{type:"number",where:"controls",min:.05,max:.3,step:.05},friction:{type:"number",where:"controls",min:.01,max:1,step:.01},maxSpeed:{type:"number",where:"controls",min:3,max:20,step:1}};k.master.subscribe(({carAmount:n})=>{ua.cameraFocus.max=n-1});let Ie=100,An=5;k.brain.subscribe(({sensorLength:n})=>{Ie=n});k.master.subscribe(({gridSize:n})=>{An=n});const Ee=(n,e)=>{const r=[Math.floor((n[0]/200+An)%An),Math.floor((n[1]/200+An)%An)],a=(r[0]+r[1]*An)*4,i=d=>d.map(b=>[(r[0]+b[0])*200,(r[1]+b[1])*200]);return[...e[a],...e[a+1],...e[a+2],...e[a+3]].map(i)},la=(n,e)=>[...Ee([n.x,n.y],e.borders),...mt(n,e)],ca=(n,e)=>[...Ee([n.x,n.y],e.borders),...Ee([n.x-Math.sin(n.angle)*Ie,n.y-Math.cos(n.angle)*Ie],e.borders),...mt(n,e)],mt=(n,e)=>e.polygons.reduce((t,r)=>[...t,...r.map((a,i)=>[a,r[(i+1)%r.length]])],[]),Vn=n=>{const e=[],t=Math.hypot(n.width,n.height)/2,r=Math.atan2(n.width,n.height);return e.push([n.x-Math.sin(-n.angle-r)*t,n.y-Math.cos(-n.angle-r)*t]),e.push([n.x-Math.sin(-n.angle+r)*t,n.y-Math.cos(-n.angle+r)*t]),e.push([n.x-Math.sin(Math.PI-n.angle-r)*t,n.y-Math.cos(Math.PI-n.angle-r)*t]),e.push([n.x-Math.sin(Math.PI-n.angle+r)*t,n.y-Math.cos(Math.PI-n.angle+r)*t]),{box:n,polygon:e}},oa=n=>e=>{const{box:t,polygon:r}=e;return!la(t,n).every(d=>ia(r,d))},pe=(n,e,t)=>({borders:e,polygons:t.filter(r=>r!==n&&fa(r.box,n.box)<=Math.max(r.box.width,r.box.height)).map(r=>Vn(r.box).polygon)}),fa=(n,e)=>Math.sqrt((n.x-e.x)**2+(n.y-e.y)**2);let vt=.04,Oe=5;k.controls.subscribe(({friction:n,maxSpeed:e})=>{vt=n,Oe=e});const ha=n=>e=>Y(n,da(e)),da=n=>e=>{var S,y,w,M;const t=(y=(S=n.physics)==null?void 0:S.mass)!=null?y:10,r=(M=(w=n.physics)==null?void 0:w.momentum)!=null?M:{direction:0,magnitude:0},{thrust:a,breaks:i,angle:d}=e,b=a/t,g=Math.max(Math.min(r.magnitude+b,Oe),-Oe);return n.physics={mass:t,momentum:{...r,magnitude:Math.max(Math.abs(g)-vt-i,0)*(g<0?-1:1)}},n.angle=(n.angle+d*g+Math.PI*2)%(Math.PI*2),n.x+=Math.sin(n.angle)*g,n.y-=Math.cos(n.angle)*g,n},ga=n=>e=>ha(e)(n),ma=n=>e=>(e.x=e.x<0?n.width:e.x>n.width?0:e.x,e.y=e.y<0?n.height:e.y>n.height?0:e.y,e);let yt=100,bt=-400;k.master.subscribe(n=>{const e=n.gridSize*200;yt=Math.sqrt(e**2+e**2)});k.brain.subscribe(({minFitness:n})=>{bt=n});const va=n=>n.map(e=>Y(e,_t,ba(e.brain))),_t=n=>n.performace+Sa(n)/yt*bt,ya=n=>_t(n),ba=n=>e=>({...n,reward:e}),_a=n=>(n.sort((e,t)=>t.reward-e.reward),n[0]),jn=2*Math.PI,St=n=>Math.atan((n.destination[0]-n.box.x)/(n.destination[1]-n.box.y))-(n.box.y<n.destination[1]?Math.PI:0),wt=n=>4*Math.abs((St(n)+n.box.angle+jn)%jn/jn-.5)-1,Sa=n=>Math.sqrt((n.destination[0]-n.box.x)**2+(n.destination[1]-n.box.y)**2),wa=n=>e=>{const[t,r]=n.destination;e.fillStyle="purple",e.beginPath(),e.arc(t,r,n.box.width/2,0,jn),e.fill(),e.strokeStyle="purple",e.beginPath(),e.setLineDash([9,3]),e.moveTo(n.box.x,n.box.y),e.lineTo(t,r),e.stroke();const a=St(n),i=[n.box.x,n.box.y],d=[n.box.x-Math.sin(a)*100,n.box.y-Math.cos(a)*100];e.strokeStyle="red",e.beginPath(),e.setLineDash([9,3]),e.moveTo(...i),e.lineTo(...d),e.stroke();const b=-n.box.angle,g=[n.box.x,n.box.y],S=[n.box.x-Math.sin(b)*100,n.box.y-Math.cos(b)*100];return e.strokeStyle="blue",e.beginPath(),e.setLineDash([9,3]),e.moveTo(...g),e.lineTo(...S),e.stroke(),e};let Kn=3,Pe=100,Ne=Math.PI/4;Bn.update(n=>n);k.brain.subscribe(({sensorCount:n,sensorLength:e,sensorSpread:t})=>{Kn=n,Pe=e,Ne=t});const Rt=n=>e=>Y(ca(e,n),t=>new Array(Kn*2).fill(0).map((r,a)=>{const i=a%2*Math.PI+C(Ne/2,-Ne/2,Kn==1?.5:Math.floor(a/2)/(Kn-1))-e.angle,d=[e.x,e.y],b=[e.x-Math.sin(i)*Pe,e.y-Math.cos(i)*Pe],g=t.map(S=>gt(d,b,...S)).filter(S=>S!=null);return g.sort((S,y)=>S.offset-y.offset),{start:d,end:b,contacts:g}})),Ra=(n,e,t)=>r=>Y(n.box,Rt(pe(n,e,t)),Ma(r),wa(n)),Ma=n=>e=>e.map(t=>{var a,i;const r=(i=(a=t.contacts[0])==null?void 0:a.position)!=null?i:t.end;return n.lineWidth=2,n.strokeStyle="yellow",n.beginPath(),n.moveTo(...t.start),n.lineTo(...r),n.stroke(),n.strokeStyle="black",n.beginPath(),n.moveTo(...t.end),n.lineTo(...r),n.stroke(),n})[0];k.controls.subscribe(({cameraFocus:n})=>{});const sa=n=>e=>e.map((t,r)=>t.dead?t:Y(t.box,Vn,oa(pe(t,n.borders,e)),Oa(t),Pa,Na)),Aa=n=>e=>e.map(t=>({car:t,sensor:Y(t.box,Rt(pe(t,n,e)))})),Ia=n=>e=>e.map(({car:t,action:r})=>Y(r,ga(t.box),ma(n.size)));let Mt=0;k.brain.subscribe(({minFitness:n})=>{Mt=n});const Ea=n=>e=>n.map(t=>{const r=Vn(t.box).polygon;e.beginPath(),e.fillStyle=t.dead?"red":t.color,r.forEach((i,d)=>d==0?e.moveTo(...i):e.lineTo(...i)),e.fill();const a={...t.box,height:t.box.height*Math.max(t.fitness/Mt,0)};return e.beginPath(),e.fillStyle="red",Vn(a).polygon.forEach((i,d)=>d==0?e.moveTo(...i):e.lineTo(...i)),e.fill(),e})[0],Oa=n=>e=>{var t,r;return e&&(n.performace-=Math.abs((r=(t=n.box.physics)==null?void 0:t.momentum.magnitude)!=null?r:0))*30,n.dead=e,n},Pa=n=>{var e,t;return n.performace+=((t=(e=n.box.physics)==null?void 0:e.momentum.magnitude)!=null?t:0)*wt(n)-1,n},Na=n=>n,ke={onkeydown:n=>{n.preventDefault(),pn[n.key]=La[n.key]||Ca},onkeyup:n=>{n.preventDefault(),delete pn[n.key]}},Ua=()=>{const n={...Ta};return Object.keys(pn).map(e=>pn[e](n)),n},Ta={thrust:0,breaks:0,angle:0};let Ue=3,Te=.1,Le=.5*Math.PI/180;k.controls.subscribe(({carThrust:n,carTurnSpeed:e,carBreakStrength:t})=>{Ue=n,Te=t,Le=e*Math.PI/180});const pn={},La={ArrowUp:n=>n.thrust=Ue,ArrowDown:n=>n.thrust=Ue*-.4,ArrowLeft:n=>n.angle=-Le,ArrowRight:n=>n.angle=Le,Shift:n=>n.breaks=Te,Space:n=>n.breaks=Te},Ca=n=>{};let st,At;se.subscribe(n=>{st=n});Bn.subscribe(n=>{At=n});const It=(n,e)=>{const t=document.getElementById(n)||Qe("error: declaring canvas returned null",st);t.width=e.width,t.height=e.height;const r=t.getContext("2d")||Qe("error: declaring context returned null",At);return{canvas:t,ctx:r}},Qe=(n,e)=>(console.error(n),e);let Me;const Fa="background-canvas",Wa=n=>e=>n.backgroundSaved?(e.drawImage(Me,0,0),e):(Me=Y(It(Fa,n.size),qa(n)),e.drawImage(Me,0,0),n.backgroundSaved=!0,e),qa=n=>e=>{const{canvas:t,ctx:r}=e,{map:a,size:i,dim:d}=n;r.fillStyle="green",r.fillRect(0,0,i.width,i.height);const b={width:i.width/d,height:i.height/d};return new Array(a.length).fill(0).map((g,S)=>{r.save(),r.translate(C(0,i.width,S%d/d)+b.width/2,C(0,i.height,Math.floor(S/d)/d)+b.height/2),r.rotate(a[S].rotate*90*Math.PI/180),r.translate(-b.width/2,-b.height/2),a[S].draw(r)(b),r.restore()}),t},Da=[[-1,-1],[0,1],[1,0],[0,-1],[-1,0],[1,-1],[-1,1],[1,1]],ja=(n,e,t,r)=>Ka(n,Da.filter(a=>!0),t);let Et=!1,Ot=0;k.controls.subscribe(({drawSensors:n,cameraFocus:e})=>{Ot=e,Et=n});const Ka=(n,e,t)=>{const r=a=>Y(a,Wa(n),Ea(t),Et?Ra(t[Ot],n.borders,t):i=>i);return a=>(e.forEach(i=>{a.save(),a.translate(n.size.width*i[0],n.size.height*i[1]),r(a),a.restore()}),r(a))},Pt=n=>e=>(e.clearRect(0,0,n.width,n.height),e),P=6,Sn=16,j=5,on="black",Tn="gray",tn=[0,0],Mn=[n=>e=>{n.fillStyle=Tn;const t=C(0,e.width,1/P);n.fillRect(t-j*2,0,e.width-t*2+j*4,e.height),n.lineWidth=j,n.strokeStyle=on;const r=e.height/Sn,a=[r,r];new Array(P-1).fill(0).forEach((i,d)=>{const b=C(0,e.width,(d+1)/P);n.beginPath(),n.setLineDash(d==0||d==P-2?tn:a),n.moveTo(b,0),n.lineTo(b,e.height),n.stroke()})},n=>e=>{n.fillStyle=Tn;const t={x:C(0,e.width,1/P),y:C(0,e.height,1/P)};n.fillRect(t.x-j*2,0,e.width-t.x*2+j*4,e.height),n.fillRect(0,t.y-j*2,e.width,e.height-t.y*2+j*4),n.fillStyle=on,n.beginPath(),n.arc(t.x,t.y,j/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(e.width-t.x,t.y,j/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(t.x,e.height-t.y,j/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(e.width-t.x,e.height-t.y,j/2,0,2*Math.PI),n.fill(),n.lineWidth=j,n.strokeStyle=on;const r=e.height/Sn,a=e.width/Sn,i=[r,r],d=[a,a];new Array(P-1).fill(0).forEach((b,g)=>{let S=C(0,e.width,(g+1)/P),y=C(0,e.height,1/P);n.setLineDash(g==0||g==P-2?tn:i),n.beginPath(),n.moveTo(S,0),n.lineTo(S,y),n.stroke(),n.beginPath(),n.moveTo(S,e.height-y),n.lineTo(S,e.height),n.stroke(),S=C(0,e.width,1/P),y=C(0,e.height,(g+1)/P),n.setLineDash(g==0||g==P-2?tn:d),n.beginPath(),n.moveTo(0,y),n.lineTo(S,y),n.stroke(),n.beginPath(),n.moveTo(e.width-S,y),n.lineTo(e.width,y),n.stroke()})},n=>e=>{n.fillStyle=Tn;const t={x:C(0,e.width,1/P),y:C(0,e.height,1/P)};n.fillRect(t.x-j*2,0,e.width-t.x*2+j*4,e.height),n.fillRect(0,t.y-j*2,e.width/2,e.height-t.y*2+j*4),n.fillStyle=on,n.beginPath(),n.arc(t.x,t.y,j/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(t.x,e.height-t.y,j/2,0,2*Math.PI),n.fill(),n.lineWidth=j,n.strokeStyle=on;const r=e.height/Sn,a=e.width/Sn,i=[r,r],d=[a,a];new Array(P-1).fill(0).forEach((b,g)=>{let S=C(0,e.width,(g+1)/P),y=C(0,e.height,1/P);g==P-2?(n.setLineDash(tn),n.beginPath(),n.moveTo(S,0),n.lineTo(S,e.height),n.stroke()):(n.setLineDash(g==0||g==P-2?tn:i),n.beginPath(),n.moveTo(S,0),n.lineTo(S,y),n.stroke(),n.beginPath(),n.moveTo(S,e.height-y),n.lineTo(S,e.height),n.stroke()),S=C(0,e.width,1/P),y=C(0,e.height,(g+1)/P),n.setLineDash(g==0||g==P-2?tn:d),n.beginPath(),n.moveTo(0,y),n.lineTo(S,y),n.stroke()})},n=>e=>{n.fillStyle=Tn;const t={x:C(0,e.width,1/P),y:C(0,e.height,1/P)};n.fillRect(t.x-j*2,0,e.width-t.x*2+j*4,e.height-t.y),n.fillRect(0,t.y-j*2,e.width-t.x+j*2,e.height-t.y*2+j*4),n.fillStyle=on,n.beginPath(),n.arc(t.x,t.y,j/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(e.width-t.x,e.height-t.y,j/2,0,2*Math.PI),n.fill(),n.lineWidth=j,n.strokeStyle=on;const r=e.height/Sn,a=[r,r];new Array(P-1).fill(0).forEach((i,d)=>{let b=C(0,e.width,(d+1)/P),g=C(0,e.height,1/P);d==P-2?(n.setLineDash(tn),n.beginPath(),n.moveTo(b,0),n.lineTo(b,e.height-t.y),n.stroke()):(n.setLineDash(d==0||d==P-2?tn:a),n.beginPath(),n.moveTo(b,0),n.lineTo(b,g),n.stroke()),b=C(0,e.width,1/P),g=C(0,e.height,(d+1)/P),d==P-2?(n.setLineDash(tn),n.beginPath(),n.moveTo(0,g),n.lineTo(e.width-t.x,g),n.stroke()):(n.setLineDash(d==0||d==P-2?tn:a),n.beginPath(),n.moveTo(0,g),n.lineTo(b,g),n.stroke())})},()=>()=>{},n=>e=>{n.fillStyle=Tn;const t={x:C(0,e.width,1/P),y:C(0,e.height,1/P)};n.fillRect(t.x-j*2,0,e.width-t.x*2+j*4,e.height-t.y+j*2),n.fillStyle=on,n.beginPath(),n.arc(t.x,e.height-t.y,j/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(e.width-t.x,e.height-t.y,j/2,0,2*Math.PI),n.fill(),n.lineWidth=j,n.strokeStyle=on;const r=e.height/Sn,a=[r,r];new Array(P-1).fill(0).forEach((i,d)=>{let b=C(0,e.width,(d+1)/P),g=C(0,e.height,1/P);d==0||d==P-2?(n.setLineDash(tn),n.beginPath(),n.moveTo(b,0),n.lineTo(b,e.height-t.y),n.stroke()):(n.setLineDash(a),n.beginPath(),n.moveTo(b,0),n.lineTo(b,g),n.stroke()),b=C(0,e.width,1/P),g=C(0,e.height,(d+1)/P),d==P-2&&(n.setLineDash(tn),n.beginPath(),n.moveTo(t.x,g),n.lineTo(e.width-t.x,g),n.stroke())})}],Ba=[()=>({rotate:0,draw:Mn[4]}),n=>({rotate:n.indexOf(!0),draw:Mn[5]}),n=>{const e=n[0]==n[2],t=e?n[0]?0:1:n[0]&&n[3]?0:n[1]&&n[0]?1:n[2]&&n[1]?2:3,r=e?Mn[0]:Mn[3];return{rotate:t,draw:r}},n=>({rotate:n[2]&&n[3]&&n[0]?0:n[3]&&n[0]&&n[1]?1:n[0]&&n[1]&&n[2]?2:3,draw:Mn[2]}),()=>({rotate:0,draw:Mn[1]})],U=C(0,1,1/P),Va=[[[U,U],[1-U,U]],[[1-U,U],[1-U,1-U]],[[1-U,1-U],[U,1-U]],[[U,1-U],[U,U]]],pa=[[[[U,0],[U,U]],[[1-U,0],[1-U,U]]],[[[1,U],[1-U,U]],[[1,1-U],[1-U,1-U]]],[[[1-U,1],[1-U,1-U]],[[U,1],[U,1-U]]],[[[0,U],[U,U]],[[0,1-U],[U,1-U]]]],Ga=n=>n.map((e,t)=>e?pa[t]:[Va[t]]),Ja=n=>({connections:wn[0].slice(),possibilities:new Array(wn.length).fill(0).map((e,t)=>t),index:n}),wn=[[!1,!1,!1,!1],[!0,!0,!0,!0],[!0,!1,!0,!1],[!1,!0,!1,!0],[!0,!0,!1,!1],[!1,!1,!0,!0],[!0,!0,!0,!1],[!0,!0,!1,!0],[!0,!1,!0,!0],[!1,!0,!0,!0]],Ha=[(n,e,t,r)=>{const a=(t-n+e.length)%e.length;e[a].connections[2]=r,e[a].possibilities=e[a].possibilities.filter(i=>wn[i][2]===r)},(n,e,t,r)=>{let a=(t+1)%e.length;a=Math.abs(a%n-t%n)>1?(a-n+e.length)%e.length:a,e[a].connections[3]=r,e[a].possibilities=e[a].possibilities.filter(i=>wn[i][3]===r)},(n,e,t,r)=>{const a=(t+n)%e.length;e[a].connections[0]=r,e[a].possibilities=e[a].possibilities.filter(i=>wn[i][0]===r)},(n,e,t,r)=>{let a=(t-1+e.length)%e.length;a=Math.abs(a%n-t%n)>1?(a+n)%e.length:a,e[a].connections[1]=r,e[a].possibilities=e[a].possibilities.filter(i=>wn[i][1]===r)}],Ya=(n,e,t)=>{const r=wn[t.possibilities[Math.floor(Math.random()*t.possibilities.length)]];r.forEach((a,i)=>Ha[i](n,e,t.index,a)),t.connections=r,t.possibilities=[]},Xa=n=>new Array(n**2).fill(null).map((e,t)=>Ja(t)),Za=(n,e)=>n.possibilities.length-e.possibilities.length,Nt=n=>e=>{if(e.filter(a=>a.possibilities.length!=0).length==0)return e.map(a=>a.connections);const t=e.slice().sort(Za).filter(a=>a.possibilities.length!=0),r=t.filter(a=>a.possibilities.length==t[0].possibilities.length);return Ya(n,e,r[Math.floor(Math.random()*r.length)]),Nt(n)(e)},ka=n=>n.map(e=>Ba[e.reduce((t,r)=>t+Number(r),0)](e)),$e=n=>Y(Xa(n),Nt(n),e=>({map:ka(e),borders:e.reduce((t,r)=>[...t,...Ga(r)],[])}));let sn=0,Ut=.06;k.controls.subscribe(({cameraSpeed:n})=>{Ut=n});const Qa=n=>e=>{if(e.save(),n){const t=n.box.angle-sn,r=t>Math.PI?n.box.angle-Math.PI*2-sn:t<-Math.PI?n.box.angle+Math.PI*2-sn:t;sn=(sn+r*Ut+Math.PI*2)%(Math.PI*2),e.translate(e.canvas.width/2,e.canvas.height/2),e.rotate(-sn),e.translate(-n.box.x,-n.box.y)}return e},$a=n=>(n.restore(),n);let Ce=0,Tt=600,Lt=!1;k.controls.subscribe(({cameraFocus:n,playerControls:e})=>{Lt=e,Ce=n});k.brain.subscribe(({minFitness:n})=>{Tt=n});const za=n=>{var t,r;n.map(a=>xa(a));const e=(r=(t=n.slice().map((a,i)=>({car:a,i})).filter(a=>!a.car.dead).sort((a,i)=>i.car.fitness-a.car.fitness)[0])==null?void 0:t.i)!=null?r:0;return!Lt&&Ce!=null&&Ce!=e&&k.controls.update(a=>({...a,cameraFocus:e})),n.filter(a=>!a.dead)},xa=n=>n.dead?null:ni(n)<Tt?n.dead=!0:null,ni=n=>n.fitness=ya(n),ze=n=>{const e=new Array;for(let t=0;t<n.length-1;t++)e.push(ei(n[t],n[t+1]));return{layers:e}},ei=(n,e)=>{const t=new Array(n),r=new Array(e),a=r.fill(0).map(d=>Math.random()*2-1),i=t.fill(0).map(d=>r.map(b=>Math.random()*2-1));return{inputs:t,outputs:r,biases:a,weights:i}},ti=n=>e=>n.layers.reduce((t,r)=>Ct(t,r),e),ri=n=>e=>n.layers.reduce((t,r)=>{const a=Ct(t.input,r),i=t.output;return i.push({...r,inputs:t.input,outputs:a}),{input:a,output:i}},{input:e,output:[]}).output,Ct=(n,e)=>e.outputs.map((t,r)=>n.reduce((a,i,d)=>a+ai(i*e.weights[d][r]),0)+e.biases[r]>0?1:0),ai=n=>n;let Ln;const ii="network-canvas",xe="transparent",ui="grey",nt="black",et="white";let Ft;const li=(n,e)=>t=>{if(!n)return t;const r={width:t.canvas.width/2.5,height:t.canvas.height/2.5};return Ln=Ln!=null?Ln:It(ii,r).ctx,Y(Ln,Pt(r),ci(Ft,e)),t},ci=(n,e)=>t=>{if(!n)return;const r=50,a=r,i=r,d=t.canvas.width-r*2,b=t.canvas.height-r*2,g=2;t.lineDashOffset=-e/50,t.lineWidth=g*2,t.fillStyle=nt,t.fillRect(0,0,t.canvas.width,t.canvas.height),t.strokeStyle=nt,t.strokeRect(g,g,t.canvas.width-g*2,t.canvas.height-g*2),t.strokeStyle=ui,t.strokeRect(g*3,g*3,t.canvas.width-g*6,t.canvas.height-g*6);const S=b/n.length;for(let y=n.length-1;y>=0;y--){const w=i+C(b-S,0,n.length==1?.5:y/(n.length-1));t.setLineDash([7,3]),oi(t,n[y],a,w,d,S,y==n.length-1?["T","L","Ri","B","Re"]:[])}return t},oi=(n,e,t,r,a,i,d)=>{const b=t+a,g=r+i,{inputs:S,outputs:y,weights:w,biases:M}=e;for(let O=0;O<S.length;O++)for(let F=0;F<y.length;F++)n.beginPath(),n.moveTo(Wn(S,O,t,b),g),n.lineTo(Wn(y,F,t,b),r),n.lineWidth=2,n.strokeStyle=qn(w[O][F]),n.stroke();const E=18;for(let O=0;O<S.length;O++){const F=Wn(S,O,t,b);n.beginPath(),n.arc(F,g,E*.85,0,Math.PI*2),n.fillStyle=xe,n.fill(),n.beginPath(),n.arc(F,g,E*.6,0,Math.PI*2),n.fillStyle=qn(S[O]),n.fill()}for(let O=0;O<y.length;O++){const F=Wn(y,O,t,b);n.beginPath(),n.arc(F,r,E*.85,0,Math.PI*2),n.fillStyle=xe,n.fill(),n.beginPath(),n.arc(F,r,E*.6,0,Math.PI*2),n.fillStyle=qn(y[O]),n.fill(),n.beginPath(),n.lineWidth=2,n.arc(F,r,E*1,0,Math.PI*2),n.strokeStyle=qn(M[O]),n.setLineDash([3,3]),n.stroke(),n.setLineDash([]),d[O]&&(n.beginPath(),n.textAlign="center",n.textBaseline="middle",n.fillStyle=et,n.strokeStyle=et,n.font=E*.9+"px Arial",n.fillText(d[O],F,r+E*.1),n.lineWidth=.5,n.strokeText(d[O],F,r+E*.1))}},Wn=(n,e,t,r)=>C(t,r,n.length==1?.5:e/(n.length-1)),qn=n=>{const e=Math.abs(n),t=255,r=0,a=n>0?255:0;return`rgba(${t},${a},${r},${e})`},fi=n=>Ft=n;let Wt=0,qt=3,Dt=.1,Fe=.5*Math.PI/180,jt=!1;k.controls.subscribe(n=>{Wt=n.cameraFocus,jt=n.playerControls,qt=n.carThrust,Dt=n.carBreakStrength,Fe=n.carTurnSpeed*Math.PI/180});const hi=n=>jt?n.map(({car:e})=>({car:e,action:Ua()})):n.map(({car:e,sensor:t},r)=>di(e,t,r)),di=(n,e,t)=>{const[r,a,i,d,b]=Y([wt(n),...e.map(g=>{var S,y;return 1-((y=(S=g.contacts[0])==null?void 0:S.offset)!=null?y:1)})],ht(g=>t===Wt?Y(g,ri(n.brain),fi):null,ti(n.brain)))[1];return{car:n,action:{thrust:qt*r*(b>.5?-.4:1),angle:Fe*-a+Fe*i,breaks:Dt*d}}},Ge="bestNetwork";let Yn=!1;Dn.subscribe(n=>Yn=n);const gi=n=>{if(!Yn)return!1;try{localStorage.setItem(Ge,JSON.stringify(n))}catch{return!1}return!0},mi=()=>{if(!Yn)return!1;try{localStorage.removeItem(Ge)}catch{return!1}return!0},vi=()=>{if(!Yn)return null;try{return localStorage.getItem(Ge)}catch{return null}},yi=n=>n==null?!0:gi(n),bi=n=>!0,Kt=()=>{var n;return JSON.parse((n=vi())!=null?n:"null")},_i=Kt,Bt=()=>Y(Kt(),dt(n=>n,_i)),Si=mi,wi=n=>{const e=Bt();return Ae.update(t=>({...t,curReward:n.reward,bestReward:e==null?void 0:e.reward})),e==null||e.reward<n.reward?n:null},Ri=(n,e=.3)=>({layers:Mi(n.layers,e)}),Mi=(n,e)=>n.map(t=>Y(t,si(e),Ai(e))),si=n=>e=>(e.biases=e.biases.map(t=>C(t,Math.random()*2-1,n)),e),Ai=n=>e=>(e.weights=e.weights.map(t=>t.map(r=>C(r,Math.random()*2-1,n))),e);function Ii(n){let e,t,r,a,i,d,b,g,S;return Jt(n[13]),{c(){e=be("canvas"),t=He(),r=be("canvas"),a=He(),i=be("canvas"),this.h()},l(y){e=_e(y,"CANVAS",{id:!0,style:!0,class:!0}),Se(e).forEach(gn),t=Ye(y),r=_e(y,"CANVAS",{width:!0,height:!0}),Se(r).forEach(gn),a=Ye(y),i=_e(y,"CANVAS",{id:!0,width:!0,height:!0,class:!0}),Se(i).forEach(gn),this.h()},h(){en(e,"id","background-canvas"),Ht(e,"display","none"),en(e,"class","svelte-wies5q"),en(r,"width",n[1]),en(r,"height",n[2]),en(i,"id","network-canvas"),en(i,"width",d=n[1]/2.5),en(i,"height",b=n[2]/2.5),en(i,"class","svelte-wies5q")},m(y,w){Nn(y,e,w),Nn(y,t,w),Nn(y,r,w),n[14](r),Nn(y,a,w),Nn(y,i,w),g||(S=[we(window,"keydown",ke.onkeydown),we(window,"keyup",ke.onkeyup),we(window,"resize",n[13])],g=!0)},p(y,[w]){w&2&&en(r,"width",y[1]),w&4&&en(r,"height",y[2]),w&2&&d!==(d=y[1]/2.5)&&en(i,"width",d),w&4&&b!==(b=y[2]/2.5)&&en(i,"height",b)},i:Xe,o:Xe,d(y){y&&gn(e),y&&gn(t),y&&gn(r),n[14](null),y&&gn(a),y&&gn(i),g=!1,Yt(S)}}}const fn=200;function Ei(n,e,t){let r,a,i,d,b,g,S;_n(n,se,W=>t(20,a=W)),_n(n,Bn,W=>t(21,i=W)),_n(n,Dn,W=>t(10,b=W));let{debug:y=!1}=e;const{master:w,controls:M,brain:E}=k;_n(n,w,W=>t(11,g=W)),_n(n,M,W=>t(19,r=W)),_n(n,E,W=>t(12,S=W)),Un(M,r.showNetwork=y,r);let O,F,p;Xt(()=>{se.set(O),Bn.set(a.getContext("2d")),Un(Dn,b=!0,b),requestAnimationFrame(K)}),Zt(()=>{l=!0,Un(Dn,b=!1,b),Ae.set({})});const X=fn/P*.6,I=["#0f0","#000","#0ff","#f0f","#fff"],s={box:{x:100,y:100,width:30,height:55,angle:0},brain:ze([1,1]),destination:[0,0],color:"#000",dead:!0,fitness:0,performace:0};let R=[],f,l=!1,v=$e(Number(g.gridSize)),_=[S.sensorCount*2+1,6,4,5],L=mn(null);_n(n,L,W=>t(22,d=W));const D=W=>l||d!=W,K=(W,x=W,G=Math.random())=>{if(d==null&&Un(L,d=G,d),!D(G)){if(cn()){z();return}an(W),Ae.update(ln=>({...ln,fps:Math.round(1/((W-x)/1e3))})),requestAnimationFrame(ln=>K(ln,W,G))}},z=W=>Y(R,va,_a,wi,ht(yi,bi),x=>x.every(G=>G)?requestAnimationFrame(()=>w.update(G=>({...G}))):alert("error! could not save to each storage")),cn=W=>Y(R,sa(f),za,Aa(f.borders),hi,Ia(f)).every(x=>x==null),an=W=>{var x;return Y(i,Pt({width:a.width,height:a.height}),Qa(R[r.cameraFocus]),ja(f,(x=R[r.cameraFocus])==null?void 0:x.box,R,{width:a.width,height:a.height}),$a,li(r.showNetwork,W))};function un(){t(1,F=window.innerWidth),t(2,p=window.innerHeight)}function In(W){kt[W?"unshift":"push"](()=>{O=W,t(0,O)})}return n.$$set=W=>{"debug"in W&&t(7,y=W.debug)},n.$$.update=()=>{n.$$.dirty&4096&&(Si(),t(9,_=[S.sensorCount*2+1,4,5])),n.$$.dirty&3840&&(t(8,v=$e(Number(g.gridSize))),f={...v,dim:g.gridSize,size:{width:g.gridSize*fn,height:g.gridSize*fn},backgroundSaved:!1},R=new Array(g.carAmount).fill(s).map((W,x)=>{const G=Number(g.gridSize),ln=Math.floor(Math.random()*G),yn=Math.floor(Math.random()*G),En=v.map[ln+yn*G].rotate==1?Math.PI/2:0;return{brain:Y(Bt(),dt(Ri,()=>ze(_))),box:{x:ln*fn+C(0,fn,(Math.floor(1+Math.random()*(P-2))+.5)/P),y:yn*fn+C(0,fn,(Math.floor(1+Math.random()*(P-2))+.5)/P),width:X,height:X*1.6,angle:En,physics:{momentum:{direction:0,magnitude:0},mass:Math.random()*5+5}},destination:[fn*(Math.floor(ln+G*.5)%G+.5),fn*(Math.floor(yn+G*.5)%G+.5)],color:I[Math.floor(Math.random()*I.length)],dead:!1,fitness:0,performace:0}}),Un(L,d=null,d),b&&requestAnimationFrame(K))},[O,F,p,w,M,E,L,y,v,_,b,g,S,un,In]}class Fi extends Vt{constructor(e){super(),pt(this,e,Ei,Ii,Gt,{debug:7})}}export{Fi as C,ua as a,k as c,Ae as l};
