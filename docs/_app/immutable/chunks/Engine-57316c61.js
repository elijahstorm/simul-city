import{A as ln,S as Be,i as Ve,s as $e,D as Ge,G as Je,H as Ye,I as He,f as Xe,t as Ze,K as wn,o as Qe,a7 as An,T as ke}from"./index-e18796f7.js";function ze(n,t){for(var e=0;e<t.length;e++){const r=t[e];if(typeof r!="string"&&!Array.isArray(r)){for(const a in r)if(a!=="default"&&!(a in n)){const i=Object.getOwnPropertyDescriptor(r,a);i&&Object.defineProperty(n,a,i.get?i:{enumerable:!0,get:()=>r[a]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}const Yt=n=>{const t=new Array;for(let e=0;e<n.length-1;e++)t.push(xe(n[e],n[e+1]));return{layers:t}},xe=(n,t)=>{const e=new Array(n),r=new Array(t),a=r.fill(0).map(d=>Math.random()*2-1),i=e.fill(0).map(d=>r.map(y=>Math.random()*2-1));return{inputs:e,outputs:r,biases:a,weights:i}},nr=n=>t=>n.layers.reduce((e,r)=>Ht(e,r),t),tr=n=>t=>n.layers.reduce((e,r)=>{const a=Ht(e.input,r),i=e.output;return i.push({...r,inputs:e.input,outputs:a}),{input:a,output:i}},{input:t,output:[]}).output,Ht=(n,t)=>t.outputs.map((e,r)=>n.reduce((a,i,d)=>a+er(i*t.weights[d][r]),0)+t.biases[r]>0?1:0),er=n=>n,rr=ln(),Xt=ln(),Pn=ln(),Zt=ln({}),gn=Object.freeze({simulation:{currentId:0,carSpots:[{box:{x:100,y:100,width:30,height:55,angle:0},brain:Yt([1,1]),destination:[0,0],color:"#000",dead:!0,fitness:0,performace:0,path:[]}],world:{generatedMap:{map:[{draw:n=>t=>null,rotate:0}],connections:[[!1,!1,!1,!1]],borders:[[[[0,0],[0,0]]]]},dim:1,size:{width:1,height:1},backgroundSaved:!1},destroyed:!1,layers:[6,4,6,5]},master:{gridSize:5,carAmount:20},brain:{sensorCount:5,sensorLength:200,sensorSpread:Math.PI/2,minFitness:-400},controls:{showNetwork:!0,cameraFocus:0,playerControls:!1,drawSensors:!1,cameraSpeed:.06,carThrust:2,maxSpeed:8,carTurnSpeed:.5,carBreakStrength:.4,friction:.04}}),J={simulation:ln(gn.simulation),master:ln(gn.master),brain:ln(gn.brain),controls:ln(gn.controls)},ar={master:{gridSize:{type:"number",where:"master",min:2,max:100,step:1},carAmount:{type:"number",where:"master",min:2,max:1e3,step:10}},brain:{sensorCount:{type:"number",where:"brain",min:1,max:30,step:1},sensorLength:{type:"number",where:"brain",min:60,max:300,step:20},sensorSpread:{type:"number",where:"brain",min:0,max:Math.PI,step:.3},minFitness:{type:"number",where:"brain",min:-3e3,max:0,step:50}},controls:{cameraFocus:{type:"number",where:"controls",min:0,max:5,step:1},playerControls:{type:"checkbox",where:"controls"},showNetwork:{type:"checkbox",where:"controls"},drawSensors:{type:"checkbox",where:"controls"},cameraSpeed:{type:"number",where:"controls",min:0,max:.15,step:.001},carThrust:{type:"number",where:"controls",min:1,max:15,step:1},carTurnSpeed:{type:"number",where:"controls",min:.3,max:1.5,step:.1},carBreakStrength:{type:"number",where:"controls",min:.05,max:.3,step:.05},friction:{type:"number",where:"controls",min:.01,max:1,step:.01},maxSpeed:{type:"number",where:"controls",min:3,max:20,step:1}}};J.master.subscribe(({carAmount:n})=>ar.controls.cameraFocus.max=n-1);var U=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ir(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var X={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.getEndomorphismMonoid=n.not=n.SK=n.hole=n.pipe=n.untupled=n.tupled=n.absurd=n.decrement=n.increment=n.tuple=n.flow=n.flip=n.constVoid=n.constUndefined=n.constNull=n.constFalse=n.constTrue=n.constant=n.unsafeCoerce=n.identity=n.apply=n.getRing=n.getSemiring=n.getMonoid=n.getSemigroup=n.getBooleanAlgebra=void 0;var t=function(f){return function(){return{meet:function(c,v){return function(S){return f.meet(c(S),v(S))}},join:function(c,v){return function(S){return f.join(c(S),v(S))}},zero:function(){return f.zero},one:function(){return f.one},implies:function(c,v){return function(S){return f.implies(c(S),v(S))}},not:function(c){return function(v){return f.not(c(v))}}}}};n.getBooleanAlgebra=t;var e=function(f){return function(){return{concat:function(c,v){return function(S){return f.concat(c(S),v(S))}}}}};n.getSemigroup=e;var r=function(f){var c=(0,n.getSemigroup)(f);return function(){return{concat:c().concat,empty:function(){return f.empty}}}};n.getMonoid=r;var a=function(f){return{add:function(c,v){return function(S){return f.add(c(S),v(S))}},zero:function(){return f.zero},mul:function(c,v){return function(S){return f.mul(c(S),v(S))}},one:function(){return f.one}}};n.getSemiring=a;var i=function(f){var c=(0,n.getSemiring)(f);return{add:c.add,mul:c.mul,one:c.one,zero:c.zero,sub:function(v,S){return function(W){return f.sub(v(W),S(W))}}}};n.getRing=i;var d=function(f){return function(c){return c(f)}};n.apply=d;function y(f){return f}n.identity=y,n.unsafeCoerce=y;function g(f){return function(){return f}}n.constant=g,n.constTrue=g(!0),n.constFalse=g(!1),n.constNull=g(null),n.constUndefined=g(void 0),n.constVoid=n.constUndefined;function b(f){return function(c,v){return f(v,c)}}n.flip=b;function s(f,c,v,S,W,D,K,x,cn){switch(arguments.length){case 1:return f;case 2:return function(){return c(f.apply(this,arguments))};case 3:return function(){return v(c(f.apply(this,arguments)))};case 4:return function(){return S(v(c(f.apply(this,arguments))))};case 5:return function(){return W(S(v(c(f.apply(this,arguments)))))};case 6:return function(){return D(W(S(v(c(f.apply(this,arguments))))))};case 7:return function(){return K(D(W(S(v(c(f.apply(this,arguments)))))))};case 8:return function(){return x(K(D(W(S(v(c(f.apply(this,arguments))))))))};case 9:return function(){return cn(x(K(D(W(S(v(c(f.apply(this,arguments)))))))))}}}n.flow=s;function M(){for(var f=[],c=0;c<arguments.length;c++)f[c]=arguments[c];return f}n.tuple=M;function R(f){return f+1}n.increment=R;function w(f){return f-1}n.decrement=w;function _(f){throw new Error("Called `absurd` function which should be uncallable")}n.absurd=_;function P(f){return function(c){return f.apply(void 0,c)}}n.tupled=P;function j(f){return function(){for(var c=[],v=0;v<arguments.length;v++)c[v]=arguments[v];return f(c)}}n.untupled=j;function H(f,c,v,S,W,D,K,x,cn){switch(arguments.length){case 1:return f;case 2:return c(f);case 3:return v(c(f));case 4:return S(v(c(f)));case 5:return W(S(v(c(f))));case 6:return D(W(S(v(c(f)))));case 7:return K(D(W(S(v(c(f))))));case 8:return x(K(D(W(S(v(c(f)))))));case 9:return cn(x(K(D(W(S(v(c(f))))))));default:{for(var tn=arguments[0],en=1;en<arguments.length;en++)tn=arguments[en](tn);return tn}}}n.pipe=H,n.hole=_;var E=function(f,c){return c};n.SK=E;function O(f){return function(c){return!f(c)}}n.not=O;var I=function(){return{concat:function(f,c){return s(f,c)},empty:y}};n.getEndomorphismMonoid=I})(X);const ur=ir(X),cr=ze({__proto__:null,default:ur},[X]);var Qt={},kt={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.eqDate=n.eqNumber=n.eqString=n.eqBoolean=n.eq=n.strictEqual=n.getStructEq=n.getTupleEq=n.Contravariant=n.getMonoid=n.getSemigroup=n.eqStrict=n.URI=n.contramap=n.tuple=n.struct=n.fromEquals=void 0;var t=X,e=function(s){return{equals:function(M,R){return M===R||s(M,R)}}};n.fromEquals=e;var r=function(s){return(0,n.fromEquals)(function(M,R){for(var w in s)if(!s[w].equals(M[w],R[w]))return!1;return!0})};n.struct=r;var a=function(){for(var s=[],M=0;M<arguments.length;M++)s[M]=arguments[M];return(0,n.fromEquals)(function(R,w){return s.every(function(_,P){return _.equals(R[P],w[P])})})};n.tuple=a;var i=function(s,M){return(0,t.pipe)(s,(0,n.contramap)(M))},d=function(s){return function(M){return(0,n.fromEquals)(function(R,w){return M.equals(s(R),s(w))})}};n.contramap=d,n.URI="Eq",n.eqStrict={equals:function(s,M){return s===M}};var y={equals:function(){return!0}},g=function(){return{concat:function(s,M){return(0,n.fromEquals)(function(R,w){return s.equals(R,w)&&M.equals(R,w)})}}};n.getSemigroup=g;var b=function(){return{concat:(0,n.getSemigroup)().concat,empty:y}};n.getMonoid=b,n.Contravariant={URI:n.URI,contramap:i},n.getTupleEq=n.tuple,n.getStructEq=n.struct,n.strictEqual=n.eqStrict.equals,n.eq=n.Contravariant,n.eqBoolean=n.eqStrict,n.eqString=n.eqStrict,n.eqNumber=n.eqStrict,n.eqDate={equals:function(s,M){return s.valueOf()===M.valueOf()}}})(kt);(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.ordDate=n.ordNumber=n.ordString=n.ordBoolean=n.ord=n.getDualOrd=n.getTupleOrd=n.between=n.clamp=n.max=n.min=n.geq=n.leq=n.gt=n.lt=n.equals=n.trivial=n.Contravariant=n.getMonoid=n.getSemigroup=n.URI=n.contramap=n.reverse=n.tuple=n.fromCompare=n.equalsDefault=void 0;var t=kt,e=X,r=function(c){return function(v,S){return v===S||c(v,S)===0}};n.equalsDefault=r;var a=function(c){return{equals:(0,n.equalsDefault)(c),compare:function(v,S){return v===S?0:c(v,S)}}};n.fromCompare=a;var i=function(){for(var c=[],v=0;v<arguments.length;v++)c[v]=arguments[v];return(0,n.fromCompare)(function(S,W){for(var D=0;D<c.length-1;D++){var K=c[D].compare(S[D],W[D]);if(K!==0)return K}return c[D].compare(S[D],W[D])})};n.tuple=i;var d=function(c){return(0,n.fromCompare)(function(v,S){return c.compare(S,v)})};n.reverse=d;var y=function(c,v){return(0,e.pipe)(c,(0,n.contramap)(v))},g=function(c){return function(v){return(0,n.fromCompare)(function(S,W){return v.compare(c(S),c(W))})}};n.contramap=g,n.URI="Ord";var b=function(){return{concat:function(c,v){return(0,n.fromCompare)(function(S,W){var D=c.compare(S,W);return D!==0?D:v.compare(S,W)})}}};n.getSemigroup=b;var s=function(){return{concat:(0,n.getSemigroup)().concat,empty:(0,n.fromCompare)(function(){return 0})}};n.getMonoid=s,n.Contravariant={URI:n.URI,contramap:y},n.trivial={equals:e.constTrue,compare:(0,e.constant)(0)};var M=function(c){return function(v){return function(S){return S===v||c.compare(S,v)===0}}};n.equals=M;var R=function(c){return function(v,S){return c.compare(v,S)===-1}};n.lt=R;var w=function(c){return function(v,S){return c.compare(v,S)===1}};n.gt=w;var _=function(c){return function(v,S){return c.compare(v,S)!==1}};n.leq=_;var P=function(c){return function(v,S){return c.compare(v,S)!==-1}};n.geq=P;var j=function(c){return function(v,S){return v===S||c.compare(v,S)<1?v:S}};n.min=j;var H=function(c){return function(v,S){return v===S||c.compare(v,S)>-1?v:S}};n.max=H;var E=function(c){var v=(0,n.min)(c),S=(0,n.max)(c);return function(W,D){return function(K){return S(v(K,D),W)}}};n.clamp=E;var O=function(c){var v=(0,n.lt)(c),S=(0,n.gt)(c);return function(W,D){return function(K){return!(v(K,W)||S(K,D))}}};n.between=O,n.getTupleOrd=n.tuple,n.getDualOrd=n.reverse,n.ord=n.Contravariant;function I(c,v){return c<v?-1:c>v?1:0}var f={equals:t.eqStrict.equals,compare:I};n.ordBoolean=f,n.ordString=f,n.ordNumber=f,n.ordDate=(0,e.pipe)(n.ordNumber,(0,n.contramap)(function(c){return c.valueOf()}))})(Qt);var Nt={},on={},G={},L={},lr=U&&U.__spreadArray||function(n,t,e){if(e||arguments.length===2)for(var r=0,a=t.length,i;r<a;r++)(i||!(r in t))&&(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return n.concat(i||Array.prototype.slice.call(t))};Object.defineProperty(L,"__esModule",{value:!0});L.fromReadonlyNonEmptyArray=L.has=L.emptyRecord=L.emptyReadonlyArray=L.tail=L.head=L.isNonEmpty=L.singleton=L.right=L.left=L.isRight=L.isLeft=L.some=L.none=L.isSome=L.isNone=void 0;var or=function(n){return n._tag==="None"};L.isNone=or;var fr=function(n){return n._tag==="Some"};L.isSome=fr;L.none={_tag:"None"};var hr=function(n){return{_tag:"Some",value:n}};L.some=hr;var dr=function(n){return n._tag==="Left"};L.isLeft=dr;var gr=function(n){return n._tag==="Right"};L.isRight=gr;var mr=function(n){return{_tag:"Left",left:n}};L.left=mr;var vr=function(n){return{_tag:"Right",right:n}};L.right=vr;var yr=function(n){return[n]};L.singleton=yr;var br=function(n){return n.length>0};L.isNonEmpty=br;var sr=function(n){return n[0]};L.head=sr;var _r=function(n){return n.slice(1)};L.tail=_r;L.emptyReadonlyArray=[];L.emptyRecord={};L.has=Object.prototype.hasOwnProperty;var Sr=function(n){return lr([n[0]],n.slice(1),!0)};L.fromReadonlyNonEmptyArray=Sr;var Rr=U&&U.__createBinding||(Object.create?function(n,t,e,r){r===void 0&&(r=e);var a=Object.getOwnPropertyDescriptor(t,e);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(n,r,a)}:function(n,t,e,r){r===void 0&&(r=e),n[r]=t[e]}),Mr=U&&U.__setModuleDefault||(Object.create?function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}:function(n,t){n.default=t}),Ir=U&&U.__importStar||function(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var e in n)e!=="default"&&Object.prototype.hasOwnProperty.call(n,e)&&Rr(t,n,e);return Mr(t,n),t};Object.defineProperty(G,"__esModule",{value:!0});var Cn=G.sequenceS=Tt=G.sequenceT=G.getApplySemigroup=G.apS=G.apSecond=G.apFirst=G.ap=void 0,wr=X,Ar=Ir(L);function Or(n,t){return function(e){return function(r){return n.ap(n.map(r,function(a){return function(i){return t.ap(a,i)}}),e)}}}G.ap=Or;function Er(n){return function(t){return function(e){return n.ap(n.map(e,function(r){return function(){return r}}),t)}}}G.apFirst=Er;function Pr(n){return function(t){return function(e){return n.ap(n.map(e,function(){return function(r){return r}}),t)}}}G.apSecond=Pr;function Nr(n){return function(t,e){return function(r){return n.ap(n.map(r,function(a){return function(i){var d;return Object.assign({},a,(d={},d[t]=i,d))}}),e)}}}G.apS=Nr;function Ur(n){return function(t){return{concat:function(e,r){return n.ap(n.map(e,function(a){return function(i){return t.concat(a,i)}}),r)}}}}G.getApplySemigroup=Ur;function Ut(n,t,e){return function(r){for(var a=Array(e.length+1),i=0;i<e.length;i++)a[i]=e[i];return a[e.length]=r,t===0?n.apply(null,a):Ut(n,t-1,a)}}var bt={1:function(n){return[n]},2:function(n){return function(t){return[n,t]}},3:function(n){return function(t){return function(e){return[n,t,e]}}},4:function(n){return function(t){return function(e){return function(r){return[n,t,e,r]}}}},5:function(n){return function(t){return function(e){return function(r){return function(a){return[n,t,e,r,a]}}}}}};function Tr(n){return Ar.has.call(bt,n)||(bt[n]=Ut(wr.tuple,n-1,[])),bt[n]}function Lr(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=t.length,a=Tr(r),i=n.map(t[0],a),d=1;d<r;d++)i=n.ap(i,t[d]);return i}}var Tt=G.sequenceT=Lr;function Fr(n){var t=n.length;switch(t){case 1:return function(e){var r;return r={},r[n[0]]=e,r};case 2:return function(e){return function(r){var a;return a={},a[n[0]]=e,a[n[1]]=r,a}};case 3:return function(e){return function(r){return function(a){var i;return i={},i[n[0]]=e,i[n[1]]=r,i[n[2]]=a,i}}};case 4:return function(e){return function(r){return function(a){return function(i){var d;return d={},d[n[0]]=e,d[n[1]]=r,d[n[2]]=a,d[n[3]]=i,d}}}};case 5:return function(e){return function(r){return function(a){return function(i){return function(d){var y;return y={},y[n[0]]=e,y[n[1]]=r,y[n[2]]=a,y[n[3]]=i,y[n[4]]=d,y}}}}};default:return Ut(function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];for(var a={},i=0;i<t;i++)a[n[i]]=e[i];return a},t-1,[])}}function Cr(n){return function(t){for(var e=Object.keys(t),r=e.length,a=Fr(e),i=n.map(t[e[0]],a),d=1;d<r;d++)i=n.ap(i,t[e[d]]);return i}}Cn=G.sequenceS=Cr;var Z={};Object.defineProperty(Z,"__esModule",{value:!0});Z.getFunctorComposition=Z.bindTo=Z.flap=Z.map=void 0;var Wr=X;function zt(n,t){return function(e){return function(r){return n.map(r,function(a){return t.map(a,e)})}}}Z.map=zt;function qr(n){return function(t){return function(e){return n.map(e,function(r){return r(t)})}}}Z.flap=qr;function Dr(n){return function(t){return function(e){return n.map(e,function(r){var a;return a={},a[t]=r,a})}}}Z.bindTo=Dr;function jr(n,t){var e=zt(n,t);return{map:function(r,a){return(0,Wr.pipe)(r,e(a))}}}Z.getFunctorComposition=jr;Object.defineProperty(on,"__esModule",{value:!0});on.getApplicativeComposition=on.getApplicativeMonoid=void 0;var xt=G,Kr=X,pr=Z;function Br(n){var t=(0,xt.getApplySemigroup)(n);return function(e){return{concat:t(e).concat,empty:n.of(e.empty)}}}on.getApplicativeMonoid=Br;function Vr(n,t){var e=(0,pr.getFunctorComposition)(n,t).map,r=(0,xt.ap)(n,t);return{map:e,of:function(a){return n.of(t.of(a))},ap:function(a,i){return(0,Kr.pipe)(a,r(i))}}}on.getApplicativeComposition=Vr;var un={};Object.defineProperty(un,"__esModule",{value:!0});un.bind=un.chainFirst=void 0;function $r(n){return function(t){return function(e){return n.chain(e,function(r){return n.map(t(r),function(){return r})})}}}un.chainFirst=$r;function Gr(n){return function(t,e){return function(r){return n.chain(r,function(a){return n.map(e(a),function(i){var d;return Object.assign({},a,(d={},d[t]=i,d))})})}}}un.bind=Gr;var Wn={};Object.defineProperty(Wn,"__esModule",{value:!0});Wn.tailRec=void 0;var Jr=function(n,t){for(var e=t(n);e._tag==="Left";)e=t(e.left);return e.right};Wn.tailRec=Jr;var $={},Yr=U&&U.__createBinding||(Object.create?function(n,t,e,r){r===void 0&&(r=e);var a=Object.getOwnPropertyDescriptor(t,e);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(n,r,a)}:function(n,t,e,r){r===void 0&&(r=e),n[r]=t[e]}),Hr=U&&U.__setModuleDefault||(Object.create?function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}:function(n,t){n.default=t}),Xr=U&&U.__importStar||function(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var e in n)e!=="default"&&Object.prototype.hasOwnProperty.call(n,e)&&Yr(t,n,e);return Hr(t,n),t};Object.defineProperty($,"__esModule",{value:!0});$.filterOrElse=$.chainFirstEitherK=$.chainEitherK=$.fromEitherK=$.chainOptionK=$.fromOptionK=$.fromPredicate=$.fromOption=void 0;var Zr=un,Lt=X,vn=Xr(L);function ne(n){return function(t){return function(e){return n.fromEither(vn.isNone(e)?vn.left(t()):vn.right(e.value))}}}$.fromOption=ne;function Qr(n){return function(t,e){return function(r){return n.fromEither(t(r)?vn.right(r):vn.left(e(r)))}}}$.fromPredicate=Qr;function te(n){var t=ne(n);return function(e){var r=t(e);return function(a){return(0,Lt.flow)(a,r)}}}$.fromOptionK=te;function kr(n,t){var e=te(n);return function(r){var a=e(r);return function(i){return function(d){return t.chain(d,a(i))}}}}$.chainOptionK=kr;function Ft(n){return function(t){return(0,Lt.flow)(t,n.fromEither)}}$.fromEitherK=Ft;function zr(n,t){var e=Ft(n);return function(r){return function(a){return t.chain(a,e(r))}}}$.chainEitherK=zr;function xr(n,t){return(0,Lt.flow)(Ft(n),(0,Zr.chainFirst)(t))}$.chainFirstEitherK=xr;function na(n,t){return function(e,r){return function(a){return t.chain(a,function(i){return n.fromEither(e(i)?vn.right(i):vn.left(r(i)))})}}}$.filterOrElse=na;var Ct={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.right=n.left=n.flap=n.Functor=n.Bifunctor=n.URI=n.bimap=n.mapLeft=n.map=n.separated=void 0;var t=X,e=Z,r=function(R,w){return{left:R,right:w}};n.separated=r;var a=function(R,w){return(0,t.pipe)(R,(0,n.map)(w))},i=function(R,w){return(0,t.pipe)(R,(0,n.mapLeft)(w))},d=function(R,w,_){return(0,t.pipe)(R,(0,n.bimap)(w,_))},y=function(R){return function(w){return(0,n.separated)((0,n.left)(w),R((0,n.right)(w)))}};n.map=y;var g=function(R){return function(w){return(0,n.separated)(R((0,n.left)(w)),(0,n.right)(w))}};n.mapLeft=g;var b=function(R,w){return function(_){return(0,n.separated)(R((0,n.left)(_)),w((0,n.right)(_)))}};n.bimap=b,n.URI="Separated",n.Bifunctor={URI:n.URI,mapLeft:i,bimap:d},n.Functor={URI:n.URI,map:a},n.flap=(0,e.flap)(n.Functor);var s=function(R){return R.left};n.left=s;var M=function(R){return R.right};n.right=M})(Ct);var an={},ta=U&&U.__createBinding||(Object.create?function(n,t,e,r){r===void 0&&(r=e);var a=Object.getOwnPropertyDescriptor(t,e);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(n,r,a)}:function(n,t,e,r){r===void 0&&(r=e),n[r]=t[e]}),ea=U&&U.__setModuleDefault||(Object.create?function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}:function(n,t){n.default=t}),ra=U&&U.__importStar||function(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var e in n)e!=="default"&&Object.prototype.hasOwnProperty.call(n,e)&&ta(t,n,e);return ea(t,n),t};Object.defineProperty(an,"__esModule",{value:!0});an.filterE=an.witherDefault=an.wiltDefault=void 0;var Kt=ra(L);function aa(n,t){return function(e){var r=n.traverse(e);return function(a,i){return e.map(r(a,i),t.separate)}}}an.wiltDefault=aa;function ia(n,t){return function(e){var r=n.traverse(e);return function(a,i){return e.map(r(a,i),t.compact)}}}an.witherDefault=ia;function ua(n){return function(t){var e=n.wither(t);return function(r){return function(a){return e(a,function(i){return t.map(r(i),function(d){return d?Kt.some(i):Kt.none})})}}}}an.filterE=ua;(function(n){var t=U&&U.__createBinding||(Object.create?function(o,u,m,C){C===void 0&&(C=m);var Y=Object.getOwnPropertyDescriptor(u,m);(!Y||("get"in Y?!u.__esModule:Y.writable||Y.configurable))&&(Y={enumerable:!0,get:function(){return u[m]}}),Object.defineProperty(o,C,Y)}:function(o,u,m,C){C===void 0&&(C=m),o[C]=u[m]}),e=U&&U.__setModuleDefault||(Object.create?function(o,u){Object.defineProperty(o,"default",{enumerable:!0,value:u})}:function(o,u){o.default=u}),r=U&&U.__importStar||function(o){if(o&&o.__esModule)return o;var u={};if(o!=null)for(var m in o)m!=="default"&&Object.prototype.hasOwnProperty.call(o,m)&&t(u,o,m);return e(u,o),u};Object.defineProperty(n,"__esModule",{value:!0}),n.fold=n.match=n.foldW=n.matchW=n.isRight=n.isLeft=n.fromOption=n.fromPredicate=n.FromEither=n.MonadThrow=n.throwError=n.ChainRec=n.Extend=n.extend=n.Alt=n.alt=n.altW=n.Bifunctor=n.mapLeft=n.bimap=n.Traversable=n.sequence=n.traverse=n.Foldable=n.reduceRight=n.foldMap=n.reduce=n.Monad=n.Chain=n.chain=n.chainW=n.Applicative=n.Apply=n.ap=n.apW=n.Pointed=n.of=n.Functor=n.map=n.getAltValidation=n.getApplicativeValidation=n.getWitherable=n.getFilterable=n.getCompactable=n.getSemigroup=n.getEq=n.getShow=n.URI=n.right=n.left=void 0,n.getValidation=n.getValidationMonoid=n.getValidationSemigroup=n.getApplyMonoid=n.getApplySemigroup=n.either=n.stringifyJSON=n.parseJSON=n.sequenceArray=n.traverseArray=n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex=n.traverseReadonlyNonEmptyArrayWithIndex=n.ApT=n.apSW=n.apS=n.bindW=n.bind=n.bindTo=n.Do=n.exists=n.elem=n.toError=n.toUnion=n.chainNullableK=n.fromNullableK=n.tryCatchK=n.tryCatch=n.fromNullable=n.orElse=n.orElseW=n.swap=n.filterOrElseW=n.filterOrElse=n.chainOptionK=n.fromOptionK=n.duplicate=n.flatten=n.flattenW=n.chainFirstW=n.chainFirst=n.apSecondW=n.apSecond=n.apFirstW=n.apFirst=n.flap=n.getOrElse=n.getOrElseW=void 0;var a=on,i=G,d=un,y=Wn,g=$,b=X,s=Z,M=r(L),R=Ct,w=an;n.left=M.left,n.right=M.right;var _=function(o,u){return(0,b.pipe)(o,(0,n.map)(u))},P=function(o,u){return(0,b.pipe)(o,(0,n.ap)(u))},j=function(o,u){return(0,b.pipe)(o,(0,n.chain)(u))},H=function(o,u,m){return(0,b.pipe)(o,(0,n.reduce)(u,m))},E=function(o){return function(u,m){var C=(0,n.foldMap)(o);return(0,b.pipe)(u,C(m))}},O=function(o,u,m){return(0,b.pipe)(o,(0,n.reduceRight)(u,m))},I=function(o){var u=(0,n.traverse)(o);return function(m,C){return(0,b.pipe)(m,u(C))}},f=function(o,u,m){return(0,b.pipe)(o,(0,n.bimap)(u,m))},c=function(o,u){return(0,b.pipe)(o,(0,n.mapLeft)(u))},v=function(o,u){return(0,b.pipe)(o,(0,n.alt)(u))},S=function(o,u){return(0,b.pipe)(o,(0,n.extend)(u))},W=function(o,u){return(0,y.tailRec)(u(o),function(m){return(0,n.isLeft)(m)?(0,n.right)((0,n.left)(m.left)):(0,n.isLeft)(m.right)?(0,n.left)(u(m.right.left)):(0,n.right)((0,n.right)(m.right.right))})};n.URI="Either";var D=function(o,u){return{show:function(m){return(0,n.isLeft)(m)?"left(".concat(o.show(m.left),")"):"right(".concat(u.show(m.right),")")}}};n.getShow=D;var K=function(o,u){return{equals:function(m,C){return m===C||((0,n.isLeft)(m)?(0,n.isLeft)(C)&&o.equals(m.left,C.left):(0,n.isRight)(C)&&u.equals(m.right,C.right))}}};n.getEq=K;var x=function(o){return{concat:function(u,m){return(0,n.isLeft)(m)?u:(0,n.isLeft)(u)?m:(0,n.right)(o.concat(u.right,m.right))}}};n.getSemigroup=x;var cn=function(o){var u=(0,n.left)(o.empty);return{URI:n.URI,_E:void 0,compact:function(m){return(0,n.isLeft)(m)?m:m.right._tag==="None"?u:(0,n.right)(m.right.value)},separate:function(m){return(0,n.isLeft)(m)?(0,R.separated)(m,m):(0,n.isLeft)(m.right)?(0,R.separated)((0,n.right)(m.right.left),u):(0,R.separated)(u,(0,n.right)(m.right.right))}}};n.getCompactable=cn;var tn=function(o){var u=(0,n.left)(o.empty),m=(0,n.getCompactable)(o),C=m.compact,Y=m.separate,fn=function(p,l){return(0,n.isLeft)(p)||l(p.right)?p:u},yt=function(p,l){return(0,n.isLeft)(p)?(0,R.separated)(p,p):l(p.right)?(0,R.separated)(u,(0,n.right)(p.right)):(0,R.separated)((0,n.right)(p.right),u)};return{URI:n.URI,_E:void 0,map:_,compact:C,separate:Y,filter:fn,filterMap:function(p,l){if((0,n.isLeft)(p))return p;var h=l(p.right);return h._tag==="None"?u:(0,n.right)(h.value)},partition:yt,partitionMap:function(p,l){if((0,n.isLeft)(p))return(0,R.separated)(p,p);var h=l(p.right);return(0,n.isLeft)(h)?(0,R.separated)((0,n.right)(h.left),u):(0,R.separated)(u,(0,n.right)(h.right))}}};n.getFilterable=tn;var en=function(o){var u=(0,n.getFilterable)(o),m=(0,n.getCompactable)(o);return{URI:n.URI,_E:void 0,map:_,compact:u.compact,separate:u.separate,filter:u.filter,filterMap:u.filterMap,partition:u.partition,partitionMap:u.partitionMap,traverse:I,sequence:n.sequence,reduce:H,foldMap:E,reduceRight:O,wither:(0,w.witherDefault)(n.Traversable,m),wilt:(0,w.wiltDefault)(n.Traversable,m)}};n.getWitherable=en;var Kn=function(o){return{URI:n.URI,_E:void 0,map:_,ap:function(u,m){return(0,n.isLeft)(u)?(0,n.isLeft)(m)?(0,n.left)(o.concat(u.left,m.left)):u:(0,n.isLeft)(m)?m:(0,n.right)(u.right(m.right))},of:n.of}};n.getApplicativeValidation=Kn;var pn=function(o){return{URI:n.URI,_E:void 0,map:_,alt:function(u,m){if((0,n.isRight)(u))return u;var C=m();return(0,n.isLeft)(C)?(0,n.left)(o.concat(u.left,C.left)):C}}};n.getAltValidation=pn;var Bn=function(o){return function(u){return(0,n.isLeft)(u)?u:(0,n.right)(o(u.right))}};n.map=Bn,n.Functor={URI:n.URI,map:_},n.of=n.right,n.Pointed={URI:n.URI,of:n.of};var Vn=function(o){return function(u){return(0,n.isLeft)(u)?u:(0,n.isLeft)(o)?o:(0,n.right)(u.right(o.right))}};n.apW=Vn,n.ap=n.apW,n.Apply={URI:n.URI,map:_,ap:P},n.Applicative={URI:n.URI,map:_,ap:P,of:n.of};var $n=function(o){return function(u){return(0,n.isLeft)(u)?u:o(u.right)}};n.chainW=$n,n.chain=n.chainW,n.Chain={URI:n.URI,map:_,ap:P,chain:j},n.Monad={URI:n.URI,map:_,ap:P,of:n.of,chain:j};var Gn=function(o,u){return function(m){return(0,n.isLeft)(m)?o:u(o,m.right)}};n.reduce=Gn;var Jn=function(o){return function(u){return function(m){return(0,n.isLeft)(m)?o.empty:u(m.right)}}};n.foldMap=Jn;var Yn=function(o,u){return function(m){return(0,n.isLeft)(m)?o:u(m.right,o)}};n.reduceRight=Yn,n.Foldable={URI:n.URI,reduce:H,foldMap:E,reduceRight:O};var Hn=function(o){return function(u){return function(m){return(0,n.isLeft)(m)?o.of((0,n.left)(m.left)):o.map(u(m.right),n.right)}}};n.traverse=Hn;var Xn=function(o){return function(u){return(0,n.isLeft)(u)?o.of((0,n.left)(u.left)):o.map(u.right,n.right)}};n.sequence=Xn,n.Traversable={URI:n.URI,map:_,reduce:H,foldMap:E,reduceRight:O,traverse:I,sequence:n.sequence};var Zn=function(o,u){return function(m){return(0,n.isLeft)(m)?(0,n.left)(o(m.left)):(0,n.right)(u(m.right))}};n.bimap=Zn;var Qn=function(o){return function(u){return(0,n.isLeft)(u)?(0,n.left)(o(u.left)):u}};n.mapLeft=Qn,n.Bifunctor={URI:n.URI,bimap:f,mapLeft:c};var kn=function(o){return function(u){return(0,n.isLeft)(u)?o():u}};n.altW=kn,n.alt=n.altW,n.Alt={URI:n.URI,map:_,alt:v};var zn=function(o){return function(u){return(0,n.isLeft)(u)?u:(0,n.right)(o(u))}};n.extend=zn,n.Extend={URI:n.URI,map:_,extend:S},n.ChainRec={URI:n.URI,map:_,ap:P,chain:j,chainRec:W},n.throwError=n.left,n.MonadThrow={URI:n.URI,map:_,ap:P,of:n.of,chain:j,throwError:n.throwError},n.FromEither={URI:n.URI,fromEither:b.identity},n.fromPredicate=(0,g.fromPredicate)(n.FromEither),n.fromOption=(0,g.fromOption)(n.FromEither),n.isLeft=M.isLeft,n.isRight=M.isRight;var xn=function(o,u){return function(m){return(0,n.isLeft)(m)?o(m.left):u(m.right)}};n.matchW=xn,n.foldW=n.matchW,n.match=n.matchW,n.fold=n.match;var nt=function(o){return function(u){return(0,n.isLeft)(u)?o(u.left):u.right}};n.getOrElseW=nt,n.getOrElse=n.getOrElseW,n.flap=(0,s.flap)(n.Functor),n.apFirst=(0,i.apFirst)(n.Apply),n.apFirstW=n.apFirst,n.apSecond=(0,i.apSecond)(n.Apply),n.apSecondW=n.apSecond,n.chainFirst=(0,d.chainFirst)(n.Chain),n.chainFirstW=n.chainFirst,n.flattenW=(0,n.chainW)(b.identity),n.flatten=n.flattenW,n.duplicate=(0,n.extend)(b.identity),n.fromOptionK=(0,g.fromOptionK)(n.FromEither),n.chainOptionK=(0,g.chainOptionK)(n.FromEither,n.Chain),n.filterOrElse=(0,g.filterOrElse)(n.FromEither,n.Chain),n.filterOrElseW=n.filterOrElse;var tt=function(o){return(0,n.isLeft)(o)?(0,n.right)(o.left):(0,n.left)(o.right)};n.swap=tt;var et=function(o){return function(u){return(0,n.isLeft)(u)?o(u.left):u}};n.orElseW=et,n.orElse=n.orElseW;var rt=function(o){return function(u){return u==null?(0,n.left)(o):(0,n.right)(u)}};n.fromNullable=rt;var at=function(o,u){try{return(0,n.right)(o())}catch(m){return(0,n.left)(u(m))}};n.tryCatch=at;var it=function(o,u){return function(){for(var m=[],C=0;C<arguments.length;C++)m[C]=arguments[C];return(0,n.tryCatch)(function(){return o.apply(void 0,m)},u)}};n.tryCatchK=it;var _n=function(o){var u=(0,n.fromNullable)(o);return function(m){return(0,b.flow)(m,u)}};n.fromNullableK=_n;var Sn=function(o){var u=(0,n.fromNullableK)(o);return function(m){return(0,n.chain)(u(m))}};n.chainNullableK=Sn,n.toUnion=(0,n.foldW)(b.identity,b.identity);function ut(o){return o instanceof Error?o:new Error(String(o))}n.toError=ut;function In(o){return function(u,m){if(m===void 0){var C=In(o);return function(Y){return C(u,Y)}}return(0,n.isLeft)(m)?!1:o.equals(u,m.right)}}n.elem=In;var ct=function(o){return function(u){return(0,n.isLeft)(u)?!1:o(u.right)}};n.exists=ct,n.Do=(0,n.of)(M.emptyRecord),n.bindTo=(0,s.bindTo)(n.Functor),n.bind=(0,d.bind)(n.Chain),n.bindW=n.bind,n.apS=(0,i.apS)(n.Apply),n.apSW=n.apS,n.ApT=(0,n.of)(M.emptyReadonlyArray);var lt=function(o){return function(u){var m=o(0,M.head(u));if((0,n.isLeft)(m))return m;for(var C=[m.right],Y=1;Y<u.length;Y++){var fn=o(Y,u[Y]);if((0,n.isLeft)(fn))return fn;C.push(fn.right)}return(0,n.right)(C)}};n.traverseReadonlyNonEmptyArrayWithIndex=lt;var ot=function(o){var u=(0,n.traverseReadonlyNonEmptyArrayWithIndex)(o);return function(m){return M.isNonEmpty(m)?u(m):n.ApT}};n.traverseReadonlyArrayWithIndex=ot,n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex;var ft=function(o){return(0,n.traverseReadonlyArrayWithIndex)(function(u,m){return o(m)})};n.traverseArray=ft,n.sequenceArray=(0,n.traverseArray)(b.identity);function ht(o,u){return(0,n.tryCatch)(function(){return JSON.parse(o)},u)}n.parseJSON=ht;var dt=function(o,u){return(0,n.tryCatch)(function(){var m=JSON.stringify(o);if(typeof m!="string")throw new Error("Converting unsupported structure to JSON");return m},u)};n.stringifyJSON=dt,n.either={URI:n.URI,map:_,of:n.of,ap:P,chain:j,reduce:H,foldMap:E,reduceRight:O,traverse:I,sequence:n.sequence,bimap:f,mapLeft:c,alt:v,extend:S,chainRec:W,throwError:n.throwError},n.getApplySemigroup=(0,i.getApplySemigroup)(n.Apply),n.getApplyMonoid=(0,a.getApplicativeMonoid)(n.Applicative);var gt=function(o,u){return(0,i.getApplySemigroup)((0,n.getApplicativeValidation)(o))(u)};n.getValidationSemigroup=gt;var mt=function(o,u){return(0,a.getApplicativeMonoid)((0,n.getApplicativeValidation)(o))(u)};n.getValidationMonoid=mt;function vt(o){var u=(0,n.getApplicativeValidation)(o).ap,m=(0,n.getAltValidation)(o).alt;return{URI:n.URI,_E:void 0,map:_,of:n.of,chain:j,bimap:f,mapLeft:c,reduce:H,foldMap:E,reduceRight:O,extend:S,traverse:I,sequence:n.sequence,chainRec:W,throwError:n.throwError,ap:u,alt:m}}n.getValidation=vt})(Nt);var Wt={},ee={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.and=n.or=n.not=n.Contravariant=n.getMonoidAll=n.getSemigroupAll=n.getMonoidAny=n.getSemigroupAny=n.URI=n.contramap=void 0;var t=X,e=function(M,R){return(0,t.pipe)(M,(0,n.contramap)(R))},r=function(M){return function(R){return(0,t.flow)(M,R)}};n.contramap=r,n.URI="Predicate";var a=function(){return{concat:function(M,R){return(0,t.pipe)(M,(0,n.or)(R))}}};n.getSemigroupAny=a;var i=function(){return{concat:(0,n.getSemigroupAny)().concat,empty:t.constFalse}};n.getMonoidAny=i;var d=function(){return{concat:function(M,R){return(0,t.pipe)(M,(0,n.and)(R))}}};n.getSemigroupAll=d;var y=function(){return{concat:(0,n.getSemigroupAll)().concat,empty:t.constTrue}};n.getMonoidAll=y,n.Contravariant={URI:n.URI,contramap:e};var g=function(M){return function(R){return!M(R)}};n.not=g;var b=function(M){return function(R){return function(w){return R(w)||M(w)}}};n.or=b;var s=function(M){return function(R){return function(w){return R(w)&&M(w)}}};n.and=s})(ee);var re={},z={};Object.defineProperty(z,"__esModule",{value:!0});z.concatAll=z.endo=z.filterSecond=z.filterFirst=z.reverse=void 0;var ca=function(n){return{concat:function(t,e){return n.concat(e,t)}}};z.reverse=ca;var la=function(n){return function(t){return{concat:function(e,r){return n(e)?t.concat(e,r):r}}}};z.filterFirst=la;var oa=function(n){return function(t){return{concat:function(e,r){return n(r)?t.concat(e,r):e}}}};z.filterSecond=oa;var fa=function(n){return function(t){return{concat:function(e,r){return t.concat(n(e),n(r))}}}};z.endo=fa;var ha=function(n){return function(t){return function(e){return e.reduce(function(r,a){return n.concat(r,a)},t)}}};z.concatAll=ha;(function(n){var t=U&&U.__createBinding||(Object.create?function(E,O,I,f){f===void 0&&(f=I);var c=Object.getOwnPropertyDescriptor(O,I);(!c||("get"in c?!O.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return O[I]}}),Object.defineProperty(E,f,c)}:function(E,O,I,f){f===void 0&&(f=I),E[f]=O[I]}),e=U&&U.__setModuleDefault||(Object.create?function(E,O){Object.defineProperty(E,"default",{enumerable:!0,value:O})}:function(E,O){E.default=O}),r=U&&U.__importStar||function(E){if(E&&E.__esModule)return E;var O={};if(E!=null)for(var I in E)I!=="default"&&Object.prototype.hasOwnProperty.call(E,I)&&t(O,E,I);return e(O,E),O};Object.defineProperty(n,"__esModule",{value:!0}),n.semigroupProduct=n.semigroupSum=n.semigroupString=n.getFunctionSemigroup=n.semigroupAny=n.semigroupAll=n.fold=n.getIntercalateSemigroup=n.getMeetSemigroup=n.getJoinSemigroup=n.getDualSemigroup=n.getStructSemigroup=n.getTupleSemigroup=n.getFirstSemigroup=n.getLastSemigroup=n.getObjectSemigroup=n.semigroupVoid=n.concatAll=n.last=n.first=n.intercalate=n.tuple=n.struct=n.reverse=n.constant=n.max=n.min=void 0;var a=X,i=r(L),d=r(z),y=r(Qt),g=function(E){return{concat:y.min(E)}};n.min=g;var b=function(E){return{concat:y.max(E)}};n.max=b;var s=function(E){return{concat:function(){return E}}};n.constant=s,n.reverse=d.reverse;var M=function(E){return{concat:function(O,I){var f={};for(var c in E)i.has.call(E,c)&&(f[c]=E[c].concat(O[c],I[c]));return f}}};n.struct=M;var R=function(){for(var E=[],O=0;O<arguments.length;O++)E[O]=arguments[O];return{concat:function(I,f){return E.map(function(c,v){return c.concat(I[v],f[v])})}}};n.tuple=R;var w=function(E){return function(O){return{concat:function(I,f){return O.concat(I,O.concat(E,f))}}}};n.intercalate=w;var _=function(){return{concat:a.identity}};n.first=_;var P=function(){return{concat:function(E,O){return O}}};n.last=P,n.concatAll=d.concatAll,n.semigroupVoid=(0,n.constant)(void 0);var j=function(){return{concat:function(E,O){return Object.assign({},E,O)}}};n.getObjectSemigroup=j,n.getLastSemigroup=n.last,n.getFirstSemigroup=n.first,n.getTupleSemigroup=n.tuple,n.getStructSemigroup=n.struct,n.getDualSemigroup=n.reverse,n.getJoinSemigroup=n.max,n.getMeetSemigroup=n.min,n.getIntercalateSemigroup=n.intercalate;function H(E){var O=(0,n.concatAll)(E);return function(I,f){return f===void 0?O(I):O(I)(f)}}n.fold=H,n.semigroupAll={concat:function(E,O){return E&&O}},n.semigroupAny={concat:function(E,O){return E||O}},n.getFunctionSemigroup=a.getSemigroup,n.semigroupString={concat:function(E,O){return E+O}},n.semigroupSum={concat:function(E,O){return E+O}},n.semigroupProduct={concat:function(E,O){return E*O}}})(re);var qn={};Object.defineProperty(qn,"__esModule",{value:!0});qn.guard=void 0;function da(n,t){return function(e){return e?t.of(void 0):n.zero()}}qn.guard=da;(function(n){var t=U&&U.__createBinding||(Object.create?function(l,h,A,B){B===void 0&&(B=A);var Q=Object.getOwnPropertyDescriptor(h,A);(!Q||("get"in Q?!h.__esModule:Q.writable||Q.configurable))&&(Q={enumerable:!0,get:function(){return h[A]}}),Object.defineProperty(l,B,Q)}:function(l,h,A,B){B===void 0&&(B=A),l[B]=h[A]}),e=U&&U.__setModuleDefault||(Object.create?function(l,h){Object.defineProperty(l,"default",{enumerable:!0,value:h})}:function(l,h){l.default=h}),r=U&&U.__importStar||function(l){if(l&&l.__esModule)return l;var h={};if(l!=null)for(var A in l)A!=="default"&&Object.prototype.hasOwnProperty.call(l,A)&&t(h,l,A);return e(h,l),h};Object.defineProperty(n,"__esModule",{value:!0}),n.fromEither=n.MonadThrow=n.throwError=n.Witherable=n.wilt=n.wither=n.Traversable=n.sequence=n.traverse=n.Filterable=n.partitionMap=n.partition=n.filterMap=n.filter=n.Compactable=n.separate=n.compact=n.Extend=n.extend=n.Alternative=n.guard=n.Zero=n.zero=n.Alt=n.alt=n.altW=n.Foldable=n.reduceRight=n.foldMap=n.reduce=n.Monad=n.Chain=n.chain=n.Applicative=n.Apply=n.ap=n.Pointed=n.of=n.Functor=n.map=n.getMonoid=n.getOrd=n.getEq=n.getShow=n.URI=n.getRight=n.getLeft=n.fromPredicate=n.some=n.none=void 0,n.getLastMonoid=n.getFirstMonoid=n.getApplyMonoid=n.getApplySemigroup=n.option=n.mapNullable=n.getRefinement=n.sequenceArray=n.traverseArray=n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex=n.traverseReadonlyNonEmptyArrayWithIndex=n.ApT=n.apS=n.bind=n.bindTo=n.Do=n.exists=n.elem=n.toUndefined=n.toNullable=n.chainNullableK=n.fromNullableK=n.tryCatchK=n.tryCatch=n.fromNullable=n.chainFirstEitherK=n.chainEitherK=n.fromEitherK=n.duplicate=n.chainFirst=n.flatten=n.apSecond=n.apFirst=n.flap=n.getOrElse=n.getOrElseW=n.fold=n.match=n.foldW=n.matchW=n.isNone=n.isSome=n.FromEither=void 0;var a=on,i=G,d=un,y=$,g=X,b=Z,s=r(L),M=ee,R=re,w=Ct,_=an,P=qn;n.none=s.none,n.some=s.some;function j(l){return function(h){return l(h)?(0,n.some)(h):n.none}}n.fromPredicate=j;var H=function(l){return l._tag==="Right"?n.none:(0,n.some)(l.left)};n.getLeft=H;var E=function(l){return l._tag==="Left"?n.none:(0,n.some)(l.right)};n.getRight=E;var O=function(l,h){return(0,g.pipe)(l,(0,n.map)(h))},I=function(l,h){return(0,g.pipe)(l,(0,n.ap)(h))},f=function(l,h){return(0,g.pipe)(l,(0,n.chain)(h))},c=function(l,h,A){return(0,g.pipe)(l,(0,n.reduce)(h,A))},v=function(l){var h=(0,n.foldMap)(l);return function(A,B){return(0,g.pipe)(A,h(B))}},S=function(l,h,A){return(0,g.pipe)(l,(0,n.reduceRight)(h,A))},W=function(l){var h=(0,n.traverse)(l);return function(A,B){return(0,g.pipe)(A,h(B))}},D=function(l,h){return(0,g.pipe)(l,(0,n.alt)(h))},K=function(l,h){return(0,g.pipe)(l,(0,n.filter)(h))},x=function(l,h){return(0,g.pipe)(l,(0,n.filterMap)(h))},cn=function(l,h){return(0,g.pipe)(l,(0,n.extend)(h))},tn=function(l,h){return(0,g.pipe)(l,(0,n.partition)(h))},en=function(l,h){return(0,g.pipe)(l,(0,n.partitionMap)(h))};n.URI="Option";var Kn=function(l){return{show:function(h){return(0,n.isNone)(h)?"none":"some(".concat(l.show(h.value),")")}}};n.getShow=Kn;var pn=function(l){return{equals:function(h,A){return h===A||((0,n.isNone)(h)?(0,n.isNone)(A):(0,n.isNone)(A)?!1:l.equals(h.value,A.value))}}};n.getEq=pn;var Bn=function(l){return{equals:(0,n.getEq)(l).equals,compare:function(h,A){return h===A?0:(0,n.isSome)(h)?(0,n.isSome)(A)?l.compare(h.value,A.value):1:-1}}};n.getOrd=Bn;var Vn=function(l){return{concat:function(h,A){return(0,n.isNone)(h)?A:(0,n.isNone)(A)?h:(0,n.some)(l.concat(h.value,A.value))},empty:n.none}};n.getMonoid=Vn;var $n=function(l){return function(h){return(0,n.isNone)(h)?n.none:(0,n.some)(l(h.value))}};n.map=$n,n.Functor={URI:n.URI,map:O},n.of=n.some,n.Pointed={URI:n.URI,of:n.of};var Gn=function(l){return function(h){return(0,n.isNone)(h)||(0,n.isNone)(l)?n.none:(0,n.some)(h.value(l.value))}};n.ap=Gn,n.Apply={URI:n.URI,map:O,ap:I},n.Applicative={URI:n.URI,map:O,ap:I,of:n.of};var Jn=function(l){return function(h){return(0,n.isNone)(h)?n.none:l(h.value)}};n.chain=Jn,n.Chain={URI:n.URI,map:O,ap:I,chain:f},n.Monad={URI:n.URI,map:O,ap:I,of:n.of,chain:f};var Yn=function(l,h){return function(A){return(0,n.isNone)(A)?l:h(l,A.value)}};n.reduce=Yn;var Hn=function(l){return function(h){return function(A){return(0,n.isNone)(A)?l.empty:h(A.value)}}};n.foldMap=Hn;var Xn=function(l,h){return function(A){return(0,n.isNone)(A)?l:h(A.value,l)}};n.reduceRight=Xn,n.Foldable={URI:n.URI,reduce:c,foldMap:v,reduceRight:S};var Zn=function(l){return function(h){return(0,n.isNone)(h)?l():h}};n.altW=Zn,n.alt=n.altW,n.Alt={URI:n.URI,map:O,alt:D};var Qn=function(){return n.none};n.zero=Qn,n.Zero={URI:n.URI,zero:n.zero},n.guard=(0,P.guard)(n.Zero,n.Pointed),n.Alternative={URI:n.URI,map:O,ap:I,of:n.of,alt:D,zero:n.zero};var kn=function(l){return function(h){return(0,n.isNone)(h)?n.none:(0,n.some)(l(h))}};n.extend=kn,n.Extend={URI:n.URI,map:O,extend:cn},n.compact=(0,n.chain)(g.identity);var zn=(0,w.separated)(n.none,n.none),xn=function(l){return(0,n.isNone)(l)?zn:(0,w.separated)((0,n.getLeft)(l.value),(0,n.getRight)(l.value))};n.separate=xn,n.Compactable={URI:n.URI,compact:n.compact,separate:n.separate};var nt=function(l){return function(h){return(0,n.isNone)(h)?n.none:l(h.value)?h:n.none}};n.filter=nt;var tt=function(l){return function(h){return(0,n.isNone)(h)?n.none:l(h.value)}};n.filterMap=tt;var et=function(l){return function(h){return(0,w.separated)(K(h,(0,M.not)(l)),K(h,l))}};n.partition=et;var rt=function(l){return(0,g.flow)((0,n.map)(l),n.separate)};n.partitionMap=rt,n.Filterable={URI:n.URI,map:O,compact:n.compact,separate:n.separate,filter:K,filterMap:x,partition:tn,partitionMap:en};var at=function(l){return function(h){return function(A){return(0,n.isNone)(A)?l.of(n.none):l.map(h(A.value),n.some)}}};n.traverse=at;var it=function(l){return function(h){return(0,n.isNone)(h)?l.of(n.none):l.map(h.value,n.some)}};n.sequence=it,n.Traversable={URI:n.URI,map:O,reduce:c,foldMap:v,reduceRight:S,traverse:W,sequence:n.sequence};var _n=(0,_.witherDefault)(n.Traversable,n.Compactable),Sn=(0,_.wiltDefault)(n.Traversable,n.Compactable),ut=function(l){var h=_n(l);return function(A){return function(B){return h(B,A)}}};n.wither=ut;var In=function(l){var h=Sn(l);return function(A){return function(B){return h(B,A)}}};n.wilt=In,n.Witherable={URI:n.URI,map:O,reduce:c,foldMap:v,reduceRight:S,traverse:W,sequence:n.sequence,compact:n.compact,separate:n.separate,filter:K,filterMap:x,partition:tn,partitionMap:en,wither:_n,wilt:Sn};var ct=function(){return n.none};n.throwError=ct,n.MonadThrow={URI:n.URI,map:O,ap:I,of:n.of,chain:f,throwError:n.throwError},n.fromEither=n.getRight,n.FromEither={URI:n.URI,fromEither:n.fromEither},n.isSome=s.isSome;var lt=function(l){return l._tag==="None"};n.isNone=lt;var ot=function(l,h){return function(A){return(0,n.isNone)(A)?l():h(A.value)}};n.matchW=ot,n.foldW=n.matchW,n.match=n.matchW,n.fold=n.match;var ft=function(l){return function(h){return(0,n.isNone)(h)?l():h.value}};n.getOrElseW=ft,n.getOrElse=n.getOrElseW,n.flap=(0,b.flap)(n.Functor),n.apFirst=(0,i.apFirst)(n.Apply),n.apSecond=(0,i.apSecond)(n.Apply),n.flatten=n.compact,n.chainFirst=(0,d.chainFirst)(n.Chain),n.duplicate=(0,n.extend)(g.identity),n.fromEitherK=(0,y.fromEitherK)(n.FromEither),n.chainEitherK=(0,y.chainEitherK)(n.FromEither,n.Chain),n.chainFirstEitherK=(0,y.chainFirstEitherK)(n.FromEither,n.Chain);var ht=function(l){return l==null?n.none:(0,n.some)(l)};n.fromNullable=ht;var dt=function(l){try{return(0,n.some)(l())}catch{return n.none}};n.tryCatch=dt;var gt=function(l){return function(){for(var h=[],A=0;A<arguments.length;A++)h[A]=arguments[A];return(0,n.tryCatch)(function(){return l.apply(void 0,h)})}};n.tryCatchK=gt;var mt=function(l){return(0,g.flow)(l,n.fromNullable)};n.fromNullableK=mt;var vt=function(l){return function(h){return(0,n.isNone)(h)?n.none:(0,n.fromNullable)(l(h.value))}};n.chainNullableK=vt,n.toNullable=(0,n.match)(g.constNull,g.identity),n.toUndefined=(0,n.match)(g.constUndefined,g.identity);function o(l){return function(h,A){if(A===void 0){var B=o(l);return function(Q){return B(h,Q)}}return(0,n.isNone)(A)?!1:l.equals(h,A.value)}}n.elem=o;var u=function(l){return function(h){return(0,n.isNone)(h)?!1:l(h.value)}};n.exists=u,n.Do=(0,n.of)(s.emptyRecord),n.bindTo=(0,b.bindTo)(n.Functor),n.bind=(0,d.bind)(n.Chain),n.apS=(0,i.apS)(n.Apply),n.ApT=(0,n.of)(s.emptyReadonlyArray);var m=function(l){return function(h){var A=l(0,s.head(h));if((0,n.isNone)(A))return n.none;for(var B=[A.value],Q=1;Q<h.length;Q++){var jt=l(Q,h[Q]);if((0,n.isNone)(jt))return n.none;B.push(jt.value)}return(0,n.some)(B)}};n.traverseReadonlyNonEmptyArrayWithIndex=m;var C=function(l){var h=(0,n.traverseReadonlyNonEmptyArrayWithIndex)(l);return function(A){return s.isNonEmpty(A)?h(A):n.ApT}};n.traverseReadonlyArrayWithIndex=C,n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex;var Y=function(l){return(0,n.traverseReadonlyArrayWithIndex)(function(h,A){return l(A)})};n.traverseArray=Y,n.sequenceArray=(0,n.traverseArray)(g.identity);function fn(l){return function(h){return(0,n.isSome)(l(h))}}n.getRefinement=fn,n.mapNullable=n.chainNullableK,n.option={URI:n.URI,map:O,of:n.of,ap:I,chain:f,reduce:c,foldMap:v,reduceRight:S,traverse:W,sequence:n.sequence,zero:n.zero,alt:D,extend:cn,compact:n.compact,separate:n.separate,filter:K,filterMap:x,partition:tn,partitionMap:en,wither:_n,wilt:Sn,throwError:n.throwError},n.getApplySemigroup=(0,i.getApplySemigroup)(n.Apply),n.getApplyMonoid=(0,a.getApplicativeMonoid)(n.Applicative);var yt=function(){return(0,n.getMonoid)((0,R.first)())};n.getFirstMonoid=yt;var p=function(){return(0,n.getMonoid)((0,R.last)())};n.getLastMonoid=p})(Wt);var ae={};(function(n){var t=U&&U.__createBinding||(Object.create?function(I,f,c,v){v===void 0&&(v=c);var S=Object.getOwnPropertyDescriptor(f,c);(!S||("get"in S?!f.__esModule:S.writable||S.configurable))&&(S={enumerable:!0,get:function(){return f[c]}}),Object.defineProperty(I,v,S)}:function(I,f,c,v){v===void 0&&(v=c),I[v]=f[c]}),e=U&&U.__setModuleDefault||(Object.create?function(I,f){Object.defineProperty(I,"default",{enumerable:!0,value:f})}:function(I,f){I.default=f}),r=U&&U.__importStar||function(I){if(I&&I.__esModule)return I;var f={};if(I!=null)for(var c in I)c!=="default"&&Object.prototype.hasOwnProperty.call(I,c)&&t(f,I,c);return e(f,I),f};Object.defineProperty(n,"__esModule",{value:!0}),n.getMonoid=n.getSemigroup=n.io=n.sequenceArray=n.traverseArray=n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex=n.traverseReadonlyNonEmptyArrayWithIndex=n.ApT=n.apS=n.bind=n.bindTo=n.Do=n.FromIO=n.ChainRec=n.MonadIO=n.fromIO=n.chainFirst=n.Monad=n.Chain=n.Applicative=n.apSecond=n.apFirst=n.Apply=n.Pointed=n.flap=n.Functor=n.URI=n.flatten=n.chain=n.of=n.ap=n.map=void 0;var a=on,i=G,d=un,y=X,g=Z,b=r(L),s=function(I,f){return function(){return f(I())}},M=function(I,f){return function(){return I()(f())}},R=function(I,f){return function(){return f(I())()}},w=function(I,f){return function(){for(var c=f(I)();c._tag==="Left";)c=f(c.left)();return c.right}},_=function(I){return function(f){return s(f,I)}};n.map=_;var P=function(I){return function(f){return M(f,I)}};n.ap=P,n.of=y.constant;var j=function(I){return function(f){return R(f,I)}};n.chain=j,n.flatten=(0,n.chain)(y.identity),n.URI="IO",n.Functor={URI:n.URI,map:s},n.flap=(0,g.flap)(n.Functor),n.Pointed={URI:n.URI,of:n.of},n.Apply={URI:n.URI,map:s,ap:M},n.apFirst=(0,i.apFirst)(n.Apply),n.apSecond=(0,i.apSecond)(n.Apply),n.Applicative={URI:n.URI,map:s,ap:M,of:n.of},n.Chain={URI:n.URI,map:s,ap:M,chain:R},n.Monad={URI:n.URI,map:s,ap:M,of:n.of,chain:R},n.chainFirst=(0,d.chainFirst)(n.Chain),n.fromIO=y.identity,n.MonadIO={URI:n.URI,map:s,ap:M,of:n.of,chain:R,fromIO:n.fromIO},n.ChainRec={URI:n.URI,map:s,ap:M,chain:R,chainRec:w},n.FromIO={URI:n.URI,fromIO:y.identity},n.Do=(0,n.of)(b.emptyRecord),n.bindTo=(0,g.bindTo)(n.Functor),n.bind=(0,d.bind)(n.Chain),n.apS=(0,i.apS)(n.Apply),n.ApT=(0,n.of)(b.emptyReadonlyArray);var H=function(I){return function(f){return function(){for(var c=[I(0,b.head(f))()],v=1;v<f.length;v++)c.push(I(v,f[v])());return c}}};n.traverseReadonlyNonEmptyArrayWithIndex=H;var E=function(I){var f=(0,n.traverseReadonlyNonEmptyArrayWithIndex)(I);return function(c){return b.isNonEmpty(c)?f(c):n.ApT}};n.traverseReadonlyArrayWithIndex=E,n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex;var O=function(I){return(0,n.traverseReadonlyArrayWithIndex)(function(f,c){return I(c)})};n.traverseArray=O,n.sequenceArray=(0,n.traverseArray)(y.identity),n.io={URI:n.URI,map:s,of:n.of,ap:M,chain:R,fromIO:n.fromIO,chainRec:w},n.getSemigroup=(0,i.getApplySemigroup)(n.Apply),n.getMonoid=(0,a.getApplicativeMonoid)(n.Applicative)})(ae);const{pipe:V,flow:pi,constant:Bi,identity:Vi,tupled:$i,constVoid:Gi}=cr;Tt(Nt.Apply);Tt(Wt.Apply);Cn(Nt.Apply);Cn(Wt.Apply);Cn(ae.Apply);const F=(n,t,e)=>n+(t-n)*e,ie=(n,t)=>e=>[n(e),t(e)],Dn=(n,t)=>e=>e==null?t():n(e),ue=(n,t,e,r)=>{const a=(r[0]-e[0])*(n[1]-e[1])-(r[1]-e[1])*(n[0]-e[0]),i=(e[1]-n[1])*(n[0]-t[0])-(e[0]-n[0])*(n[1]-t[1]),d=(r[1]-e[1])*(t[0]-n[0])-(r[0]-e[0])*(t[1]-n[1]);if(d==0)return null;const y=a/d,g=i/d;return y>=0&&y<=1&&g>=0&&g<=1?{position:[F(n[0],t[0],y),F(n[1],t[1],y)],offset:y}:null},ga=(n,t)=>n.every((e,r)=>t.every((a,i)=>ue(e,n[(r+1)%n.length],a,t[(i+1)%t.length])==null));let _t=100,sn=5;J.brain.subscribe(({sensorLength:n})=>{_t=n});J.master.subscribe(({gridSize:n})=>{sn=n});const St=(n,t)=>{const r=[Math.floor((n[0]/200+sn)%sn),Math.floor((n[1]/200+sn)%sn)],a=(r[0]+r[1]*sn)*4,i=d=>d.map(y=>[(r[0]+y[0])*200,(r[1]+y[1])*200]);return[...t[a],...t[a+1],...t[a+2],...t[a+3]].map(i)},ma=(n,t)=>[...St([n.x,n.y],t.borders),...ce(n,t)],va=(n,t)=>[...St([n.x,n.y],t.borders),...St([n.x-Math.sin(n.angle)*_t,n.y-Math.cos(n.angle)*_t],t.borders),...ce(n,t)],ce=(n,t)=>t.polygons.reduce((e,r)=>[...e,...r.map((a,i)=>[a,r[(i+1)%r.length]])],[]),Tn=n=>{const t=[],e=Math.hypot(n.width,n.height)/2,r=Math.atan2(n.width,n.height);return t.push([n.x-Math.sin(-n.angle-r)*e,n.y-Math.cos(-n.angle-r)*e]),t.push([n.x-Math.sin(-n.angle+r)*e,n.y-Math.cos(-n.angle+r)*e]),t.push([n.x-Math.sin(Math.PI-n.angle-r)*e,n.y-Math.cos(Math.PI-n.angle-r)*e]),t.push([n.x-Math.sin(Math.PI-n.angle+r)*e,n.y-Math.cos(Math.PI-n.angle+r)*e]),{box:n,polygon:t}},ya=n=>t=>{const{box:e,polygon:r}=t;return!ma(e,n).every(d=>ga(r,d))},qt=(n,t,e)=>({borders:t,polygons:e.filter(r=>r!==n&&ba(r.box,n.box)<=Math.max(r.box.width,r.box.height)).map(r=>Tn(r.box).polygon)}),ba=(n,t)=>Math.sqrt((n.x-t.x)**2+(n.y-t.y)**2);let le=.01,Rt=5;J.controls.subscribe(({friction:n,maxSpeed:t})=>{le=n,Rt=t});const sa=n=>t=>V(n,_a(t),Sa(t)),_a=n=>t=>{var b,s,M,R;const e=(s=(b=n.physics)==null?void 0:b.mass)!=null?s:10,r=(R=(M=n.physics)==null?void 0:M.momentum)!=null?R:{direction:0,magnitude:0},{thrust:a,breaks:i,angle:d}=t,y=a/e,g=Math.max(Math.min(r.magnitude+y,Rt),-Rt);return n.physics={mass:e,momentum:{...r,magnitude:Math.max(Math.abs(g)-le-i,0)*(g<0?-1:1)}},n.angle=(n.angle+d*g+Math.PI*2)%(Math.PI*2),g},Sa=n=>t=>(n.x+=Math.sin(n.angle)*t,n.y-=Math.cos(n.angle)*t,n),Ra=n=>t=>sa(t)(n),Ma=n=>t=>(t.x=t.x<0?n.width:t.x>n.width?0:t.x,t.y=t.y<0?n.height:t.y>n.height?0:t.y,t),Nn=2*Math.PI,Ia=n=>(n.path=n.path.filter(t=>he([n.box.x,n.box.y],t)>100),n),oe=n=>{const t=n.path[0];return t?Math.atan((t[0]-n.box.x)/(t[1]-n.box.y))-(n.box.y<t[1]?Math.PI:0):0},fe=n=>Math.abs((oe(n)+n.box.angle+Nn)%Nn/Nn-.5)*4-1,he=(n,t)=>Math.sqrt((n[0]-t[0])**2+(n[1]-t[1])**2),wa=n=>he(n.destination,[n.box.x,n.box.y]),Aa=n=>t=>{const[e,r]=n.destination;t.fillStyle="purple",t.beginPath(),t.arc(e,r,n.box.width/2,0,Nn),t.fill(),t.strokeStyle="purple",t.beginPath(),t.setLineDash([9,3]),t.moveTo(n.box.x,n.box.y),t.lineTo(e,r),t.stroke();const a=oe(n),i=[n.box.x,n.box.y],d=[n.box.x-Math.sin(a)*100,n.box.y-Math.cos(a)*100];return t.strokeStyle="red",t.beginPath(),t.setLineDash([9,3]),t.moveTo(...i),t.lineTo(...d),t.stroke(),t.strokeStyle="blue",t.setLineDash([9,3]),t.beginPath(),n.path.forEach((y,g)=>g===0?t.moveTo(...y):t.lineTo(...y)),t.stroke(),t};let Un=3,Mt=100,It=Math.PI/4;Xt.update(n=>n);J.brain.subscribe(({sensorCount:n,sensorLength:t,sensorSpread:e})=>{Un=n,Mt=t,It=e});const de=n=>t=>V(va(t,n),e=>new Array(Un*2).fill(0).map((r,a)=>{const i=a%2*Math.PI+F(It/2,-It/2,Un==1?.5:Math.floor(a/2)/(Un-1))-t.angle,d=[t.x,t.y],y=[t.x-Math.sin(i)*Mt,t.y-Math.cos(i)*Mt],g=e.map(b=>ue(d,y,...b)).filter(b=>b!=null);return g.sort((b,s)=>b.offset-s.offset),{start:d,end:y,contacts:g}})),Oa=(n,t,e)=>r=>V(n.box,de(qt(n,t,e)),Ea(r),Aa(n)),Ea=n=>t=>t.map(e=>{var a,i;const r=(i=(a=e.contacts[0])==null?void 0:a.position)!=null?i:e.end;return n.lineWidth=2,n.strokeStyle="yellow",n.beginPath(),n.moveTo(...e.start),n.lineTo(...r),n.stroke(),n.strokeStyle="black",n.beginPath(),n.moveTo(...e.end),n.lineTo(...r),n.stroke(),n})[0];J.controls.subscribe(({cameraFocus:n})=>{});const Pa=n=>t=>t.map((e,r)=>e.dead?e:V(e.box,Tn,ya(qt(e,n.generatedMap.borders,t)),Ta(e),La,Fa,Ia)),Na=n=>t=>t.map(e=>({car:e,sensor:V(e.box,de(qt(e,n,t)))})),Ua=n=>t=>t.map(({car:e,action:r})=>V(r,Ra(e.box),Ma(n.size))),Ta=n=>t=>{var e,r;return t&&(n.performace-=Math.abs((r=(e=n.box.physics)==null?void 0:e.momentum.magnitude)!=null?r:0))*30,n.dead=t,n},La=n=>{var t,e;return n.performace+=((e=(t=n.box.physics)==null?void 0:t.momentum.magnitude)!=null?e:0)*fe(n)-1,n},Fa=n=>n;let ge=0;J.brain.subscribe(({minFitness:n})=>{ge=n});const Ca=n=>t=>n.map(e=>{const r=Tn(e.box).polygon;t.beginPath(),t.fillStyle=e.dead?"red":e.color,r.forEach((i,d)=>d==0?t.moveTo(...i):t.lineTo(...i)),t.fill();const a={...e.box,height:e.box.height*Math.max(e.fitness/ge,0)};return t.beginPath(),t.fillStyle="red",Tn(a).polygon.forEach((i,d)=>d==0?t.moveTo(...i):t.lineTo(...i)),t.fill(),t})[0],N=6,hn=16,q=5,rn="black",Rn="gray",k=[0,0],bn=[n=>t=>{n.fillStyle=Rn;const e=F(0,t.width,1/N);n.fillRect(e-q*2,0,t.width-e*2+q*4,t.height),n.lineWidth=q,n.strokeStyle=rn;const r=t.height/hn,a=[r,r];new Array(N-1).fill(0).forEach((i,d)=>{const y=F(0,t.width,(d+1)/N);n.beginPath(),n.setLineDash(d==0||d==N-2?k:a),n.moveTo(y,0),n.lineTo(y,t.height),n.stroke()})},n=>t=>{n.fillStyle=Rn;const e={x:F(0,t.width,1/N),y:F(0,t.height,1/N)};n.fillRect(e.x-q*2,0,t.width-e.x*2+q*4,t.height),n.fillRect(0,e.y-q*2,t.width,t.height-e.y*2+q*4),n.fillStyle=rn,n.beginPath(),n.arc(e.x,e.y,q/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(t.width-e.x,e.y,q/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(e.x,t.height-e.y,q/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(t.width-e.x,t.height-e.y,q/2,0,2*Math.PI),n.fill(),n.lineWidth=q,n.strokeStyle=rn;const r=t.height/hn,a=t.width/hn,i=[r,r],d=[a,a];new Array(N-1).fill(0).forEach((y,g)=>{let b=F(0,t.width,(g+1)/N),s=F(0,t.height,1/N);n.setLineDash(g==0||g==N-2?k:i),n.beginPath(),n.moveTo(b,0),n.lineTo(b,s),n.stroke(),n.beginPath(),n.moveTo(b,t.height-s),n.lineTo(b,t.height),n.stroke(),b=F(0,t.width,1/N),s=F(0,t.height,(g+1)/N),n.setLineDash(g==0||g==N-2?k:d),n.beginPath(),n.moveTo(0,s),n.lineTo(b,s),n.stroke(),n.beginPath(),n.moveTo(t.width-b,s),n.lineTo(t.width,s),n.stroke()})},n=>t=>{n.fillStyle=Rn;const e={x:F(0,t.width,1/N),y:F(0,t.height,1/N)};n.fillRect(e.x-q*2,0,t.width-e.x*2+q*4,t.height),n.fillRect(0,e.y-q*2,t.width/2,t.height-e.y*2+q*4),n.fillStyle=rn,n.beginPath(),n.arc(e.x,e.y,q/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(e.x,t.height-e.y,q/2,0,2*Math.PI),n.fill(),n.lineWidth=q,n.strokeStyle=rn;const r=t.height/hn,a=t.width/hn,i=[r,r],d=[a,a];new Array(N-1).fill(0).forEach((y,g)=>{let b=F(0,t.width,(g+1)/N),s=F(0,t.height,1/N);g==N-2?(n.setLineDash(k),n.beginPath(),n.moveTo(b,0),n.lineTo(b,t.height),n.stroke()):(n.setLineDash(g==0||g==N-2?k:i),n.beginPath(),n.moveTo(b,0),n.lineTo(b,s),n.stroke(),n.beginPath(),n.moveTo(b,t.height-s),n.lineTo(b,t.height),n.stroke()),b=F(0,t.width,1/N),s=F(0,t.height,(g+1)/N),n.setLineDash(g==0||g==N-2?k:d),n.beginPath(),n.moveTo(0,s),n.lineTo(b,s),n.stroke()})},n=>t=>{n.fillStyle=Rn;const e={x:F(0,t.width,1/N),y:F(0,t.height,1/N)};n.fillRect(e.x-q*2,0,t.width-e.x*2+q*4,t.height-e.y),n.fillRect(0,e.y-q*2,t.width-e.x+q*2,t.height-e.y*2+q*4),n.fillStyle=rn,n.beginPath(),n.arc(e.x,e.y,q/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(t.width-e.x,t.height-e.y,q/2,0,2*Math.PI),n.fill(),n.lineWidth=q,n.strokeStyle=rn;const r=t.height/hn,a=[r,r];new Array(N-1).fill(0).forEach((i,d)=>{let y=F(0,t.width,(d+1)/N),g=F(0,t.height,1/N);d==N-2?(n.setLineDash(k),n.beginPath(),n.moveTo(y,0),n.lineTo(y,t.height-e.y),n.stroke()):(n.setLineDash(d==0||d==N-2?k:a),n.beginPath(),n.moveTo(y,0),n.lineTo(y,g),n.stroke()),y=F(0,t.width,1/N),g=F(0,t.height,(d+1)/N),d==N-2?(n.setLineDash(k),n.beginPath(),n.moveTo(0,g),n.lineTo(t.width-e.x,g),n.stroke()):(n.setLineDash(d==0||d==N-2?k:a),n.beginPath(),n.moveTo(0,g),n.lineTo(y,g),n.stroke())})},()=>()=>{},n=>t=>{n.fillStyle=Rn;const e={x:F(0,t.width,1/N),y:F(0,t.height,1/N)};n.fillRect(e.x-q*2,0,t.width-e.x*2+q*4,t.height-e.y+q*2),n.fillStyle=rn,n.beginPath(),n.arc(e.x,t.height-e.y,q/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(t.width-e.x,t.height-e.y,q/2,0,2*Math.PI),n.fill(),n.lineWidth=q,n.strokeStyle=rn;const r=t.height/hn,a=[r,r];new Array(N-1).fill(0).forEach((i,d)=>{let y=F(0,t.width,(d+1)/N),g=F(0,t.height,1/N);d==0||d==N-2?(n.setLineDash(k),n.beginPath(),n.moveTo(y,0),n.lineTo(y,t.height-e.y),n.stroke()):(n.setLineDash(a),n.beginPath(),n.moveTo(y,0),n.lineTo(y,g),n.stroke()),y=F(0,t.width,1/N),g=F(0,t.height,(d+1)/N),d==N-2&&(n.setLineDash(k),n.beginPath(),n.moveTo(e.x,g),n.lineTo(t.width-e.x,g),n.stroke())})}],Wa=[()=>({type:0,rotate:0,draw:bn[4]}),n=>({type:1,rotate:n.indexOf(!0),draw:bn[5]}),n=>{const t=n[0]==n[2],e=t?n[0]?0:1:n[0]&&n[3]?0:n[1]&&n[0]?1:n[2]&&n[1]?2:3,r=t?bn[0]:bn[3];return{type:t?2:3,rotate:e,draw:r}},n=>{const t=n[2]&&n[3]&&n[0]?0:n[3]&&n[0]&&n[1]?1:n[0]&&n[1]&&n[2]?2:3;return{type:4,rotate:t,draw:bn[2]}},()=>({type:5,rotate:0,draw:bn[1]})],T=F(0,1,1/N),qa=[[[T,T],[1-T,T]],[[1-T,T],[1-T,1-T]],[[1-T,1-T],[T,1-T]],[[T,1-T],[T,T]]],Da=[[[[T,0],[T,T]],[[1-T,0],[1-T,T]]],[[[1,T],[1-T,T]],[[1,1-T],[1-T,1-T]]],[[[1-T,1],[1-T,1-T]],[[T,1],[T,1-T]]],[[[0,T],[T,T]],[[0,1-T],[T,1-T]]]],ja=n=>n.map((t,e)=>t?Da[e]:[qa[e]]),me=(n,t,e)=>(n-e+t)%t,ve=(n,t,e)=>{let r=(n+1)%t;return r=Math.abs(r%e-n%e)>1?(r-e+t)%t:r,r},ye=(n,t,e)=>(n+e)%t,be=(n,t,e)=>{let r=(n-1+t)%t;return r=Math.abs(r%e-n%e)>1?(r+e)%t:r,r},Ka=n=>{const t=Math.sqrt(n.map.length),e=n.map.map(a=>1/0),r=n.map.map(a=>1/0);return e[n.start]=0,r[n.start]=Se(yn(n.start,t),yn(n.end,t)),se({...n,width:t,open:[n.start],closed:[],costs:e,guesses:r,cameFrom:n.map.map(a=>0)})},se=n=>{const{map:t,start:e,end:r,width:a,open:i,closed:d,costs:y,guesses:g,cameFrom:b}=n,s=_=>Se(yn(_,a),yn(r,a)),M=i.map(_=>s(_)),R=M.reduce((_,P,j)=>P<M[_]?j:_,0),w=i[R];return i.splice(R,1),d.push(w),t[w].map((_,P)=>_?pa[P](w,t.length,a):null).filter(_=>_!=null).filter(_=>!d.includes(_)).forEach(_=>{const j=y[w]+1;j<y[_]&&(b[_]=w,y[_]=j,g[_]=j+s(_),i.includes(_)||i.push(_))}),i.length===0?[]:w===r?_e(b,w,e):se(n)},_e=(n,t,e,r=[t])=>t===e?r:_e(n,n[t],e,[n[t],...r]),yn=(n,t)=>[n%t,Math.floor(n/t)],Se=(n,t)=>Math.abs(n[0]-t[0])+Math.abs(n[1]-t[1]),pa=[me,ve,ye,be],Ba=n=>({connections:Ln[0].slice(),possibilities:new Array(Ln.length).fill(0).map((t,e)=>e),index:n}),Ln=[[!1,!1,!1,!1],[!0,!0,!0,!0],[!0,!1,!0,!1],[!1,!0,!1,!0],[!0,!0,!1,!1],[!1,!1,!0,!0],[!0,!0,!0,!1],[!0,!0,!1,!0],[!0,!1,!0,!0],[!1,!0,!0,!0]],Va=[me,ve,ye,be],$a=(n,t,e)=>{const r=Ln[e.possibilities[Math.floor(Math.random()*e.possibilities.length)]];r.forEach((a,i)=>V(Va[i](e.index,t.length,n),d=>{const y=(i+2)%4;t[d].connections[y]=a,t[d].possibilities=t[d].possibilities.filter(g=>Ln[g][y]===a)})),e.connections=r,e.possibilities=[]},Ga=n=>new Array(n**2).fill(null).map((t,e)=>Ba(e)),Ja=(n,t)=>n.possibilities.length-t.possibilities.length,Re=n=>t=>{if(t.filter(a=>a.possibilities.length!=0).length==0)return t.map(a=>a.connections);const e=t.slice().sort(Ja).filter(a=>a.possibilities.length!=0),r=e.filter(a=>a.possibilities.length==e[0].possibilities.length);return $a(n,t,r[Math.floor(Math.random()*r.length)]),Re(n)(t)},Ya=n=>n.map(t=>Wa[t.reduce((e,r)=>e+Number(r),0)](t)),Ha=n=>V(Ga(n),Re(n),t=>({connections:t,map:Ya(t),borders:t.reduce((e,r)=>[...e,...ja(r)],[])}));let Me=100,Ie=-400;J.master.subscribe(n=>{const t=n.gridSize*200;Me=Math.sqrt(t**2+t**2)});J.brain.subscribe(({minFitness:n})=>{Ie=n});const Xa=n=>n.map(t=>V(t,we,Qa(t.brain))),we=n=>n.performace+wa(n)/Me*Ie,Za=n=>we(n),Qa=n=>t=>({...n,reward:t}),ka=n=>(n.sort((t,e)=>e.reward-t.reward),n[0]);let wt=0,Ae=600,Oe=!1;J.controls.subscribe(({cameraFocus:n,playerControls:t})=>{Oe=t,wt=n});J.brain.subscribe(({minFitness:n})=>{Ae=n});const za=n=>{var e,r;n.map(a=>xa(a));const t=(r=(e=n.slice().map((a,i)=>({car:a,i})).filter(a=>!a.car.dead).sort((a,i)=>i.car.fitness-a.car.fitness)[0])==null?void 0:e.i)!=null?r:0;return!Oe&&wt!=null&&wt!=t&&J.controls.update(a=>({...a,cameraFocus:t})),n.filter(a=>!a.dead)},xa=n=>n.dead?null:ni(n)<Ae?n.dead=!0:null,ni=n=>n.fitness=Za(n),Ji={onkeydown:n=>{n.preventDefault(),Fn[n.key]=ri[n.key]||ai},onkeyup:n=>{n.preventDefault(),delete Fn[n.key]}},ti=()=>{const n={...ei};return Object.keys(Fn).map(t=>Fn[t](n)),n},ei={thrust:0,breaks:0,angle:0};let At=3,Ot=.1,Et=.5*Math.PI/180;J.controls.subscribe(({carThrust:n,carTurnSpeed:t,carBreakStrength:e})=>{At=n,Ot=e,Et=t*Math.PI/180});const Fn={},ri={ArrowUp:n=>n.thrust=At,ArrowDown:n=>n.thrust=At*-.4,ArrowLeft:n=>n.angle=-Et,ArrowRight:n=>n.angle=Et,Shift:n=>n.breaks=Ot,Space:n=>n.breaks=Ot},ai=n=>{};let Ee,Pe;rr.subscribe(n=>{Ee=n});Xt.subscribe(n=>{Pe=n});const Ne=(n,t)=>{const e=document.getElementById(n)||pt("error: declaring canvas returned null",Ee);e.width=t.width,e.height=t.height;const r=e.getContext("2d")||pt("error: declaring context returned null",Pe);return{canvas:e,ctx:r}},pt=(n,t)=>(console.error(n),t);let st;const ii="background-canvas",ui=n=>t=>n.backgroundSaved?(t.drawImage(st,0,0),t):(st=V(Ne(ii,n.size),ci(n)),t.drawImage(st,0,0),n.backgroundSaved=!0,t),ci=n=>t=>{const{canvas:e,ctx:r}=t,{generatedMap:a,size:i,dim:d}=n;r.fillStyle="green",r.fillRect(0,0,i.width,i.height);const y={width:i.width/d,height:i.height/d};return new Array(a.map.length).fill(0).map((g,b)=>{r.save(),r.translate(F(0,i.width,b%d/d)+y.width/2,F(0,i.height,Math.floor(b/d)/d)+y.height/2),r.rotate(a.map[b].rotate*90*Math.PI/180),r.translate(-y.width/2,-y.height/2),a.map[b].draw(r)(y),r.restore()}),e},li=[[-1,-1],[0,1],[1,0],[0,-1],[-1,0],[1,-1],[-1,1],[1,1]],Yi=(n,t,e,r)=>oi(n,li.filter(a=>!0),e);let Ue=!1,Te=0;J.controls.subscribe(({drawSensors:n,cameraFocus:t})=>{Te=t,Ue=n});const oi=(n,t,e)=>{const r=a=>V(a,ui(n),Ca(e),Ue?Oa(e[Te],n.generatedMap.borders,e):i=>i);return a=>(t.forEach(i=>{a.save(),a.translate(n.size.width*i[0],n.size.height*i[1]),r(a),a.restore()}),r(a))},fi=n=>t=>(t.clearRect(0,0,n.width,n.height),t);let Mn;const hi="network-canvas",Bt="transparent",di="grey",Vt="black",$t="white";let Le;const Hi=(n,t)=>e=>{if(!n)return e;const r={width:e.canvas.width/2.5,height:e.canvas.height/2.5};return Mn=Mn!=null?Mn:Ne(hi,r).ctx,V(Mn,fi(r),gi(Le,t)),e},gi=(n,t)=>e=>{if(!n)return;const r=50,a=r,i=r,d=e.canvas.width-r*2,y=e.canvas.height-r*2,g=2;e.lineDashOffset=-t/50,e.lineWidth=g*2,e.fillStyle=Vt,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.strokeStyle=Vt,e.strokeRect(g,g,e.canvas.width-g*2,e.canvas.height-g*2),e.strokeStyle=di,e.strokeRect(g*3,g*3,e.canvas.width-g*6,e.canvas.height-g*6);const b=y/n.length;for(let s=n.length-1;s>=0;s--){const M=i+F(y-b,0,n.length==1?.5:s/(n.length-1));e.setLineDash([7,3]),mi(e,n[s],a,M,d,b,s==n.length-1?["T","L","Ri","B","Re"]:[])}return e},mi=(n,t,e,r,a,i,d)=>{const y=e+a,g=r+i,{inputs:b,outputs:s,weights:M,biases:R}=t;for(let _=0;_<b.length;_++)for(let P=0;P<s.length;P++)n.beginPath(),n.moveTo(On(b,_,e,y),g),n.lineTo(On(s,P,e,y),r),n.lineWidth=2,n.strokeStyle=En(M[_][P]),n.stroke();const w=18;for(let _=0;_<b.length;_++){const P=On(b,_,e,y);n.beginPath(),n.arc(P,g,w*.85,0,Math.PI*2),n.fillStyle=Bt,n.fill(),n.beginPath(),n.arc(P,g,w*.6,0,Math.PI*2),n.fillStyle=En(b[_]),n.fill()}for(let _=0;_<s.length;_++){const P=On(s,_,e,y);n.beginPath(),n.arc(P,r,w*.85,0,Math.PI*2),n.fillStyle=Bt,n.fill(),n.beginPath(),n.arc(P,r,w*.6,0,Math.PI*2),n.fillStyle=En(s[_]),n.fill(),n.beginPath(),n.lineWidth=2,n.arc(P,r,w*1,0,Math.PI*2),n.strokeStyle=En(R[_]),n.setLineDash([3,3]),n.stroke(),n.setLineDash([]),d[_]&&(n.beginPath(),n.textAlign="center",n.textBaseline="middle",n.fillStyle=$t,n.strokeStyle=$t,n.font=w*.9+"px Arial",n.fillText(d[_],P,r+w*.1),n.lineWidth=.5,n.strokeText(d[_],P,r+w*.1))}},On=(n,t,e,r)=>F(e,r,n.length==1?.5:t/(n.length-1)),En=n=>{const t=Math.abs(n),e=255,r=0,a=n>0?255:0;return`rgba(${e},${a},${r},${t})`},vi=n=>Le=n;let Fe=0,Ce=3,We=.1,Pt=.5*Math.PI/180,qe=!1;J.controls.subscribe(n=>{Fe=n.cameraFocus,qe=n.playerControls,Ce=n.carThrust,We=n.carBreakStrength,Pt=n.carTurnSpeed*Math.PI/180});const yi=n=>qe?n.map(({car:t})=>({car:t,action:ti()})):n.map(({car:t,sensor:e},r)=>bi(t,e,r)),bi=(n,t,e)=>{const[r,a,i,d,y]=V([fe(n),...t.map(g=>{var b,s;return 1-((s=(b=g.contacts[0])==null?void 0:b.offset)!=null?s:1)})],ie(g=>e===Fe?V(g,tr(n.brain),vi):null,nr(n.brain)))[1];return{car:n,action:{thrust:Ce*r*(y>.5?-.4:1),angle:Pt*-a+Pt*i,breaks:We*d}}},Dt="bestNetwork";let jn=!1;Pn.subscribe(n=>jn=n);const si=n=>{if(!jn)return!1;try{localStorage.setItem(Dt,JSON.stringify(n))}catch{return!1}return!0},_i=()=>{if(!jn)return!1;try{localStorage.removeItem(Dt)}catch{return!1}return!0},Si=()=>{if(!jn)return null;try{return localStorage.getItem(Dt)}catch{return null}},Ri=n=>si(n),Mi=n=>!0,De=()=>{var n;return JSON.parse((n=Si())!=null?n:"null")},Ii=De,je=()=>V(De(),Dn(n=>n,Ii)),wi=_i,Ai=n=>{const t=je();return Zt.update(e=>({...e,curReward:n.reward,bestReward:t==null?void 0:t.reward})),t==null||t.reward<n.reward?n:null},Oi=(n,t=.3)=>({layers:Ei(n.layers,t)}),Ei=(n,t)=>n.map(e=>V(e,Pi(t),Ni(t))),Pi=n=>t=>(t.biases=t.biases.map(e=>F(e,Math.random()*2-1,n)),t),Ni=n=>t=>(t.weights=t.weights.map(e=>e.map(r=>F(r,Math.random()*2-1,n))),t),{simulation:Ui,master:Ke}=J,mn=200,Gt=mn/N*.6,Jt=["#0f0","#000","#0ff","#f0f","#fff"];let dn=gn.master,nn=gn.simulation;Ke.subscribe(n=>dn=n);Ui.subscribe(n=>nn=n);const Ti=(n,t,e)=>{const r=Number(dn.gridSize),a=n.connections.map((P,j)=>({connection:P,tile:j})).filter(P=>P.connection.includes(!0)),i=Math.floor(Math.random()*a.length),d=a[i].tile,y=a.map(P=>({...P,path:Ka({map:n.connections,start:d,end:P.tile})})).reduce((P,j)=>P.path.length>j.path.length?P:j),g=y.tile,b=y.path.map(P=>yn(P,r).map(j=>j*200+100)),[s,M]=yn(d,r),R=yn(g,r).map(P=>P*200+100),w=(y.path[1]+r+1)%n.connections.length-(y.path[0]+r+1)%n.connections.length,_=w===1?Math.PI/2:w===r?Math.PI:w===-r?0:3*Math.PI/2;return{brain:V(e,Dn(Oi,()=>Yt([t*2+1,...nn.layers]))),box:{x:s*mn+F(0,mn,(Math.floor(1+Math.random()*(N-2))+.5)/N),y:M*mn+F(0,mn,(Math.floor(1+Math.random()*(N-2))+.5)/N),width:Gt,height:Gt*1.6,angle:_,physics:{momentum:{direction:0,magnitude:0},mass:Math.random()*5+5}},destination:R,color:Jt[Math.floor(Math.random()*Jt.length)],dead:!1,fitness:0,performace:0,path:b}},Li=(n,t)=>{var y,g;const r=Ha(Number(dn.gridSize)),a=(y=t==null?void 0:t.world)!=null?y:{generatedMap:r,dim:dn.gridSize,size:{width:dn.gridSize*mn,height:dn.gridSize*mn},backgroundSaved:!1},i=V(je(),Dn(b=>n.sensorCount===b.layers[0].inputs.length?b:null,()=>null)),d=(g=t==null?void 0:t.carSpots)!=null?g:new Array(dn.carAmount).fill(gn.simulation.carSpots[0]).map(()=>Ti(r,n.sensorCount,i));return{world:a,carSpots:d,currentId:null}},Fi=()=>requestAnimationFrame(pe),Ci=n=>nn.destroyed||nn.currentId!=n,pe=(n,t=n,e=Math.random())=>{if(nn.currentId==null&&(nn.currentId=e),!Ci(e)){if(qi()){Wi();return}Zt.update(r=>({...r,fps:Math.round(1/((n-t)/1e3))})),requestAnimationFrame(r=>pe(r,n,e))}},Wi=()=>V(nn.carSpots,Xa,ka,Ai,Dn(ie(Ri,Mi),()=>[!0]),n=>n.every(t=>t)?requestAnimationFrame(()=>Ke.update(t=>({...t}))):alert("error! could not save to each storage")),qi=()=>V(nn.carSpots,Pa(nn.world),za,Na(nn.world.generatedMap.borders),yi,Ua(nn.world)).every(n=>n==null);function Di(n){let t;const e=n[8].default,r=Ge(e,n,n[7],null);return{c(){r&&r.c()},l(a){r&&r.l(a)},m(a,i){r&&r.m(a,i),t=!0},p(a,[i]){r&&r.p&&(!t||i&128)&&Je(r,e,a,a[7],t?He(e,a[7],i,null):Ye(a[7]),null)},i(a){t||(Xe(r,a),t=!0)},o(a){Ze(r,a),t=!1},d(a){r&&r.d(a)}}}function ji(n,t,e){let r,a,i,d;wn(n,Pn,_=>e(4,r=_));let{$$slots:y={},$$scope:g}=t,{input:b}=t;const{master:s,simulation:M,brain:R,controls:w}=J;return wn(n,s,_=>e(5,a=_)),wn(n,M,_=>e(9,d=_)),wn(n,R,_=>e(6,i=_)),Qe(()=>{An(Pn,r=!0,r),An(M,d.destroyed=!1,d)}),ke(()=>{An(M,d.destroyed=!0,d),An(Pn,r=!1,r)}),n.$$set=_=>{"input"in _&&e(3,b=_.input),"$$scope"in _&&e(7,g=_.$$scope)},n.$$.update=()=>{n.$$.dirty&104&&J.simulation.update(_=>({..._,...Li(i,b)})),n.$$.dirty&64&&wi(),n.$$.dirty&48&&r&&Fi()},[s,M,R,b,r,a,i,g,y]}class Xi extends Be{constructor(t){super(),Ve(this,t,ji,Di,$e,{input:3})}}export{Ji as C,Xi as E,rr as a,Xt as b,J as c,fi as d,Yi as e,ar as f,sa as g,Zt as l,V as p,Hi as r};
