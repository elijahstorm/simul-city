import{S as qt,i as Dt,s as jt,U as Kt,k as Se,a as Xe,l as we,m as Re,h as gn,c as Qe,n as en,p as pt,b as Un,Q as Me,A as ke,V as Bt,T as _n,W as Tn,o as Vt,H as Gt,X as Jt}from"./index-7bc860ef.js";import{w as mn}from"./index-17f28254.js";function Ht(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const a in r)if(a!=="default"&&!(a in n)){const i=Object.getOwnPropertyDescriptor(r,a);i&&Object.defineProperty(n,a,i.get?i:{enumerable:!0,get:()=>r[a]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var N=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Yt(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var $={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.getEndomorphismMonoid=n.not=n.SK=n.hole=n.pipe=n.untupled=n.tupled=n.absurd=n.decrement=n.increment=n.tuple=n.flow=n.flip=n.constVoid=n.constUndefined=n.constNull=n.constFalse=n.constTrue=n.constant=n.unsafeCoerce=n.identity=n.apply=n.getRing=n.getSemiring=n.getMonoid=n.getSemigroup=n.getBooleanAlgebra=void 0;var e=function(o){return function(){return{meet:function(l,v){return function(S){return o.meet(l(S),v(S))}},join:function(l,v){return function(S){return o.join(l(S),v(S))}},zero:function(){return o.zero},one:function(){return o.one},implies:function(l,v){return function(S){return o.implies(l(S),v(S))}},not:function(l){return function(v){return o.not(l(v))}}}}};n.getBooleanAlgebra=e;var t=function(o){return function(){return{concat:function(l,v){return function(S){return o.concat(l(S),v(S))}}}}};n.getSemigroup=t;var r=function(o){var l=(0,n.getSemigroup)(o);return function(){return{concat:l().concat,empty:function(){return o.empty}}}};n.getMonoid=r;var a=function(o){return{add:function(l,v){return function(S){return o.add(l(S),v(S))}},zero:function(){return o.zero},mul:function(l,v){return function(S){return o.mul(l(S),v(S))}},one:function(){return o.one}}};n.getSemiring=a;var i=function(o){var l=(0,n.getSemiring)(o);return{add:l.add,mul:l.mul,one:l.one,zero:l.zero,sub:function(v,S){return function(C){return o.sub(v(C),S(C))}}}};n.getRing=i;var d=function(o){return function(l){return l(o)}};n.apply=d;function b(o){return o}n.identity=b,n.unsafeCoerce=b;function m(o){return function(){return o}}n.constant=m,n.constTrue=m(!0),n.constFalse=m(!1),n.constNull=m(null),n.constUndefined=m(void 0),n.constVoid=n.constUndefined;function _(o){return function(l,v){return o(v,l)}}n.flip=_;function y(o,l,v,S,C,W,K,k,cn){switch(arguments.length){case 1:return o;case 2:return function(){return l(o.apply(this,arguments))};case 3:return function(){return v(l(o.apply(this,arguments)))};case 4:return function(){return S(v(l(o.apply(this,arguments))))};case 5:return function(){return C(S(v(l(o.apply(this,arguments)))))};case 6:return function(){return W(C(S(v(l(o.apply(this,arguments))))))};case 7:return function(){return K(W(C(S(v(l(o.apply(this,arguments)))))))};case 8:return function(){return k(K(W(C(S(v(l(o.apply(this,arguments))))))))};case 9:return function(){return cn(k(K(W(C(S(v(l(o.apply(this,arguments)))))))))}}}n.flow=y;function w(){for(var o=[],l=0;l<arguments.length;l++)o[l]=arguments[l];return o}n.tuple=w;function M(o){return o+1}n.increment=M;function E(o){return o-1}n.decrement=E;function O(o){throw new Error("Called `absurd` function which should be uncallable")}n.absurd=O;function F(o){return function(l){return o.apply(void 0,l)}}n.tupled=F;function V(o){return function(){for(var l=[],v=0;v<arguments.length;v++)l[v]=arguments[v];return o(l)}}n.untupled=V;function Z(o,l,v,S,C,W,K,k,cn){switch(arguments.length){case 1:return o;case 2:return l(o);case 3:return v(l(o));case 4:return S(v(l(o)));case 5:return C(S(v(l(o))));case 6:return W(C(S(v(l(o)))));case 7:return K(W(C(S(v(l(o))))));case 8:return k(K(W(C(S(v(l(o)))))));case 9:return cn(k(K(W(C(S(v(l(o))))))));default:{for(var an=arguments[0],un=1;un<arguments.length;un++)an=arguments[un](an);return an}}}n.pipe=Z,n.hole=O;var s=function(o,l){return l};n.SK=s;function A(o){return function(l){return!o(l)}}n.not=A;var R=function(){return{concat:function(o,l){return y(o,l)},empty:b}};n.getEndomorphismMonoid=R})($);const Zt=Yt($),Xt=Ht({__proto__:null,default:Zt},[$]);var tt={},rt={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.eqDate=n.eqNumber=n.eqString=n.eqBoolean=n.eq=n.strictEqual=n.getStructEq=n.getTupleEq=n.Contravariant=n.getMonoid=n.getSemigroup=n.eqStrict=n.URI=n.contramap=n.tuple=n.struct=n.fromEquals=void 0;var e=$,t=function(y){return{equals:function(w,M){return w===M||y(w,M)}}};n.fromEquals=t;var r=function(y){return(0,n.fromEquals)(function(w,M){for(var E in y)if(!y[E].equals(w[E],M[E]))return!1;return!0})};n.struct=r;var a=function(){for(var y=[],w=0;w<arguments.length;w++)y[w]=arguments[w];return(0,n.fromEquals)(function(M,E){return y.every(function(O,F){return O.equals(M[F],E[F])})})};n.tuple=a;var i=function(y,w){return(0,e.pipe)(y,(0,n.contramap)(w))},d=function(y){return function(w){return(0,n.fromEquals)(function(M,E){return w.equals(y(M),y(E))})}};n.contramap=d,n.URI="Eq",n.eqStrict={equals:function(y,w){return y===w}};var b={equals:function(){return!0}},m=function(){return{concat:function(y,w){return(0,n.fromEquals)(function(M,E){return y.equals(M,E)&&w.equals(M,E)})}}};n.getSemigroup=m;var _=function(){return{concat:(0,n.getSemigroup)().concat,empty:b}};n.getMonoid=_,n.Contravariant={URI:n.URI,contramap:i},n.getTupleEq=n.tuple,n.getStructEq=n.struct,n.strictEqual=n.eqStrict.equals,n.eq=n.Contravariant,n.eqBoolean=n.eqStrict,n.eqString=n.eqStrict,n.eqNumber=n.eqStrict,n.eqDate={equals:function(y,w){return y.valueOf()===w.valueOf()}}})(rt);(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.ordDate=n.ordNumber=n.ordString=n.ordBoolean=n.ord=n.getDualOrd=n.getTupleOrd=n.between=n.clamp=n.max=n.min=n.geq=n.leq=n.gt=n.lt=n.equals=n.trivial=n.Contravariant=n.getMonoid=n.getSemigroup=n.URI=n.contramap=n.reverse=n.tuple=n.fromCompare=n.equalsDefault=void 0;var e=rt,t=$,r=function(l){return function(v,S){return v===S||l(v,S)===0}};n.equalsDefault=r;var a=function(l){return{equals:(0,n.equalsDefault)(l),compare:function(v,S){return v===S?0:l(v,S)}}};n.fromCompare=a;var i=function(){for(var l=[],v=0;v<arguments.length;v++)l[v]=arguments[v];return(0,n.fromCompare)(function(S,C){for(var W=0;W<l.length-1;W++){var K=l[W].compare(S[W],C[W]);if(K!==0)return K}return l[W].compare(S[W],C[W])})};n.tuple=i;var d=function(l){return(0,n.fromCompare)(function(v,S){return l.compare(S,v)})};n.reverse=d;var b=function(l,v){return(0,t.pipe)(l,(0,n.contramap)(v))},m=function(l){return function(v){return(0,n.fromCompare)(function(S,C){return v.compare(l(S),l(C))})}};n.contramap=m,n.URI="Ord";var _=function(){return{concat:function(l,v){return(0,n.fromCompare)(function(S,C){var W=l.compare(S,C);return W!==0?W:v.compare(S,C)})}}};n.getSemigroup=_;var y=function(){return{concat:(0,n.getSemigroup)().concat,empty:(0,n.fromCompare)(function(){return 0})}};n.getMonoid=y,n.Contravariant={URI:n.URI,contramap:b},n.trivial={equals:t.constTrue,compare:(0,t.constant)(0)};var w=function(l){return function(v){return function(S){return S===v||l.compare(S,v)===0}}};n.equals=w;var M=function(l){return function(v,S){return l.compare(v,S)===-1}};n.lt=M;var E=function(l){return function(v,S){return l.compare(v,S)===1}};n.gt=E;var O=function(l){return function(v,S){return l.compare(v,S)!==1}};n.leq=O;var F=function(l){return function(v,S){return l.compare(v,S)!==-1}};n.geq=F;var V=function(l){return function(v,S){return v===S||l.compare(v,S)<1?v:S}};n.min=V;var Z=function(l){return function(v,S){return v===S||l.compare(v,S)>-1?v:S}};n.max=Z;var s=function(l){var v=(0,n.min)(l),S=(0,n.max)(l);return function(C,W){return function(K){return S(v(K,W),C)}}};n.clamp=s;var A=function(l){var v=(0,n.lt)(l),S=(0,n.gt)(l);return function(C,W){return function(K){return!(v(K,C)||S(K,W))}}};n.between=A,n.getTupleOrd=n.tuple,n.getDualOrd=n.reverse,n.ord=n.Contravariant;function R(l,v){return l<v?-1:l>v?1:0}var o={equals:e.eqStrict.equals,compare:R};n.ordBoolean=o,n.ordString=o,n.ordNumber=o,n.ordDate=(0,t.pipe)(n.ordNumber,(0,n.contramap)(function(l){return l.valueOf()}))})(tt);var De={},vn={},H={},T={},Qt=N&&N.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,a=e.length,i;r<a;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(T,"__esModule",{value:!0});T.fromReadonlyNonEmptyArray=T.has=T.emptyRecord=T.emptyReadonlyArray=T.tail=T.head=T.isNonEmpty=T.singleton=T.right=T.left=T.isRight=T.isLeft=T.some=T.none=T.isSome=T.isNone=void 0;var kt=function(n){return n._tag==="None"};T.isNone=kt;var $t=function(n){return n._tag==="Some"};T.isSome=$t;T.none={_tag:"None"};var zt=function(n){return{_tag:"Some",value:n}};T.some=zt;var xt=function(n){return n._tag==="Left"};T.isLeft=xt;var nr=function(n){return n._tag==="Right"};T.isRight=nr;var er=function(n){return{_tag:"Left",left:n}};T.left=er;var tr=function(n){return{_tag:"Right",right:n}};T.right=tr;var rr=function(n){return[n]};T.singleton=rr;var ar=function(n){return n.length>0};T.isNonEmpty=ar;var ir=function(n){return n[0]};T.head=ir;var ur=function(n){return n.slice(1)};T.tail=ur;T.emptyReadonlyArray=[];T.emptyRecord={};T.has=Object.prototype.hasOwnProperty;var lr=function(n){return Qt([n[0]],n.slice(1),!0)};T.fromReadonlyNonEmptyArray=lr;var cr=N&&N.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,a)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),fr=N&&N.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),or=N&&N.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&cr(e,n,t);return fr(e,n),e};Object.defineProperty(H,"__esModule",{value:!0});var Yn=H.sequenceS=Ke=H.sequenceT=H.getApplySemigroup=H.apS=H.apSecond=H.apFirst=H.ap=void 0,hr=$,dr=or(T);function gr(n,e){return function(t){return function(r){return n.ap(n.map(r,function(a){return function(i){return e.ap(a,i)}}),t)}}}H.ap=gr;function mr(n){return function(e){return function(t){return n.ap(n.map(t,function(r){return function(){return r}}),e)}}}H.apFirst=mr;function vr(n){return function(e){return function(t){return n.ap(n.map(t,function(){return function(r){return r}}),e)}}}H.apSecond=vr;function yr(n){return function(e,t){return function(r){return n.ap(n.map(r,function(a){return function(i){var d;return Object.assign({},a,(d={},d[e]=i,d))}}),t)}}}H.apS=yr;function br(n){return function(e){return{concat:function(t,r){return n.ap(n.map(t,function(a){return function(i){return e.concat(a,i)}}),r)}}}}H.getApplySemigroup=br;function je(n,e,t){return function(r){for(var a=Array(t.length+1),i=0;i<t.length;i++)a[i]=t[i];return a[t.length]=r,e===0?n.apply(null,a):je(n,e-1,a)}}var Ae={1:function(n){return[n]},2:function(n){return function(e){return[n,e]}},3:function(n){return function(e){return function(t){return[n,e,t]}}},4:function(n){return function(e){return function(t){return function(r){return[n,e,t,r]}}}},5:function(n){return function(e){return function(t){return function(r){return function(a){return[n,e,t,r,a]}}}}}};function _r(n){return dr.has.call(Ae,n)||(Ae[n]=je(hr.tuple,n-1,[])),Ae[n]}function Sr(n){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=e.length,a=_r(r),i=n.map(e[0],a),d=1;d<r;d++)i=n.ap(i,e[d]);return i}}var Ke=H.sequenceT=Sr;function wr(n){var e=n.length;switch(e){case 1:return function(t){var r;return r={},r[n[0]]=t,r};case 2:return function(t){return function(r){var a;return a={},a[n[0]]=t,a[n[1]]=r,a}};case 3:return function(t){return function(r){return function(a){var i;return i={},i[n[0]]=t,i[n[1]]=r,i[n[2]]=a,i}}};case 4:return function(t){return function(r){return function(a){return function(i){var d;return d={},d[n[0]]=t,d[n[1]]=r,d[n[2]]=a,d[n[3]]=i,d}}}};case 5:return function(t){return function(r){return function(a){return function(i){return function(d){var b;return b={},b[n[0]]=t,b[n[1]]=r,b[n[2]]=a,b[n[3]]=i,b[n[4]]=d,b}}}}};default:return je(function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];for(var a={},i=0;i<e;i++)a[n[i]]=t[i];return a},e-1,[])}}function Rr(n){return function(e){for(var t=Object.keys(e),r=t.length,a=wr(t),i=n.map(e[t[0]],a),d=1;d<r;d++)i=n.ap(i,e[t[d]]);return i}}Yn=H.sequenceS=Rr;var z={};Object.defineProperty(z,"__esModule",{value:!0});z.getFunctorComposition=z.bindTo=z.flap=z.map=void 0;var Mr=$;function at(n,e){return function(t){return function(r){return n.map(r,function(a){return e.map(a,t)})}}}z.map=at;function Ar(n){return function(e){return function(t){return n.map(t,function(r){return r(e)})}}}z.flap=Ar;function Ir(n){return function(e){return function(t){return n.map(t,function(r){var a;return a={},a[e]=r,a})}}}z.bindTo=Ir;function sr(n,e){var t=at(n,e);return{map:function(r,a){return(0,Mr.pipe)(r,t(a))}}}z.getFunctorComposition=sr;Object.defineProperty(vn,"__esModule",{value:!0});vn.getApplicativeComposition=vn.getApplicativeMonoid=void 0;var it=H,Er=$,Or=z;function Pr(n){var e=(0,it.getApplySemigroup)(n);return function(t){return{concat:e(t).concat,empty:n.of(t.empty)}}}vn.getApplicativeMonoid=Pr;function Nr(n,e){var t=(0,Or.getFunctorComposition)(n,e).map,r=(0,it.ap)(n,e);return{map:t,of:function(a){return n.of(e.of(a))},ap:function(a,i){return(0,Er.pipe)(a,r(i))}}}vn.getApplicativeComposition=Nr;var dn={};Object.defineProperty(dn,"__esModule",{value:!0});dn.bind=dn.chainFirst=void 0;function Ur(n){return function(e){return function(t){return n.chain(t,function(r){return n.map(e(r),function(){return r})})}}}dn.chainFirst=Ur;function Tr(n){return function(e,t){return function(r){return n.chain(r,function(a){return n.map(t(a),function(i){var d;return Object.assign({},a,(d={},d[e]=i,d))})})}}}dn.bind=Tr;var Zn={};Object.defineProperty(Zn,"__esModule",{value:!0});Zn.tailRec=void 0;var Cr=function(n,e){for(var t=e(n);t._tag==="Left";)t=e(t.left);return t.right};Zn.tailRec=Cr;var J={},Lr=N&&N.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,a)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Fr=N&&N.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Wr=N&&N.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Lr(e,n,t);return Fr(e,n),e};Object.defineProperty(J,"__esModule",{value:!0});J.filterOrElse=J.chainFirstEitherK=J.chainEitherK=J.fromEitherK=J.chainOptionK=J.fromOptionK=J.fromPredicate=J.fromOption=void 0;var qr=dn,pe=$,Rn=Wr(T);function ut(n){return function(e){return function(t){return n.fromEither(Rn.isNone(t)?Rn.left(e()):Rn.right(t.value))}}}J.fromOption=ut;function Dr(n){return function(e,t){return function(r){return n.fromEither(e(r)?Rn.right(r):Rn.left(t(r)))}}}J.fromPredicate=Dr;function lt(n){var e=ut(n);return function(t){var r=e(t);return function(a){return(0,pe.flow)(a,r)}}}J.fromOptionK=lt;function jr(n,e){var t=lt(n);return function(r){var a=t(r);return function(i){return function(d){return e.chain(d,a(i))}}}}J.chainOptionK=jr;function Be(n){return function(e){return(0,pe.flow)(e,n.fromEither)}}J.fromEitherK=Be;function Kr(n,e){var t=Be(n);return function(r){return function(a){return e.chain(a,t(r))}}}J.chainEitherK=Kr;function pr(n,e){return(0,pe.flow)(Be(n),(0,qr.chainFirst)(e))}J.chainFirstEitherK=pr;function Br(n,e){return function(t,r){return function(a){return e.chain(a,function(i){return n.fromEither(t(i)?Rn.right(i):Rn.left(r(i)))})}}}J.filterOrElse=Br;var Ve={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.right=n.left=n.flap=n.Functor=n.Bifunctor=n.URI=n.bimap=n.mapLeft=n.map=n.separated=void 0;var e=$,t=z,r=function(M,E){return{left:M,right:E}};n.separated=r;var a=function(M,E){return(0,e.pipe)(M,(0,n.map)(E))},i=function(M,E){return(0,e.pipe)(M,(0,n.mapLeft)(E))},d=function(M,E,O){return(0,e.pipe)(M,(0,n.bimap)(E,O))},b=function(M){return function(E){return(0,n.separated)((0,n.left)(E),M((0,n.right)(E)))}};n.map=b;var m=function(M){return function(E){return(0,n.separated)(M((0,n.left)(E)),(0,n.right)(E))}};n.mapLeft=m;var _=function(M,E){return function(O){return(0,n.separated)(M((0,n.left)(O)),E((0,n.right)(O)))}};n.bimap=_,n.URI="Separated",n.Bifunctor={URI:n.URI,mapLeft:i,bimap:d},n.Functor={URI:n.URI,map:a},n.flap=(0,t.flap)(n.Functor);var y=function(M){return M.left};n.left=y;var w=function(M){return M.right};n.right=w})(Ve);var hn={},Vr=N&&N.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,a)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Gr=N&&N.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Jr=N&&N.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Vr(e,n,t);return Gr(e,n),e};Object.defineProperty(hn,"__esModule",{value:!0});hn.filterE=hn.witherDefault=hn.wiltDefault=void 0;var $e=Jr(T);function Hr(n,e){return function(t){var r=n.traverse(t);return function(a,i){return t.map(r(a,i),e.separate)}}}hn.wiltDefault=Hr;function Yr(n,e){return function(t){var r=n.traverse(t);return function(a,i){return t.map(r(a,i),e.compact)}}}hn.witherDefault=Yr;function Zr(n){return function(e){var t=n.wither(e);return function(r){return function(a){return t(a,function(i){return e.map(r(i),function(d){return d?$e.some(i):$e.none})})}}}}hn.filterE=Zr;(function(n){var e=N&&N.__createBinding||(Object.create?function(f,u,g,D){D===void 0&&(D=g);var X=Object.getOwnPropertyDescriptor(u,g);(!X||("get"in X?!u.__esModule:X.writable||X.configurable))&&(X={enumerable:!0,get:function(){return u[g]}}),Object.defineProperty(f,D,X)}:function(f,u,g,D){D===void 0&&(D=g),f[D]=u[g]}),t=N&&N.__setModuleDefault||(Object.create?function(f,u){Object.defineProperty(f,"default",{enumerable:!0,value:u})}:function(f,u){f.default=u}),r=N&&N.__importStar||function(f){if(f&&f.__esModule)return f;var u={};if(f!=null)for(var g in f)g!=="default"&&Object.prototype.hasOwnProperty.call(f,g)&&e(u,f,g);return t(u,f),u};Object.defineProperty(n,"__esModule",{value:!0}),n.fold=n.match=n.foldW=n.matchW=n.isRight=n.isLeft=n.fromOption=n.fromPredicate=n.FromEither=n.MonadThrow=n.throwError=n.ChainRec=n.Extend=n.extend=n.Alt=n.alt=n.altW=n.Bifunctor=n.mapLeft=n.bimap=n.Traversable=n.sequence=n.traverse=n.Foldable=n.reduceRight=n.foldMap=n.reduce=n.Monad=n.Chain=n.chain=n.chainW=n.Applicative=n.Apply=n.ap=n.apW=n.Pointed=n.of=n.Functor=n.map=n.getAltValidation=n.getApplicativeValidation=n.getWitherable=n.getFilterable=n.getCompactable=n.getSemigroup=n.getEq=n.getShow=n.URI=n.right=n.left=void 0,n.getValidation=n.getValidationMonoid=n.getValidationSemigroup=n.getApplyMonoid=n.getApplySemigroup=n.either=n.stringifyJSON=n.parseJSON=n.sequenceArray=n.traverseArray=n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex=n.traverseReadonlyNonEmptyArrayWithIndex=n.ApT=n.apSW=n.apS=n.bindW=n.bind=n.bindTo=n.Do=n.exists=n.elem=n.toError=n.toUnion=n.chainNullableK=n.fromNullableK=n.tryCatchK=n.tryCatch=n.fromNullable=n.orElse=n.orElseW=n.swap=n.filterOrElseW=n.filterOrElse=n.chainOptionK=n.fromOptionK=n.duplicate=n.flatten=n.flattenW=n.chainFirstW=n.chainFirst=n.apSecondW=n.apSecond=n.apFirstW=n.apFirst=n.flap=n.getOrElse=n.getOrElseW=void 0;var a=vn,i=H,d=dn,b=Zn,m=J,_=$,y=z,w=r(T),M=Ve,E=hn;n.left=w.left,n.right=w.right;var O=function(f,u){return(0,_.pipe)(f,(0,n.map)(u))},F=function(f,u){return(0,_.pipe)(f,(0,n.ap)(u))},V=function(f,u){return(0,_.pipe)(f,(0,n.chain)(u))},Z=function(f,u,g){return(0,_.pipe)(f,(0,n.reduce)(u,g))},s=function(f){return function(u,g){var D=(0,n.foldMap)(f);return(0,_.pipe)(u,D(g))}},A=function(f,u,g){return(0,_.pipe)(f,(0,n.reduceRight)(u,g))},R=function(f){var u=(0,n.traverse)(f);return function(g,D){return(0,_.pipe)(g,u(D))}},o=function(f,u,g){return(0,_.pipe)(f,(0,n.bimap)(u,g))},l=function(f,u){return(0,_.pipe)(f,(0,n.mapLeft)(u))},v=function(f,u){return(0,_.pipe)(f,(0,n.alt)(u))},S=function(f,u){return(0,_.pipe)(f,(0,n.extend)(u))},C=function(f,u){return(0,b.tailRec)(u(f),function(g){return(0,n.isLeft)(g)?(0,n.right)((0,n.left)(g.left)):(0,n.isLeft)(g.right)?(0,n.left)(u(g.right.left)):(0,n.right)((0,n.right)(g.right.right))})};n.URI="Either";var W=function(f,u){return{show:function(g){return(0,n.isLeft)(g)?"left(".concat(f.show(g.left),")"):"right(".concat(u.show(g.right),")")}}};n.getShow=W;var K=function(f,u){return{equals:function(g,D){return g===D||((0,n.isLeft)(g)?(0,n.isLeft)(D)&&f.equals(g.left,D.left):(0,n.isRight)(D)&&u.equals(g.right,D.right))}}};n.getEq=K;var k=function(f){return{concat:function(u,g){return(0,n.isLeft)(g)?u:(0,n.isLeft)(u)?g:(0,n.right)(f.concat(u.right,g.right))}}};n.getSemigroup=k;var cn=function(f){var u=(0,n.left)(f.empty);return{URI:n.URI,_E:void 0,compact:function(g){return(0,n.isLeft)(g)?g:g.right._tag==="None"?u:(0,n.right)(g.right.value)},separate:function(g){return(0,n.isLeft)(g)?(0,M.separated)(g,g):(0,n.isLeft)(g.right)?(0,M.separated)((0,n.right)(g.right.left),u):(0,M.separated)(u,(0,n.right)(g.right.right))}}};n.getCompactable=cn;var an=function(f){var u=(0,n.left)(f.empty),g=(0,n.getCompactable)(f),D=g.compact,X=g.separate,bn=function(p,c){return(0,n.isLeft)(p)||c(p.right)?p:u},_e=function(p,c){return(0,n.isLeft)(p)?(0,M.separated)(p,p):c(p.right)?(0,M.separated)(u,(0,n.right)(p.right)):(0,M.separated)((0,n.right)(p.right),u)};return{URI:n.URI,_E:void 0,map:O,compact:D,separate:X,filter:bn,filterMap:function(p,c){if((0,n.isLeft)(p))return p;var h=c(p.right);return h._tag==="None"?u:(0,n.right)(h.value)},partition:_e,partitionMap:function(p,c){if((0,n.isLeft)(p))return(0,M.separated)(p,p);var h=c(p.right);return(0,n.isLeft)(h)?(0,M.separated)((0,n.right)(h.left),u):(0,M.separated)(u,(0,n.right)(h.right))}}};n.getFilterable=an;var un=function(f){var u=(0,n.getFilterable)(f),g=(0,n.getCompactable)(f);return{URI:n.URI,_E:void 0,map:O,compact:u.compact,separate:u.separate,filter:u.filter,filterMap:u.filterMap,partition:u.partition,partitionMap:u.partitionMap,traverse:R,sequence:n.sequence,reduce:Z,foldMap:s,reduceRight:A,wither:(0,E.witherDefault)(n.Traversable,g),wilt:(0,E.wiltDefault)(n.Traversable,g)}};n.getWitherable=un;var sn=function(f){return{URI:n.URI,_E:void 0,map:O,ap:function(u,g){return(0,n.isLeft)(u)?(0,n.isLeft)(g)?(0,n.left)(f.concat(u.left,g.left)):u:(0,n.isLeft)(g)?g:(0,n.right)(u.right(g.right))},of:n.of}};n.getApplicativeValidation=sn;var En=function(f){return{URI:n.URI,_E:void 0,map:O,alt:function(u,g){if((0,n.isRight)(u))return u;var D=g();return(0,n.isLeft)(D)?(0,n.left)(f.concat(u.left,D.left)):D}}};n.getAltValidation=En;var q=function(f){return function(u){return(0,n.isLeft)(u)?u:(0,n.right)(f(u.right))}};n.map=q,n.Functor={URI:n.URI,map:O},n.of=n.right,n.Pointed={URI:n.URI,of:n.of};var x=function(f){return function(u){return(0,n.isLeft)(u)?u:(0,n.isLeft)(f)?f:(0,n.right)(u.right(f.right))}};n.apW=x,n.ap=n.apW,n.Apply={URI:n.URI,map:O,ap:F},n.Applicative={URI:n.URI,map:O,ap:F,of:n.of};var G=function(f){return function(u){return(0,n.isLeft)(u)?u:f(u.right)}};n.chainW=G,n.chain=n.chainW,n.Chain={URI:n.URI,map:O,ap:F,chain:V},n.Monad={URI:n.URI,map:O,ap:F,of:n.of,chain:V};var ln=function(f,u){return function(g){return(0,n.isLeft)(g)?f:u(f,g.right)}};n.reduce=ln;var yn=function(f){return function(u){return function(g){return(0,n.isLeft)(g)?f.empty:u(g.right)}}};n.foldMap=yn;var Fn=function(f,u){return function(g){return(0,n.isLeft)(g)?f:u(g.right,f)}};n.reduceRight=Fn,n.Foldable={URI:n.URI,reduce:Z,foldMap:s,reduceRight:A};var On=function(f){return function(u){return function(g){return(0,n.isLeft)(g)?f.of((0,n.left)(g.left)):f.map(u(g.right),n.right)}}};n.traverse=On;var kn=function(f){return function(u){return(0,n.isLeft)(u)?f.of((0,n.left)(u.left)):f.map(u.right,n.right)}};n.sequence=kn,n.Traversable={URI:n.URI,map:O,reduce:Z,foldMap:s,reduceRight:A,traverse:R,sequence:n.sequence};var $n=function(f,u){return function(g){return(0,n.isLeft)(g)?(0,n.left)(f(g.left)):(0,n.right)(u(g.right))}};n.bimap=$n;var zn=function(f){return function(u){return(0,n.isLeft)(u)?(0,n.left)(f(u.left)):u}};n.mapLeft=zn,n.Bifunctor={URI:n.URI,bimap:o,mapLeft:l};var xn=function(f){return function(u){return(0,n.isLeft)(u)?f():u}};n.altW=xn,n.alt=n.altW,n.Alt={URI:n.URI,map:O,alt:v};var ne=function(f){return function(u){return(0,n.isLeft)(u)?u:(0,n.right)(f(u))}};n.extend=ne,n.Extend={URI:n.URI,map:O,extend:S},n.ChainRec={URI:n.URI,map:O,ap:F,chain:V,chainRec:C},n.throwError=n.left,n.MonadThrow={URI:n.URI,map:O,ap:F,of:n.of,chain:V,throwError:n.throwError},n.FromEither={URI:n.URI,fromEither:_.identity},n.fromPredicate=(0,m.fromPredicate)(n.FromEither),n.fromOption=(0,m.fromOption)(n.FromEither),n.isLeft=w.isLeft,n.isRight=w.isRight;var ee=function(f,u){return function(g){return(0,n.isLeft)(g)?f(g.left):u(g.right)}};n.matchW=ee,n.foldW=n.matchW,n.match=n.matchW,n.fold=n.match;var te=function(f){return function(u){return(0,n.isLeft)(u)?f(u.left):u.right}};n.getOrElseW=te,n.getOrElse=n.getOrElseW,n.flap=(0,y.flap)(n.Functor),n.apFirst=(0,i.apFirst)(n.Apply),n.apFirstW=n.apFirst,n.apSecond=(0,i.apSecond)(n.Apply),n.apSecondW=n.apSecond,n.chainFirst=(0,d.chainFirst)(n.Chain),n.chainFirstW=n.chainFirst,n.flattenW=(0,n.chainW)(_.identity),n.flatten=n.flattenW,n.duplicate=(0,n.extend)(_.identity),n.fromOptionK=(0,m.fromOptionK)(n.FromEither),n.chainOptionK=(0,m.chainOptionK)(n.FromEither,n.Chain),n.filterOrElse=(0,m.filterOrElse)(n.FromEither,n.Chain),n.filterOrElseW=n.filterOrElse;var re=function(f){return(0,n.isLeft)(f)?(0,n.right)(f.left):(0,n.left)(f.right)};n.swap=re;var ae=function(f){return function(u){return(0,n.isLeft)(u)?f(u.left):u}};n.orElseW=ae,n.orElse=n.orElseW;var ie=function(f){return function(u){return u==null?(0,n.left)(f):(0,n.right)(u)}};n.fromNullable=ie;var ue=function(f,u){try{return(0,n.right)(f())}catch(g){return(0,n.left)(u(g))}};n.tryCatch=ue;var le=function(f,u){return function(){for(var g=[],D=0;D<arguments.length;D++)g[D]=arguments[D];return(0,n.tryCatch)(function(){return f.apply(void 0,g)},u)}};n.tryCatchK=le;var Pn=function(f){var u=(0,n.fromNullable)(f);return function(g){return(0,_.flow)(g,u)}};n.fromNullableK=Pn;var Nn=function(f){var u=(0,n.fromNullableK)(f);return function(g){return(0,n.chain)(u(g))}};n.chainNullableK=Nn,n.toUnion=(0,n.foldW)(_.identity,_.identity);function ce(f){return f instanceof Error?f:new Error(String(f))}n.toError=ce;function Wn(f){return function(u,g){if(g===void 0){var D=Wn(f);return function(X){return D(u,X)}}return(0,n.isLeft)(g)?!1:f.equals(u,g.right)}}n.elem=Wn;var fe=function(f){return function(u){return(0,n.isLeft)(u)?!1:f(u.right)}};n.exists=fe,n.Do=(0,n.of)(w.emptyRecord),n.bindTo=(0,y.bindTo)(n.Functor),n.bind=(0,d.bind)(n.Chain),n.bindW=n.bind,n.apS=(0,i.apS)(n.Apply),n.apSW=n.apS,n.ApT=(0,n.of)(w.emptyReadonlyArray);var oe=function(f){return function(u){var g=f(0,w.head(u));if((0,n.isLeft)(g))return g;for(var D=[g.right],X=1;X<u.length;X++){var bn=f(X,u[X]);if((0,n.isLeft)(bn))return bn;D.push(bn.right)}return(0,n.right)(D)}};n.traverseReadonlyNonEmptyArrayWithIndex=oe;var he=function(f){var u=(0,n.traverseReadonlyNonEmptyArrayWithIndex)(f);return function(g){return w.isNonEmpty(g)?u(g):n.ApT}};n.traverseReadonlyArrayWithIndex=he,n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex;var de=function(f){return(0,n.traverseReadonlyArrayWithIndex)(function(u,g){return f(g)})};n.traverseArray=de,n.sequenceArray=(0,n.traverseArray)(_.identity);function ge(f,u){return(0,n.tryCatch)(function(){return JSON.parse(f)},u)}n.parseJSON=ge;var me=function(f,u){return(0,n.tryCatch)(function(){var g=JSON.stringify(f);if(typeof g!="string")throw new Error("Converting unsupported structure to JSON");return g},u)};n.stringifyJSON=me,n.either={URI:n.URI,map:O,of:n.of,ap:F,chain:V,reduce:Z,foldMap:s,reduceRight:A,traverse:R,sequence:n.sequence,bimap:o,mapLeft:l,alt:v,extend:S,chainRec:C,throwError:n.throwError},n.getApplySemigroup=(0,i.getApplySemigroup)(n.Apply),n.getApplyMonoid=(0,a.getApplicativeMonoid)(n.Applicative);var ve=function(f,u){return(0,i.getApplySemigroup)((0,n.getApplicativeValidation)(f))(u)};n.getValidationSemigroup=ve;var ye=function(f,u){return(0,a.getApplicativeMonoid)((0,n.getApplicativeValidation)(f))(u)};n.getValidationMonoid=ye;function be(f){var u=(0,n.getApplicativeValidation)(f).ap,g=(0,n.getAltValidation)(f).alt;return{URI:n.URI,_E:void 0,map:O,of:n.of,chain:V,bimap:o,mapLeft:l,reduce:Z,foldMap:s,reduceRight:A,extend:S,traverse:R,sequence:n.sequence,chainRec:C,throwError:n.throwError,ap:u,alt:g}}n.getValidation=be})(De);var Ge={},ct={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.and=n.or=n.not=n.Contravariant=n.getMonoidAll=n.getSemigroupAll=n.getMonoidAny=n.getSemigroupAny=n.URI=n.contramap=void 0;var e=$,t=function(w,M){return(0,e.pipe)(w,(0,n.contramap)(M))},r=function(w){return function(M){return(0,e.flow)(w,M)}};n.contramap=r,n.URI="Predicate";var a=function(){return{concat:function(w,M){return(0,e.pipe)(w,(0,n.or)(M))}}};n.getSemigroupAny=a;var i=function(){return{concat:(0,n.getSemigroupAny)().concat,empty:e.constFalse}};n.getMonoidAny=i;var d=function(){return{concat:function(w,M){return(0,e.pipe)(w,(0,n.and)(M))}}};n.getSemigroupAll=d;var b=function(){return{concat:(0,n.getSemigroupAll)().concat,empty:e.constTrue}};n.getMonoidAll=b,n.Contravariant={URI:n.URI,contramap:t};var m=function(w){return function(M){return!w(M)}};n.not=m;var _=function(w){return function(M){return function(E){return M(E)||w(E)}}};n.or=_;var y=function(w){return function(M){return function(E){return M(E)&&w(E)}}};n.and=y})(ct);var ft={},rn={};Object.defineProperty(rn,"__esModule",{value:!0});rn.concatAll=rn.endo=rn.filterSecond=rn.filterFirst=rn.reverse=void 0;var Xr=function(n){return{concat:function(e,t){return n.concat(t,e)}}};rn.reverse=Xr;var Qr=function(n){return function(e){return{concat:function(t,r){return n(t)?e.concat(t,r):r}}}};rn.filterFirst=Qr;var kr=function(n){return function(e){return{concat:function(t,r){return n(r)?e.concat(t,r):t}}}};rn.filterSecond=kr;var $r=function(n){return function(e){return{concat:function(t,r){return e.concat(n(t),n(r))}}}};rn.endo=$r;var zr=function(n){return function(e){return function(t){return t.reduce(function(r,a){return n.concat(r,a)},e)}}};rn.concatAll=zr;(function(n){var e=N&&N.__createBinding||(Object.create?function(s,A,R,o){o===void 0&&(o=R);var l=Object.getOwnPropertyDescriptor(A,R);(!l||("get"in l?!A.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return A[R]}}),Object.defineProperty(s,o,l)}:function(s,A,R,o){o===void 0&&(o=R),s[o]=A[R]}),t=N&&N.__setModuleDefault||(Object.create?function(s,A){Object.defineProperty(s,"default",{enumerable:!0,value:A})}:function(s,A){s.default=A}),r=N&&N.__importStar||function(s){if(s&&s.__esModule)return s;var A={};if(s!=null)for(var R in s)R!=="default"&&Object.prototype.hasOwnProperty.call(s,R)&&e(A,s,R);return t(A,s),A};Object.defineProperty(n,"__esModule",{value:!0}),n.semigroupProduct=n.semigroupSum=n.semigroupString=n.getFunctionSemigroup=n.semigroupAny=n.semigroupAll=n.fold=n.getIntercalateSemigroup=n.getMeetSemigroup=n.getJoinSemigroup=n.getDualSemigroup=n.getStructSemigroup=n.getTupleSemigroup=n.getFirstSemigroup=n.getLastSemigroup=n.getObjectSemigroup=n.semigroupVoid=n.concatAll=n.last=n.first=n.intercalate=n.tuple=n.struct=n.reverse=n.constant=n.max=n.min=void 0;var a=$,i=r(T),d=r(rn),b=r(tt),m=function(s){return{concat:b.min(s)}};n.min=m;var _=function(s){return{concat:b.max(s)}};n.max=_;var y=function(s){return{concat:function(){return s}}};n.constant=y,n.reverse=d.reverse;var w=function(s){return{concat:function(A,R){var o={};for(var l in s)i.has.call(s,l)&&(o[l]=s[l].concat(A[l],R[l]));return o}}};n.struct=w;var M=function(){for(var s=[],A=0;A<arguments.length;A++)s[A]=arguments[A];return{concat:function(R,o){return s.map(function(l,v){return l.concat(R[v],o[v])})}}};n.tuple=M;var E=function(s){return function(A){return{concat:function(R,o){return A.concat(R,A.concat(s,o))}}}};n.intercalate=E;var O=function(){return{concat:a.identity}};n.first=O;var F=function(){return{concat:function(s,A){return A}}};n.last=F,n.concatAll=d.concatAll,n.semigroupVoid=(0,n.constant)(void 0);var V=function(){return{concat:function(s,A){return Object.assign({},s,A)}}};n.getObjectSemigroup=V,n.getLastSemigroup=n.last,n.getFirstSemigroup=n.first,n.getTupleSemigroup=n.tuple,n.getStructSemigroup=n.struct,n.getDualSemigroup=n.reverse,n.getJoinSemigroup=n.max,n.getMeetSemigroup=n.min,n.getIntercalateSemigroup=n.intercalate;function Z(s){var A=(0,n.concatAll)(s);return function(R,o){return o===void 0?A(R):A(R)(o)}}n.fold=Z,n.semigroupAll={concat:function(s,A){return s&&A}},n.semigroupAny={concat:function(s,A){return s||A}},n.getFunctionSemigroup=a.getSemigroup,n.semigroupString={concat:function(s,A){return s+A}},n.semigroupSum={concat:function(s,A){return s+A}},n.semigroupProduct={concat:function(s,A){return s*A}}})(ft);var Xn={};Object.defineProperty(Xn,"__esModule",{value:!0});Xn.guard=void 0;function xr(n,e){return function(t){return t?e.of(void 0):n.zero()}}Xn.guard=xr;(function(n){var e=N&&N.__createBinding||(Object.create?function(c,h,I,B){B===void 0&&(B=I);var nn=Object.getOwnPropertyDescriptor(h,I);(!nn||("get"in nn?!h.__esModule:nn.writable||nn.configurable))&&(nn={enumerable:!0,get:function(){return h[I]}}),Object.defineProperty(c,B,nn)}:function(c,h,I,B){B===void 0&&(B=I),c[B]=h[I]}),t=N&&N.__setModuleDefault||(Object.create?function(c,h){Object.defineProperty(c,"default",{enumerable:!0,value:h})}:function(c,h){c.default=h}),r=N&&N.__importStar||function(c){if(c&&c.__esModule)return c;var h={};if(c!=null)for(var I in c)I!=="default"&&Object.prototype.hasOwnProperty.call(c,I)&&e(h,c,I);return t(h,c),h};Object.defineProperty(n,"__esModule",{value:!0}),n.fromEither=n.MonadThrow=n.throwError=n.Witherable=n.wilt=n.wither=n.Traversable=n.sequence=n.traverse=n.Filterable=n.partitionMap=n.partition=n.filterMap=n.filter=n.Compactable=n.separate=n.compact=n.Extend=n.extend=n.Alternative=n.guard=n.Zero=n.zero=n.Alt=n.alt=n.altW=n.Foldable=n.reduceRight=n.foldMap=n.reduce=n.Monad=n.Chain=n.chain=n.Applicative=n.Apply=n.ap=n.Pointed=n.of=n.Functor=n.map=n.getMonoid=n.getOrd=n.getEq=n.getShow=n.URI=n.getRight=n.getLeft=n.fromPredicate=n.some=n.none=void 0,n.getLastMonoid=n.getFirstMonoid=n.getApplyMonoid=n.getApplySemigroup=n.option=n.mapNullable=n.getRefinement=n.sequenceArray=n.traverseArray=n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex=n.traverseReadonlyNonEmptyArrayWithIndex=n.ApT=n.apS=n.bind=n.bindTo=n.Do=n.exists=n.elem=n.toUndefined=n.toNullable=n.chainNullableK=n.fromNullableK=n.tryCatchK=n.tryCatch=n.fromNullable=n.chainFirstEitherK=n.chainEitherK=n.fromEitherK=n.duplicate=n.chainFirst=n.flatten=n.apSecond=n.apFirst=n.flap=n.getOrElse=n.getOrElseW=n.fold=n.match=n.foldW=n.matchW=n.isNone=n.isSome=n.FromEither=void 0;var a=vn,i=H,d=dn,b=J,m=$,_=z,y=r(T),w=ct,M=ft,E=Ve,O=hn,F=Xn;n.none=y.none,n.some=y.some;function V(c){return function(h){return c(h)?(0,n.some)(h):n.none}}n.fromPredicate=V;var Z=function(c){return c._tag==="Right"?n.none:(0,n.some)(c.left)};n.getLeft=Z;var s=function(c){return c._tag==="Left"?n.none:(0,n.some)(c.right)};n.getRight=s;var A=function(c,h){return(0,m.pipe)(c,(0,n.map)(h))},R=function(c,h){return(0,m.pipe)(c,(0,n.ap)(h))},o=function(c,h){return(0,m.pipe)(c,(0,n.chain)(h))},l=function(c,h,I){return(0,m.pipe)(c,(0,n.reduce)(h,I))},v=function(c){var h=(0,n.foldMap)(c);return function(I,B){return(0,m.pipe)(I,h(B))}},S=function(c,h,I){return(0,m.pipe)(c,(0,n.reduceRight)(h,I))},C=function(c){var h=(0,n.traverse)(c);return function(I,B){return(0,m.pipe)(I,h(B))}},W=function(c,h){return(0,m.pipe)(c,(0,n.alt)(h))},K=function(c,h){return(0,m.pipe)(c,(0,n.filter)(h))},k=function(c,h){return(0,m.pipe)(c,(0,n.filterMap)(h))},cn=function(c,h){return(0,m.pipe)(c,(0,n.extend)(h))},an=function(c,h){return(0,m.pipe)(c,(0,n.partition)(h))},un=function(c,h){return(0,m.pipe)(c,(0,n.partitionMap)(h))};n.URI="Option";var sn=function(c){return{show:function(h){return(0,n.isNone)(h)?"none":"some(".concat(c.show(h.value),")")}}};n.getShow=sn;var En=function(c){return{equals:function(h,I){return h===I||((0,n.isNone)(h)?(0,n.isNone)(I):(0,n.isNone)(I)?!1:c.equals(h.value,I.value))}}};n.getEq=En;var q=function(c){return{equals:(0,n.getEq)(c).equals,compare:function(h,I){return h===I?0:(0,n.isSome)(h)?(0,n.isSome)(I)?c.compare(h.value,I.value):1:-1}}};n.getOrd=q;var x=function(c){return{concat:function(h,I){return(0,n.isNone)(h)?I:(0,n.isNone)(I)?h:(0,n.some)(c.concat(h.value,I.value))},empty:n.none}};n.getMonoid=x;var G=function(c){return function(h){return(0,n.isNone)(h)?n.none:(0,n.some)(c(h.value))}};n.map=G,n.Functor={URI:n.URI,map:A},n.of=n.some,n.Pointed={URI:n.URI,of:n.of};var ln=function(c){return function(h){return(0,n.isNone)(h)||(0,n.isNone)(c)?n.none:(0,n.some)(h.value(c.value))}};n.ap=ln,n.Apply={URI:n.URI,map:A,ap:R},n.Applicative={URI:n.URI,map:A,ap:R,of:n.of};var yn=function(c){return function(h){return(0,n.isNone)(h)?n.none:c(h.value)}};n.chain=yn,n.Chain={URI:n.URI,map:A,ap:R,chain:o},n.Monad={URI:n.URI,map:A,ap:R,of:n.of,chain:o};var Fn=function(c,h){return function(I){return(0,n.isNone)(I)?c:h(c,I.value)}};n.reduce=Fn;var On=function(c){return function(h){return function(I){return(0,n.isNone)(I)?c.empty:h(I.value)}}};n.foldMap=On;var kn=function(c,h){return function(I){return(0,n.isNone)(I)?c:h(I.value,c)}};n.reduceRight=kn,n.Foldable={URI:n.URI,reduce:l,foldMap:v,reduceRight:S};var $n=function(c){return function(h){return(0,n.isNone)(h)?c():h}};n.altW=$n,n.alt=n.altW,n.Alt={URI:n.URI,map:A,alt:W};var zn=function(){return n.none};n.zero=zn,n.Zero={URI:n.URI,zero:n.zero},n.guard=(0,F.guard)(n.Zero,n.Pointed),n.Alternative={URI:n.URI,map:A,ap:R,of:n.of,alt:W,zero:n.zero};var xn=function(c){return function(h){return(0,n.isNone)(h)?n.none:(0,n.some)(c(h))}};n.extend=xn,n.Extend={URI:n.URI,map:A,extend:cn},n.compact=(0,n.chain)(m.identity);var ne=(0,E.separated)(n.none,n.none),ee=function(c){return(0,n.isNone)(c)?ne:(0,E.separated)((0,n.getLeft)(c.value),(0,n.getRight)(c.value))};n.separate=ee,n.Compactable={URI:n.URI,compact:n.compact,separate:n.separate};var te=function(c){return function(h){return(0,n.isNone)(h)?n.none:c(h.value)?h:n.none}};n.filter=te;var re=function(c){return function(h){return(0,n.isNone)(h)?n.none:c(h.value)}};n.filterMap=re;var ae=function(c){return function(h){return(0,E.separated)(K(h,(0,w.not)(c)),K(h,c))}};n.partition=ae;var ie=function(c){return(0,m.flow)((0,n.map)(c),n.separate)};n.partitionMap=ie,n.Filterable={URI:n.URI,map:A,compact:n.compact,separate:n.separate,filter:K,filterMap:k,partition:an,partitionMap:un};var ue=function(c){return function(h){return function(I){return(0,n.isNone)(I)?c.of(n.none):c.map(h(I.value),n.some)}}};n.traverse=ue;var le=function(c){return function(h){return(0,n.isNone)(h)?c.of(n.none):c.map(h.value,n.some)}};n.sequence=le,n.Traversable={URI:n.URI,map:A,reduce:l,foldMap:v,reduceRight:S,traverse:C,sequence:n.sequence};var Pn=(0,O.witherDefault)(n.Traversable,n.Compactable),Nn=(0,O.wiltDefault)(n.Traversable,n.Compactable),ce=function(c){var h=Pn(c);return function(I){return function(B){return h(B,I)}}};n.wither=ce;var Wn=function(c){var h=Nn(c);return function(I){return function(B){return h(B,I)}}};n.wilt=Wn,n.Witherable={URI:n.URI,map:A,reduce:l,foldMap:v,reduceRight:S,traverse:C,sequence:n.sequence,compact:n.compact,separate:n.separate,filter:K,filterMap:k,partition:an,partitionMap:un,wither:Pn,wilt:Nn};var fe=function(){return n.none};n.throwError=fe,n.MonadThrow={URI:n.URI,map:A,ap:R,of:n.of,chain:o,throwError:n.throwError},n.fromEither=n.getRight,n.FromEither={URI:n.URI,fromEither:n.fromEither},n.isSome=y.isSome;var oe=function(c){return c._tag==="None"};n.isNone=oe;var he=function(c,h){return function(I){return(0,n.isNone)(I)?c():h(I.value)}};n.matchW=he,n.foldW=n.matchW,n.match=n.matchW,n.fold=n.match;var de=function(c){return function(h){return(0,n.isNone)(h)?c():h.value}};n.getOrElseW=de,n.getOrElse=n.getOrElseW,n.flap=(0,_.flap)(n.Functor),n.apFirst=(0,i.apFirst)(n.Apply),n.apSecond=(0,i.apSecond)(n.Apply),n.flatten=n.compact,n.chainFirst=(0,d.chainFirst)(n.Chain),n.duplicate=(0,n.extend)(m.identity),n.fromEitherK=(0,b.fromEitherK)(n.FromEither),n.chainEitherK=(0,b.chainEitherK)(n.FromEither,n.Chain),n.chainFirstEitherK=(0,b.chainFirstEitherK)(n.FromEither,n.Chain);var ge=function(c){return c==null?n.none:(0,n.some)(c)};n.fromNullable=ge;var me=function(c){try{return(0,n.some)(c())}catch{return n.none}};n.tryCatch=me;var ve=function(c){return function(){for(var h=[],I=0;I<arguments.length;I++)h[I]=arguments[I];return(0,n.tryCatch)(function(){return c.apply(void 0,h)})}};n.tryCatchK=ve;var ye=function(c){return(0,m.flow)(c,n.fromNullable)};n.fromNullableK=ye;var be=function(c){return function(h){return(0,n.isNone)(h)?n.none:(0,n.fromNullable)(c(h.value))}};n.chainNullableK=be,n.toNullable=(0,n.match)(m.constNull,m.identity),n.toUndefined=(0,n.match)(m.constUndefined,m.identity);function f(c){return function(h,I){if(I===void 0){var B=f(c);return function(nn){return B(h,nn)}}return(0,n.isNone)(I)?!1:c.equals(h,I.value)}}n.elem=f;var u=function(c){return function(h){return(0,n.isNone)(h)?!1:c(h.value)}};n.exists=u,n.Do=(0,n.of)(y.emptyRecord),n.bindTo=(0,_.bindTo)(n.Functor),n.bind=(0,d.bind)(n.Chain),n.apS=(0,i.apS)(n.Apply),n.ApT=(0,n.of)(y.emptyReadonlyArray);var g=function(c){return function(h){var I=c(0,y.head(h));if((0,n.isNone)(I))return n.none;for(var B=[I.value],nn=1;nn<h.length;nn++){var Ze=c(nn,h[nn]);if((0,n.isNone)(Ze))return n.none;B.push(Ze.value)}return(0,n.some)(B)}};n.traverseReadonlyNonEmptyArrayWithIndex=g;var D=function(c){var h=(0,n.traverseReadonlyNonEmptyArrayWithIndex)(c);return function(I){return y.isNonEmpty(I)?h(I):n.ApT}};n.traverseReadonlyArrayWithIndex=D,n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex;var X=function(c){return(0,n.traverseReadonlyArrayWithIndex)(function(h,I){return c(I)})};n.traverseArray=X,n.sequenceArray=(0,n.traverseArray)(m.identity);function bn(c){return function(h){return(0,n.isSome)(c(h))}}n.getRefinement=bn,n.mapNullable=n.chainNullableK,n.option={URI:n.URI,map:A,of:n.of,ap:R,chain:o,reduce:l,foldMap:v,reduceRight:S,traverse:C,sequence:n.sequence,zero:n.zero,alt:W,extend:cn,compact:n.compact,separate:n.separate,filter:K,filterMap:k,partition:an,partitionMap:un,wither:Pn,wilt:Nn,throwError:n.throwError},n.getApplySemigroup=(0,i.getApplySemigroup)(n.Apply),n.getApplyMonoid=(0,a.getApplicativeMonoid)(n.Applicative);var _e=function(){return(0,n.getMonoid)((0,M.first)())};n.getFirstMonoid=_e;var p=function(){return(0,n.getMonoid)((0,M.last)())};n.getLastMonoid=p})(Ge);var ot={};(function(n){var e=N&&N.__createBinding||(Object.create?function(R,o,l,v){v===void 0&&(v=l);var S=Object.getOwnPropertyDescriptor(o,l);(!S||("get"in S?!o.__esModule:S.writable||S.configurable))&&(S={enumerable:!0,get:function(){return o[l]}}),Object.defineProperty(R,v,S)}:function(R,o,l,v){v===void 0&&(v=l),R[v]=o[l]}),t=N&&N.__setModuleDefault||(Object.create?function(R,o){Object.defineProperty(R,"default",{enumerable:!0,value:o})}:function(R,o){R.default=o}),r=N&&N.__importStar||function(R){if(R&&R.__esModule)return R;var o={};if(R!=null)for(var l in R)l!=="default"&&Object.prototype.hasOwnProperty.call(R,l)&&e(o,R,l);return t(o,R),o};Object.defineProperty(n,"__esModule",{value:!0}),n.getMonoid=n.getSemigroup=n.io=n.sequenceArray=n.traverseArray=n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex=n.traverseReadonlyNonEmptyArrayWithIndex=n.ApT=n.apS=n.bind=n.bindTo=n.Do=n.FromIO=n.ChainRec=n.MonadIO=n.fromIO=n.chainFirst=n.Monad=n.Chain=n.Applicative=n.apSecond=n.apFirst=n.Apply=n.Pointed=n.flap=n.Functor=n.URI=n.flatten=n.chain=n.of=n.ap=n.map=void 0;var a=vn,i=H,d=dn,b=$,m=z,_=r(T),y=function(R,o){return function(){return o(R())}},w=function(R,o){return function(){return R()(o())}},M=function(R,o){return function(){return o(R())()}},E=function(R,o){return function(){for(var l=o(R)();l._tag==="Left";)l=o(l.left)();return l.right}},O=function(R){return function(o){return y(o,R)}};n.map=O;var F=function(R){return function(o){return w(o,R)}};n.ap=F,n.of=b.constant;var V=function(R){return function(o){return M(o,R)}};n.chain=V,n.flatten=(0,n.chain)(b.identity),n.URI="IO",n.Functor={URI:n.URI,map:y},n.flap=(0,m.flap)(n.Functor),n.Pointed={URI:n.URI,of:n.of},n.Apply={URI:n.URI,map:y,ap:w},n.apFirst=(0,i.apFirst)(n.Apply),n.apSecond=(0,i.apSecond)(n.Apply),n.Applicative={URI:n.URI,map:y,ap:w,of:n.of},n.Chain={URI:n.URI,map:y,ap:w,chain:M},n.Monad={URI:n.URI,map:y,ap:w,of:n.of,chain:M},n.chainFirst=(0,d.chainFirst)(n.Chain),n.fromIO=b.identity,n.MonadIO={URI:n.URI,map:y,ap:w,of:n.of,chain:M,fromIO:n.fromIO},n.ChainRec={URI:n.URI,map:y,ap:w,chain:M,chainRec:E},n.FromIO={URI:n.URI,fromIO:b.identity},n.Do=(0,n.of)(_.emptyRecord),n.bindTo=(0,m.bindTo)(n.Functor),n.bind=(0,d.bind)(n.Chain),n.apS=(0,i.apS)(n.Apply),n.ApT=(0,n.of)(_.emptyReadonlyArray);var Z=function(R){return function(o){return function(){for(var l=[R(0,_.head(o))()],v=1;v<o.length;v++)l.push(R(v,o[v])());return l}}};n.traverseReadonlyNonEmptyArrayWithIndex=Z;var s=function(R){var o=(0,n.traverseReadonlyNonEmptyArrayWithIndex)(R);return function(l){return _.isNonEmpty(l)?o(l):n.ApT}};n.traverseReadonlyArrayWithIndex=s,n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex;var A=function(R){return(0,n.traverseReadonlyArrayWithIndex)(function(o,l){return R(l)})};n.traverseArray=A,n.sequenceArray=(0,n.traverseArray)(b.identity),n.io={URI:n.URI,map:y,of:n.of,ap:w,chain:M,fromIO:n.fromIO,chainRec:E},n.getSemigroup=(0,i.getApplySemigroup)(n.Apply),n.getMonoid=(0,a.getApplicativeMonoid)(n.Applicative)})(ot);const{pipe:Y,flow:Ai,constant:Ii,identity:si,tupled:Ei,constVoid:Oi}=Xt;Ke(De.Apply);Ke(Ge.Apply);Yn(De.Apply);Yn(Ge.Apply);Yn(ot.Apply);const L=(n,e,t)=>n+(e-n)*t,ht=(n,e)=>t=>[n(t),e(t)],dt=(n,e)=>t=>t==null?e():n(t),gt=(n,e,t,r)=>{const a=(r[0]-t[0])*(n[1]-t[1])-(r[1]-t[1])*(n[0]-t[0]),i=(t[1]-n[1])*(n[0]-e[0])-(t[0]-n[0])*(n[1]-e[1]),d=(r[1]-t[1])*(e[0]-n[0])-(r[0]-t[0])*(e[1]-n[1]);if(d==0)return null;const b=a/d,m=i/d;return b>=0&&b<=1&&m>=0&&m<=1?{position:[L(n[0],e[0],b),L(n[1],e[1],b)],offset:b}:null},na=(n,e)=>n.every((t,r)=>e.every((a,i)=>gt(t,n[(r+1)%n.length],a,e[(i+1)%e.length])==null)),se=mn(),Bn=mn(),jn=mn(),Vn=mn({}),Q={master:mn({gridSize:10,carAmount:50}),brain:mn({sensorCount:5,sensorLength:100,sensorSpread:Math.PI/2,minFitness:-200}),controls:mn({showNetwork:!0,cameraFocus:0,playerControls:!1,drawSensors:!0,cameraSpeed:.06,carThrust:2,maxSpeed:8,carTurnSpeed:.5,carBreakStrength:.4,friction:.04})},ea={gridSize:{type:"number",where:"master",min:2,max:100,step:1},carAmount:{type:"number",where:"master",min:2,max:100,step:1},cameraFocus:{type:"number",where:"controls",min:0,max:5,step:1},playerControls:{type:"checkbox",where:"controls"},showNetwork:{type:"checkbox",where:"controls"},drawSensors:{type:"checkbox",where:"controls"},sensorCount:{type:"number",where:"brain",min:1,max:30,step:1},sensorLength:{type:"number",where:"brain",min:50,max:200,step:10},sensorSpread:{type:"number",where:"brain",min:0,max:Math.PI,step:.3},minFitness:{type:"number",where:"brain",min:-3e3,max:0,step:50},cameraSpeed:{type:"number",where:"controls",min:0,max:.15,step:.001},carThrust:{type:"number",where:"controls",min:1,max:15,step:1},carTurnSpeed:{type:"number",where:"controls",min:.3,max:1.5,step:.1},carBreakStrength:{type:"number",where:"controls",min:.05,max:.3,step:.05},friction:{type:"number",where:"controls",min:.01,max:1,step:.01},maxSpeed:{type:"number",where:"controls",min:3,max:20,step:1}};Q.master.subscribe(({carAmount:n})=>{ea.cameraFocus.max=n-1});let Ee=100,In=5;Q.brain.subscribe(({sensorLength:n})=>{Ee=n});Q.master.subscribe(({gridSize:n})=>{In=n});const Oe=(n,e)=>{const r=[Math.floor((n[0]/200+In)%In),Math.floor((n[1]/200+In)%In)],a=(r[0]+r[1]*In)*4,i=d=>d.map(b=>[(r[0]+b[0])*200,(r[1]+b[1])*200]);return[...e[a],...e[a+1],...e[a+2],...e[a+3]].map(i)},ta=(n,e)=>[...Oe([n.x,n.y],e.borders),...e.polygons.reduce((t,r)=>[...t,...r.map((a,i)=>[a,r[(i+1)%r.length]])],[])],ra=(n,e)=>[...Oe([n.x,n.y],e.borders),...Oe([n.x-Math.sin(n.angle)*Ee,n.y-Math.cos(n.angle)*Ee],e.borders),...e.polygons.reduce((t,r)=>[...t,...r.map((a,i)=>[a,r[(i+1)%r.length]])],[])],Gn=n=>{const e=[],t=Math.hypot(n.width,n.height)/2,r=Math.atan2(n.width,n.height);return e.push([n.x-Math.sin(-n.angle-r)*t,n.y-Math.cos(-n.angle-r)*t]),e.push([n.x-Math.sin(-n.angle+r)*t,n.y-Math.cos(-n.angle+r)*t]),e.push([n.x-Math.sin(Math.PI-n.angle-r)*t,n.y-Math.cos(Math.PI-n.angle-r)*t]),e.push([n.x-Math.sin(Math.PI-n.angle+r)*t,n.y-Math.cos(Math.PI-n.angle+r)*t]),{box:n,polygon:e}},aa=n=>e=>{const{box:t,polygon:r}=e;return!ta(t,n).every(d=>na(r,d))},Je=(n,e,t)=>({borders:e,polygons:t.map(r=>r===n?[]:Gn(r.box).polygon)});let mt=.04,Pe=5;Q.controls.subscribe(({friction:n,maxSpeed:e})=>{mt=n,Pe=e});const ia=n=>e=>Y(n,ua(e)),ua=n=>e=>{var _,y,w,M;const t=(y=(_=n.physics)==null?void 0:_.mass)!=null?y:10,r=(M=(w=n.physics)==null?void 0:w.momentum)!=null?M:{direction:0,magnitude:0},{thrust:a,breaks:i,angle:d}=e,b=a/t,m=Math.max(Math.min(r.magnitude+b,Pe),-Pe);return n.physics={mass:t,momentum:{...r,magnitude:Math.max(Math.abs(m)-mt-i,0)*(m<0?-1:1)}},n.angle=(n.angle+d*m+Math.PI*2)%(Math.PI*2),n.x+=Math.sin(n.angle)*m,n.y-=Math.cos(n.angle)*m,n},la=n=>e=>ia(e)(n),ca=n=>e=>(e.x=e.x<0?n.width:e.x>n.width?0:e.x,e.y=e.y<0?n.height:e.y>n.height?0:e.y,e),vt=n=>Math.atan((n.destination[1]-n.box.y)/(n.destination[0]-n.box.x))+Math.PI/2*(n.box.x<n.destination[0]?1:-1),Kn=n=>Math.PI/(n.box.angle-vt(n))%(Math.PI*2),fa=n=>Math.sqrt((n.destination[0]-n.box.x)**2+(n.destination[1]-n.box.y)**2),oa=n=>e=>{const[t,r]=n.destination;return e.fillStyle="purple",e.beginPath(),e.arc(t,r,n.box.width/2,0,Math.PI*2),e.fill(),e.strokeStyle="purple",e.beginPath(),e.setLineDash([9,3]),e.moveTo(n.box.x,n.box.y),e.lineTo(t,r),e.stroke(),e.save(),e.translate(n.box.x,n.box.y),e.rotate(vt(n)),e.strokeStyle="red",e.beginPath(),e.setLineDash([9,3]),e.moveTo(0,0),e.lineTo(0,-100),e.stroke(),e.restore(),e};let pn=3,Ne=100,Ue=Math.PI/4;Bn.update(n=>n);Q.brain.subscribe(({sensorCount:n,sensorLength:e,sensorSpread:t})=>{pn=n,Ne=e,Ue=t});const yt=n=>e=>Y(ra(e,n),t=>new Array(pn*2).fill(0).map((r,a)=>{const i=a%2*Math.PI+L(Ue/2,-Ue/2,pn==1?.5:Math.floor(a/2)/(pn-1))-e.angle,d=[e.x,e.y],b=[e.x-Math.sin(i)*Ne,e.y-Math.cos(i)*Ne],m=t.map(_=>gt(d,b,..._)).filter(_=>_!=null);return m.sort((_,y)=>_.offset-y.offset),{start:d,end:b,contacts:m}})),ha=(n,e,t)=>r=>Y(n.box,yt(Je(n,e,t)),da(r),oa(n)),da=n=>e=>e.map(t=>{var a,i;const r=(i=(a=t.contacts[0])==null?void 0:a.position)!=null?i:t.end;return n.lineWidth=2,n.strokeStyle="yellow",n.beginPath(),n.moveTo(...t.start),n.lineTo(...r),n.stroke(),n.strokeStyle="black",n.beginPath(),n.moveTo(...t.end),n.lineTo(...r),n.stroke(),n})[0];let He=100;Q.master.subscribe(n=>{const e=n.gridSize*200;He=Math.sqrt(e**2+e**2)});const ga=n=>e=>e.map(t=>Y(t,ma,ba(n),ya(t.brain))),ma=n=>-fa(n)/He+n.performace,va=()=>He,ya=n=>e=>({...n,reward:e}),ba=n=>e=>n<60?-1e7:e,_a=n=>(n.sort((e,t)=>t.reward-e.reward),n[0]);let bt=0;Q.controls.subscribe(({drawSensors:n,cameraFocus:e})=>{bt=e});const Sa=n=>e=>e.map((t,r)=>t.dead?t:Y(t.box,Gn,aa(Je(t,n.borders,e)),Aa(t),Ia(r==bt),sa)),wa=n=>e=>e.map(t=>({car:t,sensor:Y(t.box,yt(Je(t,n,e)))})),Ra=n=>e=>e.map(({car:t,action:r})=>Y(r,la(t.box),ca(n.size)));let _t=0;Q.brain.subscribe(({minFitness:n})=>{_t=n});const Ma=n=>e=>n.map(t=>{const r=Gn(t.box).polygon;e.beginPath(),e.fillStyle=t.dead?"red":t.color,r.forEach((i,d)=>d==0?e.moveTo(...i):e.lineTo(...i)),e.fill();const a={...t.box,height:t.box.height*Math.max(t.fitness/_t,0)};return e.beginPath(),e.fillStyle="red",Gn(a).polygon.forEach((i,d)=>d==0?e.moveTo(...i):e.lineTo(...i)),e.fill(),e.beginPath(),e.fillStyle="black",e.fillText(`       p:${Math.floor(t.performace)},f:${Math.floor(t.fitness)}`,t.box.x,t.box.y),e.fill(),e})[0],Aa=n=>e=>{var t,r;return e&&(n.performace-=va()*Math.abs((r=(t=n.box.physics)==null?void 0:t.momentum.magnitude)!=null?r:0)),n.dead=e,n},Ia=n=>e=>{var t,r;return n&&Vn.update(a=>{var i,d,b;return{...a,angle:Kn(e),momen:(i=e.box.physics)==null?void 0:i.momentum.magnitude,perAdd:((b=(d=e.box.physics)==null?void 0:d.momentum.magnitude)!=null?b:0)*Kn(e)-3}}),e.performace+=((r=(t=e.box.physics)==null?void 0:t.momentum.magnitude)!=null?r:0)*Kn(e)-3,e},sa=n=>(n.performace+=0,n),ze={onkeydown:n=>{n.preventDefault(),Jn[n.key]=Pa[n.key]||Na},onkeyup:n=>{n.preventDefault(),delete Jn[n.key]}},Ea=()=>{const n={...Oa};return Object.keys(Jn).map(e=>Jn[e](n)),n},Oa={thrust:0,breaks:0,angle:0};let Te=3,Ce=.1,Le=.5*Math.PI/180;Q.controls.subscribe(({carThrust:n,carTurnSpeed:e,carBreakStrength:t})=>{Te=n,Ce=t,Le=e*Math.PI/180});const Jn={},Pa={ArrowUp:n=>n.thrust=Te,ArrowDown:n=>n.thrust=Te*-.4,ArrowLeft:n=>n.angle=-Le,ArrowRight:n=>n.angle=Le,Shift:n=>n.breaks=Ce,Space:n=>n.breaks=Ce},Na=n=>{};let St,wt;se.subscribe(n=>{St=n});Bn.subscribe(n=>{wt=n});const Rt=(n,e)=>{const t=document.getElementById(n)||xe("error: declaring canvas returned null",St);t.width=e.width,t.height=e.height;const r=t.getContext("2d")||xe("error: declaring context returned null",wt);return{canvas:t,ctx:r}},xe=(n,e)=>(console.error(n),e);let Ie;const Ua="background-canvas",Ta=n=>e=>n.backgroundSaved?(e.drawImage(Ie,0,0),e):(Ie=Y(Rt(Ua,n.size),Ca(n)),e.drawImage(Ie,0,0),n.backgroundSaved=!0,e),Ca=n=>e=>{const{canvas:t,ctx:r}=e,{map:a,size:i,dim:d}=n;r.fillStyle="green",r.fillRect(0,0,i.width,i.height);const b={width:i.width/d,height:i.height/d};return new Array(a.length).fill(0).map((m,_)=>{r.save(),r.translate(L(0,i.width,_%d/d)+b.width/2,L(0,i.height,Math.floor(_/d)/d)+b.height/2),r.rotate(a[_].rotate*90*Math.PI/180),r.translate(-b.width/2,-b.height/2),a[_].draw(r)(b),r.restore()}),t},La=[[-1,-1],[0,1],[1,0],[0,-1],[-1,0],[1,-1],[-1,1],[1,1]],Fa=(n,e,t,r)=>Wa(n,La.filter(a=>!0),t);let Mt=!1,At=0;Q.controls.subscribe(({drawSensors:n,cameraFocus:e})=>{At=e,Mt=n});const Wa=(n,e,t)=>{const r=a=>Y(a,Ta(n),Ma(t),Mt?ha(t[At],n.borders,t):i=>i);return a=>(e.forEach(i=>{a.save(),a.translate(n.size.width*i[0],n.size.height*i[1]),r(a),a.restore()}),r(a))},It=n=>e=>(e.clearRect(0,0,n.width,n.height),e),P=6,Sn=16,j=5,fn="black",Cn="gray",tn=[0,0],Mn=[n=>e=>{n.fillStyle=Cn;const t=L(0,e.width,1/P);n.fillRect(t-j*2,0,e.width-t*2+j*4,e.height),n.lineWidth=j,n.strokeStyle=fn;const r=e.height/Sn,a=[r,r];new Array(P-1).fill(0).forEach((i,d)=>{const b=L(0,e.width,(d+1)/P);n.beginPath(),n.setLineDash(d==0||d==P-2?tn:a),n.moveTo(b,0),n.lineTo(b,e.height),n.stroke()})},n=>e=>{n.fillStyle=Cn;const t={x:L(0,e.width,1/P),y:L(0,e.height,1/P)};n.fillRect(t.x-j*2,0,e.width-t.x*2+j*4,e.height),n.fillRect(0,t.y-j*2,e.width,e.height-t.y*2+j*4),n.fillStyle=fn,n.beginPath(),n.arc(t.x,t.y,j/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(e.width-t.x,t.y,j/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(t.x,e.height-t.y,j/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(e.width-t.x,e.height-t.y,j/2,0,2*Math.PI),n.fill(),n.lineWidth=j,n.strokeStyle=fn;const r=e.height/Sn,a=e.width/Sn,i=[r,r],d=[a,a];new Array(P-1).fill(0).forEach((b,m)=>{let _=L(0,e.width,(m+1)/P),y=L(0,e.height,1/P);n.setLineDash(m==0||m==P-2?tn:i),n.beginPath(),n.moveTo(_,0),n.lineTo(_,y),n.stroke(),n.beginPath(),n.moveTo(_,e.height-y),n.lineTo(_,e.height),n.stroke(),_=L(0,e.width,1/P),y=L(0,e.height,(m+1)/P),n.setLineDash(m==0||m==P-2?tn:d),n.beginPath(),n.moveTo(0,y),n.lineTo(_,y),n.stroke(),n.beginPath(),n.moveTo(e.width-_,y),n.lineTo(e.width,y),n.stroke()})},n=>e=>{n.fillStyle=Cn;const t={x:L(0,e.width,1/P),y:L(0,e.height,1/P)};n.fillRect(t.x-j*2,0,e.width-t.x*2+j*4,e.height),n.fillRect(0,t.y-j*2,e.width/2,e.height-t.y*2+j*4),n.fillStyle=fn,n.beginPath(),n.arc(t.x,t.y,j/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(t.x,e.height-t.y,j/2,0,2*Math.PI),n.fill(),n.lineWidth=j,n.strokeStyle=fn;const r=e.height/Sn,a=e.width/Sn,i=[r,r],d=[a,a];new Array(P-1).fill(0).forEach((b,m)=>{let _=L(0,e.width,(m+1)/P),y=L(0,e.height,1/P);m==P-2?(n.setLineDash(tn),n.beginPath(),n.moveTo(_,0),n.lineTo(_,e.height),n.stroke()):(n.setLineDash(m==0||m==P-2?tn:i),n.beginPath(),n.moveTo(_,0),n.lineTo(_,y),n.stroke(),n.beginPath(),n.moveTo(_,e.height-y),n.lineTo(_,e.height),n.stroke()),_=L(0,e.width,1/P),y=L(0,e.height,(m+1)/P),n.setLineDash(m==0||m==P-2?tn:d),n.beginPath(),n.moveTo(0,y),n.lineTo(_,y),n.stroke()})},n=>e=>{n.fillStyle=Cn;const t={x:L(0,e.width,1/P),y:L(0,e.height,1/P)};n.fillRect(t.x-j*2,0,e.width-t.x*2+j*4,e.height-t.y),n.fillRect(0,t.y-j*2,e.width-t.x+j*2,e.height-t.y*2+j*4),n.fillStyle=fn,n.beginPath(),n.arc(t.x,t.y,j/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(e.width-t.x,e.height-t.y,j/2,0,2*Math.PI),n.fill(),n.lineWidth=j,n.strokeStyle=fn;const r=e.height/Sn,a=[r,r];new Array(P-1).fill(0).forEach((i,d)=>{let b=L(0,e.width,(d+1)/P),m=L(0,e.height,1/P);d==P-2?(n.setLineDash(tn),n.beginPath(),n.moveTo(b,0),n.lineTo(b,e.height-t.y),n.stroke()):(n.setLineDash(d==0||d==P-2?tn:a),n.beginPath(),n.moveTo(b,0),n.lineTo(b,m),n.stroke()),b=L(0,e.width,1/P),m=L(0,e.height,(d+1)/P),d==P-2?(n.setLineDash(tn),n.beginPath(),n.moveTo(0,m),n.lineTo(e.width-t.x,m),n.stroke()):(n.setLineDash(d==0||d==P-2?tn:a),n.beginPath(),n.moveTo(0,m),n.lineTo(b,m),n.stroke())})},()=>()=>{},n=>e=>{n.fillStyle=Cn;const t={x:L(0,e.width,1/P),y:L(0,e.height,1/P)};n.fillRect(t.x-j*2,0,e.width-t.x*2+j*4,e.height-t.y+j*2),n.fillStyle=fn,n.beginPath(),n.arc(t.x,e.height-t.y,j/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(e.width-t.x,e.height-t.y,j/2,0,2*Math.PI),n.fill(),n.lineWidth=j,n.strokeStyle=fn;const r=e.height/Sn,a=[r,r];new Array(P-1).fill(0).forEach((i,d)=>{let b=L(0,e.width,(d+1)/P),m=L(0,e.height,1/P);d==0||d==P-2?(n.setLineDash(tn),n.beginPath(),n.moveTo(b,0),n.lineTo(b,e.height-t.y),n.stroke()):(n.setLineDash(a),n.beginPath(),n.moveTo(b,0),n.lineTo(b,m),n.stroke()),b=L(0,e.width,1/P),m=L(0,e.height,(d+1)/P),d==P-2&&(n.setLineDash(tn),n.beginPath(),n.moveTo(t.x,m),n.lineTo(e.width-t.x,m),n.stroke())})}],qa=[()=>({rotate:0,draw:Mn[4]}),n=>({rotate:n.indexOf(!0),draw:Mn[5]}),n=>{const e=n[0]==n[2],t=e?n[0]?0:1:n[0]&&n[3]?0:n[1]&&n[0]?1:n[2]&&n[1]?2:3,r=e?Mn[0]:Mn[3];return{rotate:t,draw:r}},n=>({rotate:n[2]&&n[3]&&n[0]?0:n[3]&&n[0]&&n[1]?1:n[0]&&n[1]&&n[2]?2:3,draw:Mn[2]}),()=>({rotate:0,draw:Mn[1]})],U=L(0,1,1/P),Da=[[[U,U],[1-U,U]],[[1-U,U],[1-U,1-U]],[[1-U,1-U],[U,1-U]],[[U,1-U],[U,U]]],ja=[[[[U,0],[U,U]],[[1-U,0],[1-U,U]]],[[[1,U],[1-U,U]],[[1,1-U],[1-U,1-U]]],[[[1-U,1],[1-U,1-U]],[[U,1],[U,1-U]]],[[[0,U],[U,U]],[[0,1-U],[U,1-U]]]],Ka=n=>n.map((e,t)=>e?ja[t]:[Da[t]]),pa=n=>({connections:wn[0].slice(),possibilities:new Array(wn.length).fill(0).map((e,t)=>t),index:n}),wn=[[!1,!1,!1,!1],[!0,!0,!0,!0],[!0,!1,!0,!1],[!1,!0,!1,!0],[!0,!0,!1,!1],[!1,!1,!0,!0],[!0,!0,!0,!1],[!0,!0,!1,!0],[!0,!1,!0,!0],[!1,!0,!0,!0]],Ba=[(n,e,t,r)=>{const a=(t-n+e.length)%e.length;e[a].connections[2]=r,e[a].possibilities=e[a].possibilities.filter(i=>wn[i][2]===r)},(n,e,t,r)=>{let a=(t+1)%e.length;a=Math.abs(a%n-t%n)>1?(a-n+e.length)%e.length:a,e[a].connections[3]=r,e[a].possibilities=e[a].possibilities.filter(i=>wn[i][3]===r)},(n,e,t,r)=>{const a=(t+n)%e.length;e[a].connections[0]=r,e[a].possibilities=e[a].possibilities.filter(i=>wn[i][0]===r)},(n,e,t,r)=>{let a=(t-1+e.length)%e.length;a=Math.abs(a%n-t%n)>1?(a+n)%e.length:a,e[a].connections[1]=r,e[a].possibilities=e[a].possibilities.filter(i=>wn[i][1]===r)}],Va=(n,e,t)=>{const r=wn[t.possibilities[Math.floor(Math.random()*t.possibilities.length)]];r.forEach((a,i)=>Ba[i](n,e,t.index,a)),t.connections=r,t.possibilities=[]},Ga=n=>new Array(n**2).fill(null).map((e,t)=>pa(t)),Ja=(n,e)=>n.possibilities.length-e.possibilities.length,st=n=>e=>{if(e.filter(a=>a.possibilities.length!=0).length==0)return e.map(a=>a.connections);const t=e.slice().sort(Ja).filter(a=>a.possibilities.length!=0),r=t.filter(a=>a.possibilities.length==t[0].possibilities.length);return Va(n,e,r[Math.floor(Math.random()*r.length)]),st(n)(e)},Ha=n=>n.map(e=>qa[e.reduce((t,r)=>t+Number(r),0)](e)),nt=n=>Y(Ga(n),st(n),e=>({map:Ha(e),borders:e.reduce((t,r)=>[...t,...Ka(r)],[])}));let An=0,Et=.06;Q.controls.subscribe(({cameraSpeed:n})=>{Et=n});const Ya=n=>e=>{if(e.save(),n){const t=n.box.angle-An,r=t>Math.PI?n.box.angle-Math.PI*2-An:t<-Math.PI?n.box.angle+Math.PI*2-An:t;An=(An+r*Et+Math.PI*2)%(Math.PI*2),e.translate(e.canvas.width/2,e.canvas.height/2),e.rotate(-An),e.translate(-n.box.x,-n.box.y)}return e},Za=n=>(n.restore(),n);let Fe=0,Ot=!1;Q.controls.subscribe(({cameraFocus:n,playerControls:e})=>{Ot=e,Fe=n});Q.brain.subscribe(({minFitness:n})=>{});const Xa=n=>e=>{var r,a;e.map(i=>Qa());const t=(a=(r=e.slice().map((i,d)=>({car:i,i:d})).filter(i=>!i.car.dead).sort((i,d)=>d.car.fitness-i.car.fitness)[0])==null?void 0:r.i)!=null?a:0;return!Ot&&Fe!=null&&Fe!=t&&Q.controls.update(i=>({...i,cameraFocus:t})),e.filter(i=>!i.dead)},Qa=(n,e)=>null,et=n=>{const e=new Array;for(let t=0;t<n.length-1;t++)e.push(ka(n[t],n[t+1]));return{layers:e}},ka=(n,e)=>{const t=new Array(n),r=new Array(e),a=r.fill(0).map(d=>Math.random()*2-1),i=t.fill(0).map(d=>r.map(b=>Math.random()*2-1));return{inputs:t,outputs:r,biases:a,weights:i}},$a=n=>e=>n.layers.reduce((t,r)=>Pt(t,r),e),za=n=>e=>n.layers.reduce((t,r)=>{const a=Pt(t.input,r),i=t.output;return i.push({...r,inputs:t.input,outputs:a}),{input:a,output:i}},{input:e,output:[]}).output,Pt=(n,e)=>e.outputs.map((t,r)=>n.reduce((a,i,d)=>a+xa(i*e.weights[d][r]),0)+e.biases[r]>0?1:0),xa=n=>n;let Ln;const ni="network-canvas",We="white",Hn="black";let Nt;const ei=(n,e)=>t=>{const r={width:t.canvas.width/2.5,height:t.canvas.height/2.5};return Ln=Ln!=null?Ln:Rt(ni,r).ctx,Y(Ln,It(r),ti(n,Nt,e)),t},ti=(n,e,t)=>r=>{if(!n||!e)return;const a=50,i=a,d=a,b=r.canvas.width-a*2,m=r.canvas.height-a*2,_=2;r.lineDashOffset=-t/50,r.lineWidth=_*2,r.fillStyle=Hn,r.fillRect(0,0,r.canvas.width,r.canvas.height),r.strokeStyle=Hn,r.strokeRect(_,_,r.canvas.width-_*2,r.canvas.height-_*2),r.strokeStyle=We,r.strokeRect(_*3,_*3,r.canvas.width-_*6,r.canvas.height-_*6);const y=m/e.length;for(let w=e.length-1;w>=0;w--){const M=d+L(m-y,0,e.length==1?.5:w/(e.length-1));r.setLineDash([7,3]),ri(r,e[w],i,M,b,y,w==e.length-1?["T","L","Ri","B","Re"]:[])}return r},ri=(n,e,t,r,a,i,d)=>{const b=t+a,m=r+i,{inputs:_,outputs:y,weights:w,biases:M}=e;for(let O=0;O<_.length;O++)for(let F=0;F<y.length;F++)n.beginPath(),n.moveTo(qn(_,O,t,b),m),n.lineTo(qn(y,F,t,b),r),n.lineWidth=2,n.strokeStyle=Dn(w[O][F]),n.stroke();const E=18;for(let O=0;O<_.length;O++){const F=qn(_,O,t,b);n.beginPath(),n.arc(F,m,E*.85,0,Math.PI*2),n.fillStyle=We,n.fill(),n.beginPath(),n.arc(F,m,E*.6,0,Math.PI*2),n.fillStyle=Dn(_[O]),n.fill()}for(let O=0;O<y.length;O++){const F=qn(y,O,t,b);n.beginPath(),n.arc(F,r,E*.85,0,Math.PI*2),n.fillStyle=We,n.fill(),n.beginPath(),n.arc(F,r,E*.6,0,Math.PI*2),n.fillStyle=Dn(y[O]),n.fill(),n.beginPath(),n.lineWidth=2,n.arc(F,r,E*1,0,Math.PI*2),n.strokeStyle=Dn(M[O]),n.setLineDash([3,3]),n.stroke(),n.setLineDash([]),d[O]&&(n.beginPath(),n.textAlign="center",n.textBaseline="middle",n.fillStyle=Hn,n.strokeStyle=Hn,n.font=E*.9+"px Arial",n.fillText(d[O],F,r+E*.1),n.lineWidth=.5,n.strokeText(d[O],F,r+E*.1))}},qn=(n,e,t,r)=>L(t,r,n.length==1?.5:e/(n.length-1)),Dn=n=>{const e=Math.abs(n),t=255,r=0,a=n>0?255:0;return`rgba(${t},${a},${r},${e})`},ai=n=>Nt=n;let Ut=0,Tt=3,Ct=.1,qe=.5*Math.PI/180,Lt=!1;Q.controls.subscribe(n=>{Ut=n.cameraFocus,Lt=n.playerControls,Tt=n.carThrust,Ct=n.carBreakStrength,qe=n.carTurnSpeed*Math.PI/180});const ii=n=>Lt?n.map(({car:e})=>({car:e,action:Ea()})):n.map(({car:e,sensor:t},r)=>ui(e,t,r)),ui=(n,e,t)=>{const[r,a,i,d,b]=Y([Kn(n),...e.map(m=>{var _,y;return 1-((y=(_=m.contacts[0])==null?void 0:_.offset)!=null?y:1)})],ht(m=>t===Ut?Y(m,za(n.brain),ai):null,$a(n.brain)))[1];return{car:n,action:{thrust:Tt*r*(b>.5?-.4:1),angle:qe*-a+qe*i,breaks:Ct*d}}},Ye="bestNetwork";let Qn=!1;jn.subscribe(n=>Qn=n);const li=n=>{if(!Qn)return!1;try{localStorage.setItem(Ye,JSON.stringify(n))}catch{return!1}return!0},ci=()=>{if(!Qn)return!1;try{localStorage.removeItem(Ye)}catch{return!1}return!0},fi=()=>{if(!Qn)return null;try{return localStorage.getItem(Ye)}catch{return null}},oi=n=>n==null?!0:li(n),hi=n=>!0,Ft=()=>{var n;return JSON.parse((n=fi())!=null?n:"null")},di=Ft,Wt=()=>Y(Ft(),dt(n=>n,di)),gi=ci,mi=n=>{const e=Wt();return Vn.update(t=>({...t,curReward:n.reward,bestReward:e==null?void 0:e.reward})),e==null||e.reward<n.reward?n:null},vi=(n,e=.1)=>({layers:yi(n,e)}),yi=(n,e)=>n.layers.map(t=>Y(t,bi(e),_i(e))),bi=n=>e=>(e.biases=e.biases.map(t=>L(t,Math.random()*2-1,n)),e),_i=n=>e=>(e.weights=e.weights.map(t=>t.map(r=>L(r,Math.random()*2-1,n))),e);function Si(n){let e,t,r,a,i,d,b,m,_;return Kt(n[13]),{c(){e=Se("canvas"),t=Xe(),r=Se("canvas"),a=Xe(),i=Se("canvas"),this.h()},l(y){e=we(y,"CANVAS",{id:!0,style:!0,class:!0}),Re(e).forEach(gn),t=Qe(y),r=we(y,"CANVAS",{width:!0,height:!0}),Re(r).forEach(gn),a=Qe(y),i=we(y,"CANVAS",{id:!0,width:!0,height:!0,class:!0}),Re(i).forEach(gn),this.h()},h(){en(e,"id","background-canvas"),pt(e,"display","none"),en(e,"class","svelte-wies5q"),en(r,"width",n[1]),en(r,"height",n[2]),en(i,"id","network-canvas"),en(i,"width",d=n[1]/2.5),en(i,"height",b=n[2]/2.5),en(i,"class","svelte-wies5q")},m(y,w){Un(y,e,w),Un(y,t,w),Un(y,r,w),n[14](r),Un(y,a,w),Un(y,i,w),m||(_=[Me(window,"keydown",ze.onkeydown),Me(window,"keyup",ze.onkeyup),Me(window,"resize",n[13])],m=!0)},p(y,[w]){w&2&&en(r,"width",y[1]),w&4&&en(r,"height",y[2]),w&2&&d!==(d=y[1]/2.5)&&en(i,"width",d),w&4&&b!==(b=y[2]/2.5)&&en(i,"height",b)},i:ke,o:ke,d(y){y&&gn(e),y&&gn(t),y&&gn(r),n[14](null),y&&gn(a),y&&gn(i),m=!1,Bt(_)}}}const on=200;function wi(n,e,t){let r,a,i,d,b,m,_;_n(n,se,q=>t(20,a=q)),_n(n,Bn,q=>t(21,i=q)),_n(n,jn,q=>t(10,b=q));let{debug:y=!1}=e;const{master:w,controls:M,brain:E}=Q;_n(n,w,q=>t(11,m=q)),_n(n,M,q=>t(19,r=q)),_n(n,E,q=>t(12,_=q)),Tn(M,r.showNetwork=y,r);let O,F,V;Vt(()=>{se.set(O),Bn.set(a.getContext("2d")),Tn(jn,b=!0,b),requestAnimationFrame(k)}),Gt(()=>{l=!0,Tn(jn,b=!1,b),Vn.set({})});const Z=on/P*.6,s=["#0f0","#000","#0ff","#f0f","#fff"],A={box:{x:100,y:100,width:30,height:55,angle:0},brain:et([1,1]),destination:[0,0],color:"#000",dead:!0,fitness:0,performace:0};let R=[],o,l=!1,v=nt(Number(m.gridSize)),S=[_.sensorCount*2+1,6,4,5],C=0,W=mn(null);_n(n,W,q=>t(22,d=q));const K=q=>l||d!=q,k=(q,x=q,G=Math.random())=>{if(d==null&&Tn(W,d=G,d),!K(G)){if(an()){cn(C);return}un(q),Vn.update(ln=>({...ln,fps:Math.round(1/((q-x)/1e3))})),C++,requestAnimationFrame(ln=>k(ln,q,G))}},cn=q=>Y(R,ga(q),_a,mi,ht(oi,hi),x=>x.every(G=>G)?requestAnimationFrame(()=>w.update(G=>({...G}))):alert("error! could not save to each storage")),an=q=>Y(R,Sa(o),Xa(),wa(o.borders),ii,Ra(o)).every(x=>x==null),un=q=>{var x;return Y(i,It({width:a.width,height:a.height}),Ya(R[r.cameraFocus]),Fa(o,(x=R[r.cameraFocus])==null?void 0:x.box,R,{width:a.width,height:a.height}),Za,ei(r.showNetwork,q))};function sn(){t(1,F=window.innerWidth),t(2,V=window.innerHeight)}function En(q){Jt[q?"unshift":"push"](()=>{O=q,t(0,O)})}return n.$$set=q=>{"debug"in q&&t(7,y=q.debug)},n.$$.update=()=>{n.$$.dirty&4096&&(gi(),t(9,S=[_.sensorCount*2+1,4,5])),n.$$.dirty&3840&&(t(8,v=nt(Number(m.gridSize))),o={...v,dim:m.gridSize,size:{width:m.gridSize*on,height:m.gridSize*on},backgroundSaved:!1},R=new Array(m.carAmount).fill(A).map((q,x)=>{const G=Number(m.gridSize),ln=Math.floor(Math.random()*G),yn=Math.floor(Math.random()*G),On=v.map[ln+yn*G].rotate==1?Math.PI/2:0;return{brain:Y(Wt(),dt(vi,()=>et(S))),box:{x:ln*on+L(0,on,(Math.floor(1+Math.random()*(P-2))+.5)/P),y:yn*on+L(0,on,(Math.floor(1+Math.random()*(P-2))+.5)/P),width:Z,height:Z*1.6,angle:On,physics:{momentum:{direction:0,magnitude:0},mass:Math.random()*5+5}},destination:[on*(Math.floor(ln+G*.5)%G+.5),on*(Math.floor(yn+G*.5)%G+.5)],color:s[Math.floor(Math.random()*s.length)],dead:!1,fitness:0,performace:0}}),C=0,Tn(W,d=null,d),b&&requestAnimationFrame(k))},[O,F,V,w,M,E,W,y,v,S,b,m,_,sn,En]}class Pi extends qt{constructor(e){super(),Dt(this,e,wi,Si,jt,{debug:7})}}export{Pi as C,ea as a,Q as c,Vn as l};
